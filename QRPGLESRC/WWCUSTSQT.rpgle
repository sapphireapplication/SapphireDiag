000100020111     H*‚--------------------------------------------------------------------    000200020111     H*ˆCOPYRIGHT DATABOROUGH LTD 2007                                          000300020111     H*ˆPROGRAM:  Work with Customers                                           000400020111     H*‚--------------------------------------------------------------------    000500020111     H DATEDIT(*YMD)                                                            000600020111     F**********************************************************************    000700020111     F*‚F i l e s                                                               000800020111     F**********************************************************************    000900020111     FWCUSTSD   CF   E             WORKSTN                                      001000020111     F                                     SFILE(ZZSF01:SFLRRN)                 001100020111     FCUSTS     UF A E           K DISK                                         001200020111     F                                     INFDS(FILEDS)                        001300020111     FSLMEN     IF   E           K DISK                                         001400020111     FCUSFL3    IF   E           K DISK                                         001500020111     FCUSGRP    IF   E           K DISK                                         001600020111     FDISTS     IF   E           K DISK                                         001700020111     FCONHDRL1  IF   E           K DISK                                         001800020111     FTRNHSTL3  IF   E           K DISK                                         001900020111     D**********************************************************************    002000020111     D*‚D e f i n i t i o n s                                                   002100020111     D**********************************************************************    002200020111     D*‚Set constants                                                           002300020111     D RTNMTX          C                   CONST('RTNMSGTEXT')                  002400020111     D INIDAT          C                   CONST('0001-01-01')                  002500020111                                                                                002600020111     d FILEDS          ds                                                       002700020111     d  FILESTS               11     15s 0                                      002800020111                                                                                002900020111     D  pageno         s              3p 0                                      003000020111     D  noofpages      s              3p 0 inz(2)                               003100020111     D  sflrrn         s              5p 0                                      003200020111     D  sflchg         s              1a   inz('0')                             003300020111     D  sflCTR         s              3P 0                                      003400020111                                                                                003500020111     D                 DS                  INZ                                  003600020111     D  ZDATE                  1     10                                         003700020111     D  ZYR                    1      4                                         003800020111     D  FILLR1                 5      5                                         003900020111     D  ZMTH                   6      7                                         004000020111     D  FILLR2                 8      8                                         004100020111     D  ZDAY                   9     10                                         004200020111                                                                                004300020111     I**********************************************************************    004400020111     IRCUSF                                                                     004500020111     I              DSDCDE                      XSDCDE                          004600020111                                                                                004700020111     C**********************************************************************    004800020111     C*‚M a i n l i n e   C o d e                                               004900020111     C**********************************************************************    005000020111     C*‚Build subfile                                                           005100020111     C                   EXSR      SFLWRT                                       005200020111                                                                                005300020111     C     *IN03         DOWEQ     '0'                                          005400020111     C     *IN12         ANDEQ     '0'                                          005500020111     C                   MOVE      *BLANKS       LOCATE                         005600020111     C*‚Display screens                                                         005700020111     C                   WRITE     ZZTR01                                       005800020111!ADD!C                   IF        %ERROR(WCUSTSD)                              005900020111     C                   WRITE     ZZMC01                                       006000020111!ADD!C                   ENDIF                                                  006100020111     C                   EXFMT     ZZCT01                                       006200020111     C*‚Remove messages                                                         006300020111     C                   CALL      'XBCCLMSG'                                   006400020111     C     *IN03         IFEQ      '1'                                          006500020111     C     *IN12         OREQ      '1'                                          006600020111     C                   LEAVE                                                  006700020111     C                   ENDIF                                                  006800020111     C*‚Action positioner request                                               006900020111     C     LOCATE        IFNE      *BLANKS                                      007000020111     C                   MOVE      *ZEROS        SFLRRN                         007100020111     C                   MOVE      LOCATE        XWBCCD                         007200020111     C                   EXSR      SFLWRT                                       007300020111     C                   ITER                                                   007400020111     C                   ENDIF                                                  007500020111     C*‚Action command keys                                                     007600020111     C     *IN28         IFEQ      '1'                                          007700020111     C                   EXSR      CMDKEY                                       007800020111     C                   ELSE                                                   007900020111     C*‚Else action selections                                                  008000020111     C                   EXSR      ZSELEC                                       008100020111     C                   ENDIF                                                  008200020111     C*‚If changes made then update display                                     008300020111     C     SFLCHG        IFEQ      '1'                                          008400020111     C                   MOVE      *LOVAL        XWBCCD                         008500020111     C                   EXSR      SFLWRT                                       008600020111     C                   ENDIF                                                  008700020111                                                                                008800020111     C                   ENDDO                                                  008900020111                                                                                009000020111     C                   MOVE      '1'           *INLR                          009100020111     C                   RETURN                                                 009200020111     C**********************************************************************    009300020111     C*‚L o g i c a l   E n d   o f   P r o g r a m                             009400020111     C**********************************************************************    009500020111                                                                                009600020111     C**********************************************************************    009700020111     C     SFLWRT        BEGSR                                                  009800020111     C**********************************************************************    009900020111     C*‚Subroutine: Write data to subfile                                       010000020111     C**********************************************************************    010100020111     C*‚Delete subfile                                                          010200020111     C                   IF        SFLRRN = 0                                   010300020111     C                   SETON                                        74        010400020111     C                   SETOFF                                       717281    010500020111     C                   WRITE     ZZCT01                               99      010600020111     C                   SETOFF                                       74        010700020111     C*‚Write subfile                                                           010800020111     C                   MOVE      *ZEROS        SFLRRN                         010900020111     C     XWBCCD        SETLL     CUSTS                                        011000020111     C                   ENDIF                                                  011100020111     C*                                                                         011200020111     C                   MOVE      *ZEROS        SFLCTR                         011300020111     C     *IN81         DOWEQ     '0'                                          011400020111     C     SFLCTR        ANDLT     12                                           011500020111     C                   READ(N)   CUSTS                                  81    011600020111XI   C                   IF        NOT %EOF(CUSTS)                              011700020111     C                   ADD       1             SFLRRN                         011800020111     C                   ADD       1             SFLCTR                         011900020111     C                   IF        SFLCTR = 1                                   012000020111     C                   Z-ADD     SFLRRN        SHWREC                         012100020111     C                   ENDIF                                                  012200020111     C                   MOVE      *BLANKS       DSSEL                          012300020111     C                   WRITE     ZZSF01                               99      012400020111     C                   ENDIF                                                  012500020111     C                   ENDDO                                                  012600020111                                                                                012700020111     C     SFLRRN        IFGT      0                                            012800020111     C                   SETON                                        71        012900020111     C                   ENDIF                                                  013000020111     C                   SETON                                        72        013100020111                                                                                013200020111     C                   ENDSR                                                  013300020111     C**********************************************************************    013400020111                                                                                013500020111     C**********************************************************************    013600020111     C     CMDKEY        BEGSR                                                  013700020111     C**********************************************************************    013800020111     C*‚Subroutine: Action command keys                                         013900020111     C**********************************************************************    014000020111     C                   SELECT                                                 014100020111                                                                                014200020111     C     *IN26         WHENEQ    '1'                                          014300020111     C                   EXSR      SFLWRT                                       014400020111                                                                                014500020111     C     *IN06         WHENEQ    '1'                                          014600020111     C                   EXSR      addrec                                       014700020111     C                   Z-ADD     1             SHWREC                         014800020111     C                   MOVE      '1'           SFLCHG                         014900020111     C                   ENDSL                                                  015000020111                                                                                015100020111     C                   MOVE      '0'           *IN12                          015200020111                                                                                015300020111     C                   ENDSR                                                  015400020111     C**********************************************************************    015500020111                                                                                015600020111     C**********************************************************************    015700020111     C     ZSELEC        BEGSR                                                  015800020111     C**********************************************************************    015900020111     C*‚Subroutine: Action selection                                            016000020111     C**********************************************************************    016100020111     C                   MOVE      '0'           SFLCHG                         016200020111     C                   READC     ZZSF01                                 35    016300020111                                                                                016400020111     C*‚For each selection                                                      016500020111XI   C                   DOW       NOT %EOF(WCUSTSD)                            016600020111     C                   MOVE      '1'           SFLCHG                         016700020111                                                                                016800020111     C                   SELECT                                                 016900020111     C*‚Change                                                                  017000020111     C     DSSEL         WHENEQ    '2'                                          017100020111     C                   EXSR      chgrec                                       017200020111     C*‚Delete                                                                  017300020111     C     DSSEL         WHENEQ    '4'                                          017400020111     C                   EXSR      delrec                                       017500020111     C*‚Display                                                                 017600020111     C     DSSEL         WHENEQ    '5'                                          017700020111     C                   EXSR      dsprec                                       017800020111     C*‚Customer Detail Maintenance                                             017900020111     C     DSSEL         WHENEQ    '6'                                          018000020111     C                   call      'CUSTMNT1'                                   018100020111     C                   parm                    XWBCCD                         018200020111     C*‚Work with Orders                                                        018300020111     C     DSSEL         WHENEQ    '8'                                          018400020111     C                   EXSR      ZORDER                                       018500020111     C*‚Work with Transaction history                                           018600020111     C     DSSEL         WHENEQ    '9'                                          018700020111     C                   EXSR      ZHISTO                                       018800020111     C                   ENDSL                                                  018900020111                                                                                019000020111     C                   MOVE      *BLANKS       DSSEL                          019100020111     C                   UPDATE    ZZSF01                               99      019200020111     C                   READC     ZZSF01                                 35    019300020111                                                                                019400020111     C*‚End: For each selection                                                 019500020111     C                   ENDDO                                                  019600020111                                                                                019700020111     C                   MOVE      '0'           *IN12                          019800020111                                                                                019900020111     C                   ENDSR                                                  020000020111     C**********************************************************************    020100020111                                                                                020200020111     C**********************************************************************    020300020111     C     dspscns       BEGSR                                                  020400020111     C**********************************************************************    020500020111     C*‚Subroutine: Display detail screens                                      020600020111     C**********************************************************************    020700020111     C*‚Display screen, depending upon page no.                                 020800020111     C                   select                                                 020900020111     C                   when      pageno = 1                                   021000020111     C                   EXFMT     ZZFT01                                       021100020111     C                   when      pageno = 2                                   021200020111     C                   EXFMT     ZZFT02                                       021300020111     C                   endsl                                                  021400020111     C                   EXSR      MVSCDB                                       021500020111                                                                                021600020111     C                   CALL      'XBCCLMSG'                                   021700020111     C                   EXSR      OFFIND                                       021800020111                                                                                021900020111     C*‚Process Command Keys                                                    022000020111     C                   SELECT                                                 022100020111     C*‚Prompt                                                                  022200020111     C     *IN04         WHENEQ    '1'                                          022300020111     C                   EXSR      SRPROM                                       022400020111     C*‚Orders                                                                  022500020111     C     *IN08         WHENEQ    '1'                                          022600020111     C                   EXSR      ZORDER                                       022700020111     C*‚Transaction history                                                     022800020111     C     *IN09         WHENEQ    '1'                                          022900020111     C                   EXSR      ZHISTO                                       023000020111     C                   ENDSL                                                  023100020111                                                                                023200020111     C                   ENDSR                                                  023300020111     C**********************************************************************    023400020111                                                                                023500020111     C**********************************************************************    023600020111     C     VALID1        BEGSR                                                  023700020111     C**********************************************************************    023800020111     C*‚Subroutine: Validation #1                                               023900020111     C**********************************************************************    024000020111     C                   DO                                                     024100020111     C* WHEN ADDING CUSTOMER MUST NOT BE ZERO                                   024200020111     C     XWBCCD        IFEQ      *BLANKS                                      024300020111     C                   MOVE      '1'           *IN99                          024400020111     C                   MOVE      *ON           *IN31                          024500020111     C                   MOVE      'OEM0002'     MSGID                          024600020111     C                   CALL      RTNMTX                                       024700020111     C                   PARM                    MSGID             7            024800020111     C                   PARM                    ERRMSG          132            024900020111     C                   LEAVE                                                  025000020111     C                   ENDIF                                                  025100020111     C* WHEN ADDING CUSTOMER MUST NOT EXIST                                     025200020111     C     ACTDSP        IFEQ      'ADDITION'                                   025300020111     C     XWBCCD        SETLL     CUSTS                                  99    025400020111XI   C                   IF        %EQUAL(CUSTS)                                025500020111     C                   MOVE      *ON           *IN31                          025600020111     C                   MOVE      'Y2U0003'     MSGID                          025700020111     C                   MOVEL     *ALL'-'       XWG4TX                         025800020111     C                   CALL      RTNMTX                                       025900020111     C                   PARM                    MSGID             7            026000020111     C                   PARM                    ERRMSG          132            026100020111     C                   LEAVE                                                  026200020111     C                   ENDIF                                                  026300020111     C                   ENDIF                                                  026400020111     C*‚Customer name                                                           026500020111     C     XWG4TX        IFEQ      *BLANKS                                      026600020111     C                   MOVE      *ON           *IN32                          026700020111     C                   MOVE      *ON           *IN99                          026800020111     C                   MOVE      'OEM0012'     MSGID                          026900020111     C                   CALL      RTNMTX                                       027000020111     C                   PARM                    MSGID             7            027100020111     C                   PARM                    ERRMSG          132            027200020111     C                   LEAVE                                                  027300020111     C                   ENDIF                                                  027400020111     C*- CUSTOMER GROUP                                                         027500020111     C     XWBNCD        CHAIN     CUSGRP                             99        027600020111XI   C                   IF        NOT %FOUND(CUSGRP)                           027700020111     C                   MOVE      '1'           *IN33                          027800020111     C                   MOVE      'OES0374'     MSGID                          027900020111     C                   MOVEL     *ALL'-'       XWKHTX                         028000020111     C                   CALL      RTNMTX                                       028100020111     C                   PARM                    MSGID             7            028200020111     C                   PARM                    ERRMSG          132            028300020111     C                   LEAVE                                                  028400020111     C                   ENDIF                                                  028500020111     C*- SALESMAN                                                               028600020111     C     PERSON        CHAIN     SLMEN                              99        028700020111XI   C                   IF        NOT %FOUND(SLMEN)                            028800020111     C                   MOVE      '1'           *IN34                          028900020111     C                   MOVE      'OEM0023'     MSGID                          029000020111     C                   CALL      RTNMTX                                       029100020111     C                   PARM                    MSGID             7            029200020111     C                   PARM                    ERRMSG          132            029300020111     C                   MOVE      *ALL'-'       PNAME                          029400020111     C                   LEAVE                                                  029500020111     C                   ENDIF                                                  029600020111     C*- Distributor                                                            029700020111     C     DSDCDE        CHAIN     DISTS                              99        029800020111XI   C                   IF        NOT %FOUND(DISTS)                            029900020111     C                   MOVE      '1'           *IN35                          030000020111     C                   MOVE      'OEM0018'     MSGID                          030100020111     C                   CALL      RTNMTX                                       030200020111     C                   PARM                    MSGID             7            030300020111     C                   PARM                    ERRMSG          132            030400020111     C                   MOVE      *ALL'-'       DNAME                          030500020111     C                   LEAVE                                                  030600020111     C                   ENDIF                                                  030700020111     C                   ENDDO                                                  030800020111     C                   ENDSR                                                  030900020111     C**********************************************************************    031000020111                                                                                031100020111     C**********************************************************************    031200020111     C     VALID2        BEGSR                                                  031300020111     C**********************************************************************    031400020111     C*‚Subroutine: Validation #2                                               031500020111     C**********************************************************************    031600020111     C                   DO                                                     031700020111     C*- BALANCE                                                                031800020111     C     ACTDSP        IFNE      'ADDITION'                                   031900020111     C     XWGIVA        SUB       XWIDV0        XDIFF            15 2          032000020111     C     XDIFF         IFLT      *ZERO                                        032100020111     C                   MOVE      '1'           *IN99                          032200020111     C                   MOVE      '1'           *IN36                          032300020111     C                   MOVE      'OES0373'     MSGID                          032400020111     C                   CALL      RTNMTX                                       032500020111     C                   PARM                    MSGID             7            032600020111     C                   PARM                    ERRMSG          132            032700020111     C                   LEAVE                                                  032800020111     C                   ENDIF                                                  032900020111     C                   ENDIF                                                  033000020111     C*- CUSTOMER CANNOT BE ZERO                                                033100020111     C     CUSNO         IFEQ      *ZEROS                                       033200020111     C                   MOVE      '1'           *IN37                          033300020111     C                   MOVE      '1'           *IN99                          033400020111     C                   MOVE      'CNP0008'     MSGID                          033500020111     C                   CALL      RTNMTX                                       033600020111     C                   PARM                    MSGID             7            033700020111     C                   PARM                    ERRMSG          132            033800020111     C                   LEAVE                                                  033900020111     C                   ENDIF                                                  034000020111     C*- CUSTOMER                                                               034100020111     C     CUSNO         CHAIN     CUSFL3                             99        034200020111XI   C                   IF        NOT %FOUND(CUSFL3)                           034300020111     C                   MOVE      '1'           *IN37                          034400020111     C                   MOVE      'CNP0002'     MSGID                          034500020111     C                   CALL      RTNMTX                                       034600020111     C                   PARM                    MSGID             7            034700020111     C                   PARM                    ERRMSG          132            034800020111     C                   LEAVE                                                  034900020111     C                   ENDIF                                                  035000020111     C                   ENDDO                                                  035100020111     C                   ENDSR                                                  035200020111     C**********************************************************************    035300020111                                                                                035400020111     C**********************************************************************    035500020111     C     ADDREC        BEGSR                                                  035600020111     C**********************************************************************    035700020111     C*‚Subroutine: Add a record                                                035800020111     C**********************************************************************    035900020111     C                   MOVE      '0'           *IN94                          036000020111     C                   MOVE      '1'           *IN96                          036100020111     C                   MOVE      '0'           *IN97                          036200020111     C                   MOVEL     'ADDITION'    ACTDSP                         036300020111     C                   EXSR      OFFIND                                       036400020111                                                                                036500020111     C                   clear                   custsr                         036600020111     C                   eval      pname = *blanks                              036700020111     C                   eval      dname = *blanks                              036800020111     C                   eval      xwkhtx = *blanks                             036900020111     C                   exsr      mvdbsc                                       037000020111                                                                                037100020111     C                   eval      pageno = 1                                   037200020111                                                                                037300020111     C*‚For each screen page                                                    037400020111     C                   dow       pageno <= noofpages                          037500020111                                                                                037600020111     C                   EXSR      DSPSCNS                                      037700020111                                                                                037800020111     C     *IN03         IFEQ      '1'                                          037900020111     C     *IN12         OREQ      '1'                                          038000020111     C                   LEAVE                                                  038100020111     C                   ENDIF                                                  038200020111                                                                                038300020111     C     *IN04         IFEQ      '1'                                          038400020111     C     *IN08         OREQ      '1'                                          038500020111     C     *IN09         OREQ      '1'                                          038600020111     C                   ITER                                                   038700020111     C                   ENDIF                                                  038800020111                                                                                038900020111     C                   select                                                 039000020111     C                   when      pageno = 1                                   039100020111     C                   EXSR      VALID1                                       039200020111     C                   when      pageno = 2                                   039300020111     C                   EXSR      VALID2                                       039400020111     C                   endsl                                                  039500020111                                                                                039600020111     C*‚If errors found                                                         039700020111XI   C                   IF        NOT %FOUND(CUSFL3)                           039800020111     C*‚Display error message and re-display screen                             039900020111     C                   MOVEL     ERRMSG        ZMSAGE                         040000020111     C                   exsr      mvdbsc                                       040100020111     C                   iter                                                   040200020111     C                   ENDIF                                                  040300020111                                                                                040400020111     C                   eval      pageno = pageno + 1                          040500020111                                                                                040600020111     C*‚End: For each screen page                                               040700020111     C                   ENDDO                                                  040800020111                                                                                040900020111     C*‚If not F3/F12                                                           041000020111     C     *IN03         IFNE      '1'                                          041100020111     C     *IN12         ANDNE     '1'                                          041200020111                                                                                041300020111     C*‚Request confirmation                                                    041400020111     C                   EXFMT     ZZCNF1                                       041500020111     C     *IN03         IFNE      '1'                                          041600020111     C     *IN12         ANDNE     '1'                                          041700020111     C*‚If confirmation received then write record                              041800020111     C                   WRITE     CUSTSR                               99      041900020111XI   C                   IF        %ERROR(CUSTS)                                042000020111     C                   MOVE      'Y2U0004'     MSGID                          042100020111     C                   CALL      RTNMTX                                       042200020111     C                   PARM                    MSGID             7            042300020111     C                   PARM                    ERRMSG          132            042400020111     C* Display error message                                                   042500020111     C                   MOVEL     ERRMSG        ZMSAGE                         042600020111     C                   ENDIF                                                  042700020111     C                   ENDIF                                                  042800020111                                                                                042900020111     C*‚End: If not F3/F12                                                      043000020111     C                   ENDIF                                                  043100020111                                                                                043200020111     C                   ENDSR                                                  043300020111     C**********************************************************************    043400020111                                                                                043500020111     C**********************************************************************    043600020111     C     CHGREC        BEGSR                                                  043700020111     C**********************************************************************    043800020111     C*‚Subroutine: Change a record                                             043900020111     C**********************************************************************    044000020111     C                   MOVEL     '  UPDATE'    ACTDSP                         044100020111     C                   MOVE      '0'           *IN94                          044200020111     C                   MOVE      '0'           *IN96                          044300020111     C                   MOVE      '0'           *IN97                          044400020111     C                   EXSR      OFFIND                                       044500020111                                                                                044600020111     C                   EXSR      GETREC                                       044700020111                                                                                044800020111     C*‚If no record or file error                                              044900020111XI   C                   IF        %FOUND(CUSTS)                                045000020111XI   C                              AND NOT %ERROR(CUSTS)                       045100020111                                                                                045200020111     C                   eval      pageno = 1                                   045300020111                                                                                045400020111     C*‚For each screen page                                                    045500020111     C                   dow       pageno <= noofpages                          045600020111                                                                                045700020111     C                   EXSR      DSPSCNS                                      045800020111                                                                                045900020111     C     *IN03         IFEQ      '1'                                          046000020111     C     *IN12         OREQ      '1'                                          046100020111     C                   LEAVE                                                  046200020111     C                   ENDIF                                                  046300020111                                                                                046400020111     C     *IN04         IFEQ      '1'                                          046500020111     C     *IN08         OREQ      '1'                                          046600020111     C     *IN09         OREQ      '1'                                          046700020111     C                   ITER                                                   046800020111     C                   ENDIF                                                  046900020111                                                                                047000020111     C                   select                                                 047100020111     C                   when      pageno = 1                                   047200020111     C                   EXSR      VALID1                                       047300020111     C                   when      pageno = 2                                   047400020111     C                   EXSR      VALID2                                       047500020111     C                   endsl                                                  047600020111                                                                                047700020111     C*‚If errors found                                                         047800020111XI   C                   IF        NOT %FOUND(CUSFL3)                           047900020111     C*‚Display error message and re-display screen                             048000020111     C                   MOVEL     ERRMSG        ZMSAGE                         048100020111     C                   exsr      mvdbsc                                       048200020111     C                   iter                                                   048300020111     C                   ENDIF                                                  048400020111                                                                                048500020111     C                   eval      pageno = pageno + 1                          048600020111                                                                                048700020111     C*‚End: For each screen page                                               048800020111     C                   ENDDO                                                  048900020111                                                                                049000020111     C*‚If not F3/F12                                                           049100020111     C     *IN03         IFNE      '1'                                          049200020111     C     *IN12         ANDNE     '1'                                          049300020111                                                                                049400020111     C*‚Request confirmation                                                    049500020111     C                   EXFMT     ZZCNF1                                       049600020111     C     *IN03         IFNE      '1'                                          049700020111     C     *IN12         ANDNE     '1'                                          049800020111     C*‚If confirmation received then update record                             049900020111     C     xwbccd        chain(e)  custsr                                       050000020111     C                   if        %found(custs)                                050100020111     C                   exsr      mvscdb                                       050200020111     C                   UPDATE    CUSTSR                               99      050300020111XI   C                   IF        %ERROR(CUSTS)                                050400020111     C                   MOVE      'Y2U0007'     MSGID                          050500020111     C                   CALL      RTNMTX                                       050600020111     C                   PARM                    MSGID             7            050700020111     C                   PARM                    ERRMSG          132            050800020111     C* Display error message                                                   050900020111     C                   MOVEL     ERRMSG        ZMSAGE                         051000020111     C                   ENDIF                                                  051100020111     C                   else                                                   051200020111     C                   unlock(e) custs                                        051300020111     C                   endif                                                  051400020111     C                   ENDIF                                                  051500020111                                                                                051600020111     C*‚End: If not F3/F12                                                      051700020111     C                   ENDIF                                                  051800020111                                                                                051900020111     C*‚End: If no record or file error                                         052000020111     C                   ENDIF                                                  052100020111                                                                                052200020111     C                   MOVE      SFLRRN        SHWREC                         052300020111                                                                                052400020111     C                   ENDSR                                                  052500020111     C**********************************************************************    052600020111                                                                                052700020111     C**********************************************************************    052800020111     C     DELREC        BEGSR                                                  052900020111     C**********************************************************************    053000020111     C*‚Subroutine: Delete a record                                             053100020111     C**********************************************************************    053200020111     C                   MOVEL     '  DELETE'    ACTDSP                         053300020111     C                   MOVE      '1'           *IN94                          053400020111     C                   MOVE      '0'           *IN96                          053500020111     C                   MOVE      '1'           *IN97                          053600020111     C                   EXSR      OFFIND                                       053700020111                                                                                053800020111     C                   EXSR      GETREC                                       053900020111                                                                                054000020111     C                   eval      pageno = 1                                   054100020111                                                                                054200020111     C*‚For each screen page                                                    054300020111     C                   dow       pageno <= noofpages                          054400020111                                                                                054500020111     C                   EXSR      DSPSCNS                                      054600020111                                                                                054700020111     C     *IN03         IFEQ      '1'                                          054800020111     C     *IN12         OREQ      '1'                                          054900020111     C                   LEAVE                                                  055000020111     C                   ENDIF                                                  055100020111                                                                                055200020111     C     *IN04         IFEQ      '1'                                          055300020111     C     *IN08         OREQ      '1'                                          055400020111     C     *IN09         OREQ      '1'                                          055500020111     C                   ITER                                                   055600020111     C                   ENDIF                                                  055700020111                                                                                055800020111     C                   eval      pageno = pageno + 1                          055900020111                                                                                056000020111     C*‚End: For each screen page                                               056100020111     C                   ENDDO                                                  056200020111                                                                                056300020111     C*‚If not F3/F12                                                           056400020111     C     *IN03         IFNE      '1'                                          056500020111     C     *IN12         ANDNE     '1'                                          056600020111                                                                                056700020111     C*‚Request confirmation                                                    056800020111     C                   EXFMT     ZZCNF1                                       056900020111                                                                                057000020111     C     *IN03         IFNE      '1'                                          057100020111     C     *IN12         ANDNE     '1'                                          057200020111     C*‚If confirmation received then delete record                             057300020111     C     xwbccd        chain(e)  custsr                                       057400020111     C                   if        %found(custs)                                057500020111     C                   delete(e) custsr                                       057600020111     C                   else                                                   057700020111     C                   unlock(e) custs                                        057800020111     C                   endif                                                  057900020111     C                   ENDIF                                                  058000020111                                                                                058100020111     C*‚End: If not F3/F12                                                      058200020111     C                   ENDIF                                                  058300020111                                                                                058400020111     C                   MOVE      SFLRRN        SHWREC                         058500020111                                                                                058600020111     C                   ENDSR                                                  058700020111     C**********************************************************************    058800020111                                                                                058900020111     C**********************************************************************    059000020111     C     DSPREC        BEGSR                                                  059100020111     C**********************************************************************    059200020111     C*‚Subroutine: Display a record                                            059300020111     C**********************************************************************    059400020111     C                   MOVE      '1'           *IN94                          059500020111     C                   MOVE      '0'           *IN96                          059600020111     C                   MOVE      '0'           *IN97                          059700020111     C                   MOVEL     ' DISPLAY'    ACTDSP                         059800020111     C                   EXSR      OFFIND                                       059900020111                                                                                060000020111     C                   EXSR      GETREC                                       060100020111                                                                                060200020111     C                   eval      pageno = 1                                   060300020111                                                                                060400020111     C*‚For each screen page                                                    060500020111     C                   dow       pageno <= noofpages                          060600020111                                                                                060700020111     C                   EXSR      DSPSCNS                                      060800020111                                                                                060900020111     C     *IN03         IFEQ      '1'                                          061000020111     C     *IN12         OREQ      '1'                                          061100020111     C                   LEAVE                                                  061200020111     C                   ENDIF                                                  061300020111                                                                                061400020111     C     *IN04         IFEQ      '1'                                          061500020111     C     *IN08         OREQ      '1'                                          061600020111     C     *IN09         OREQ      '1'                                          061700020111     C                   ITER                                                   061800020111     C                   ENDIF                                                  061900020111                                                                                062000020111     C                   eval      pageno = pageno + 1                          062100020111                                                                                062200020111     C*‚End: For each screen page                                               062300020111     C                   ENDDO                                                  062400020111                                                                                062500020111     C                   MOVE      SFLRRN        SHWREC                         062600020111                                                                                062700020111     C                   ENDSR                                                  062800020111     C**********************************************************************    062900020111                                                                                063000020111     C**********************************************************************    063100020111     C     GETREC        BEGSR                                                  063200020111     C**********************************************************************    063300020111     C*‚Subroutine: Retrieve a record                                           063400020111     C**********************************************************************    063500020111     C     XWBCCD        CHAIN(N)  CUSTS                              9966      063600020111                                                                                063700020111     C                   select                                                 063800020111     C*‚If record error                                                         063900020111     C                   WHEN      NOT %FOUND(CUSTS)                            064000020111     C                   MOVE      'OES0115'     MSGID                          064100020111     C                   CALL      RTNMTX                                       064200020111     C                   PARM                    MSGID             7            064300020111     C                   PARM                    ERRMSG          132            064400020111     C                   MOVEL     ERRMSG        ZMSAGE                         064500020111                                                                                064600020111     C*‚If file error                                                           064700020111     C                   WHEN      %ERROR(CUSTS)                                064800020111     C     FILESTS       IFEQ      1218                                         064900020111     C                   MOVE      'Y3U9999'     MSGID                          065000020111     C                   CALL      RTNMTX                                       065100020111     C                   PARM                    MSGID             7            065200020111     C                   PARM                    ERRMSG          132            065300020111     C                   MOVEL     ERRMSG        ZMSAGE                         065400020111     C                   ELSE                                                   065500020111     C                   MOVE      'OEM0004'     MSGID                          065600020111     C                   CALL      RTNMTX                                       065700020111     C                   PARM                    MSGID             7            065800020111     C                   PARM                    ERRMSG          132            065900020111     C                   MOVEL     ERRMSG        ZMSAGE                         066000020111     C                   ENDIF                                                  066100020111                                                                                066200020111     C*‚If no errors                                                            066300020111     C                   other                                                  066400020111                                                                                066500020111     C*‚Retrieve Salesman's name                                                066600020111     C     PERSON        CHAIN(E)  SLMEN                                        066700020111     C                   if        not %found(slmen)                            066800020111     C                   eval      pname = *all'-'                              066900020111     C                   endif                                                  067000020111                                                                                067100020111     C*‚Retrieve Distributor's name                                             067200020111     C     DSDCDE        CHAIN(E)  DISTS                                        067300020111     C                   if        not %found(dists)                            067400020111     C                   eval      dname = *all'-'                              067500020111     C                   endif                                                  067600020111                                                                                067700020111     C*‚Retrieve Customer Group's name                                          067800020111     C     XWBNCD        CHAIN(E)  CUSGRP                                       067900020111     C                   if        not %found(cusgrp)                           068000020111     C                   eval      xwkhtx = *all'-'                             068100020111     C                   endif                                                  068200020111                                                                                068300020111     C                   exsr      mvdbsc                                       068400020111                                                                                068500020111     C                   endsl                                                  068600020111                                                                                068700020111     C                   ENDSR                                                  068800020111     C**********************************************************************    068900020111                                                                                069000020111     C**********************************************************************    069100020111     C     *INZSR        BEGSR                                                  069200020111     C**********************************************************************    069300020111     C*‚Subroutine: Initialisation routines                                     069400020111     C**********************************************************************    069500020111     C*‚Initialise message subfile                                              069600020111     C                   MOVE      '1'           *IN82                          069700020111     C                   MOVEL     'WWCUSTS '    ZZPGM                          069800020111     C*-‚Set date                                                               069900020111     C                   MOVE      *DATE         ZZDATE                         070000020111     C                   MOVE      *YEAR         ZYR                            070100020111     C                   MOVE      '-'           FILLR1                         070200020111     C                   MOVE      *MONTH        ZMTH                           070300020111     C                   MOVE      '-'           FILLR2                         070400020111     C                   MOVE      *DAY          ZDAY                           070500020111     C                   ENDSR                                                  070600020111     C**********************************************************************    070700020111                                                                                070800020111     C**********************************************************************    070900020111     C     SRPROM        BEGSR                                                  071000020111     C**********************************************************************    071100020111     C*‚Subroutine: prompts for F04                                             071200020111     C**********************************************************************    071300020111     C                   SELECT                                                 071400020111     C     SFIELD        WHENEQ    'ZPERSON'                                    071500020111     C                   CALL      'SLMENSEL'                                   071600020111     C                   PARM                    ZPERSON                        071700020111     C                   PARM                    PNAME                          071800020111     C     SFIELD        WHENEQ    'ZCUSNO'                                     071900020111     C                   CALL      'CUSFSEL'                                    072000020111     C                   PARM      *ZEROS        CUSPRM            5 0          072100020111     C     CUSPRM        IFNE      *ZEROS                                       072200020111     C                   MOVE      CUSPRM        ZCUSNO                         072300020111     C                   ENDIF                                                  072400020111     C     SFIELD        WHENEQ    'ZWBNCD'                                     072500020111     C                   CALL      'CUSGRSEL'                                   072600020111     C                   PARM                    ZWBNCD                         072700020111     C                   PARM                    ZWKHTX                         072800020111     C     SFIELD        WHENEQ    'ZDSDCDE'                                    072900020111     C                   CALL      'DISTSSEL'                                   073000020111     C                   PARM                    ZDSDCDE                        073100020111     C                   PARM                    DNAME                          073200020111     C                   ENDSL                                                  073300020111     C                   ENDSR                                                  073400020111     C**********************************************************************    073500020111                                                                                073600020111     C**********************************************************************    073700020111     C     OFFIND        BEGSR                                                  073800020111     C**********************************************************************    073900020111     C*‚Subroutine: Set error indicators to OFF                                 074000020111     C**********************************************************************    074100020111     C                   MOVE      *OFF          *IN99                          074200020111     C                   MOVE      *OFF          *IN31                          074300020111     C                   MOVE      *OFF          *IN32                          074400020111     C                   MOVE      *OFF          *IN33                          074500020111     C                   MOVE      *OFF          *IN34                          074600020111     C                   MOVE      *OFF          *IN35                          074700020111     C                   MOVE      *OFF          *IN36                          074800020111     C                   MOVE      *OFF          *IN37                          074900020111     C                   MOVE      *BLANKS       ZMSAGE                         075000020111     C                   ENDSR                                                  075100020111     C**********************************************************************    075200020111                                                                                075300020111     C**********************************************************************    075400020111     C     ZORDER        BEGSR                                                  075500020111     C**********************************************************************    075600020111     C*‚Subroutine: Customer Orders                                             075700020111     C**********************************************************************    075800020111     C*    XWBCCD        CHAIN     CONHDRL1                           77        075900020111     C*    *IN77         IFEQ      '0'                                          076000020111     C                   CALL      'WWCONHDR'                                   076100020111     C                   PARM                    XWBCCD                         076200020111     C*                  ELSE                                                   076300020111     C*                  MOVE      '1'           *IN99                          076400020111     C*                  MOVE      'YYG0012'     MSGID                          076500020111     C*                  CALL      RTNMTX                                       076600020111     C*                  PARM                    MSGID             7            076700020111     C*                  PARM                    ERRMSG          132            076800020111     C* Display error message                                                   076900020111     C*                  MOVEL     ERRMSG        ZMSAGE                         077000020111     C*                  ENDIF                                                  077100020111     C                   ENDSR                                                  077200020111     C**********************************************************************    077300020111                                                                                077400020111     C**********************************************************************    077500020111     C     ZHISTO        BEGSR                                                  077600020111     C**********************************************************************    077700020111     C*‚Subroutine: Transaction history                                         077800020111     C**********************************************************************    077900020111     C*    XWBCCD        CHAIN     TRNHSTL3                           77        078000020111     C*    *IN77         IFEQ      '0'                                          078100020111     C                   CALL      'WWTRNHST'                                   078200020111     C                   PARM                    XWBCCD                         078300020111     C*                  ELSE                                                   078400020111     C*                  MOVE      '1'           *IN99                          078500020111     C*                  MOVE      'YYG0012'     MSGID                          078600020111     C*                  CALL      RTNMTX                                       078700020111     C*                  PARM                    MSGID             7            078800020111     C*                  PARM                    ERRMSG          132            078900020111     C* Display error message                                                   079000020111     C*                  MOVEL     ERRMSG        ZMSAGE                         079100020111     C*                  ENDIF                                                  079200020111     C                   ENDSR                                                  079300020111     C**********************************************************************    079400020111     C     MVDBSC        BEGSR                                                  079500020111     C                   MOVEL     XWBCCD        ZWBCCD                         079600020111     C                   MOVEL     XWG4TX        ZWG4TX                         079700020111     C                   MOVEL     XWB2CD        ZWB2CD                         079800020111     C                   MOVEL     XWB3CD        ZWB3CD                         079900020111     C                   MOVEL     XWHITX        ZWHITX                         080000020111     C                   MOVEL     XWE0NB        ZWE0NB                         080100020111     C                   MOVEL     XWJUN0        ZWJUN0                         080200020111     C                   MOVEL     XWDVCD        ZWDVCD                         080300020111     C                   MOVEL     XWBNCD        ZWBNCD                         080400020111     C                   MOVEL     PERSON        ZPERSON                        080500020111     C                   MOVEL     DSDCDE        ZDSDCDE                        080600020111     C                   MOVEL     XWBTCD        ZWBTCD                         080700020111     C                   MOVEL     XWGIVA        ZWGIVA                         080800020111     C                   MOVEL     XWAOCD        ZWAOCD                         080900020111     C                   MOVEL     XWBBCD        ZWBBCD                         081000020111     C                   MOVEL     XWG4T0        ZWG4T0                         081100020111     C                   MOVEL     XWC7ST        ZWC7ST                         081200020111     C                   MOVEL     XWDAST        ZWDAST                         081300020111     C                   MOVEL     XWBPD0        ZWBPD0                         081400020111     C                   MOVEL     XWBAD0        ZWBAD0                         081500020111     C                   MOVEL     XWKHTX        ZWKHTX                         081600020111     C                   MOVEL     XWF0VA        ZWF0VA                         081700020111     C                   MOVEL     XWASDT        ZWASDT                         081800020111     C                   MOVEL     XWF0V0        ZWF0V0                         081900020111     C                   MOVEL     XWBQDT        ZWBQDT                         082000020111     C                   MOVEL     XWF1VA        ZWF1VA                         082100020111     C                   MOVEL     XWF1V0        ZWF1V0                         082200020111     C                   MOVEL     XWF2VA        ZWF2VA                         082300020111     C                   MOVEL     XWF3VA        ZWF3VA                         082400020111     C                   MOVEL     XWF4VA        ZWF4VA                         082500020111     C                   MOVEL     XWF6VA        ZWF6VA                         082600020111     C                   MOVEL     XWIDV0        ZWIDV0                         082700020111     C                   MOVEL     XWGAVA        ZWGAVA                         082800020111     C                   MOVEL     XWGBVA        ZWGBVA                         082900020111     C                   MOVEL     XWGCVA        ZWGCVA                         083000020111     C                   MOVEL     XWGDVA        ZWGDVA                         083100020111     C                   MOVEL     XWGEVA        ZWGEVA                         083200020111     C                   MOVEL     XWGFVA        ZWGFVA                         083300020111     C                   MOVEL     XWGGVA        ZWGGVA                         083400020111     C                   MOVEL     CUSNO         ZCUSNO                         083500020111     C                   ENDSR                                                  083600020111     C**********************************************************************    083700020111     C     MVSCDB        BEGSR                                                  083800020111     C                   MOVEL     ZWBCCD        XWBCCD                         083900020111     C                   MOVEL     ZWG4TX        XWG4TX                         084000020111     C                   MOVEL     ZWB2CD        XWB2CD                         084100020111     C                   MOVEL     ZWB3CD        XWB3CD                         084200020111     C                   MOVEL     ZWHITX        XWHITX                         084300020111     C                   MOVEL     ZWE0NB        XWE0NB                         084400020111     C                   MOVEL     ZWJUN0        XWJUN0                         084500020111     C                   MOVEL     ZWDVCD        XWDVCD                         084600020111     C                   MOVEL     ZWBNCD        XWBNCD                         084700020111     C                   MOVEL     ZPERSON       PERSON                         084800020111     C                   MOVEL     ZDSDCDE       DSDCDE                         084900020111     C                   MOVEL     ZWBTCD        XWBTCD                         085000020111     C                   MOVEL     ZWGIVA        XWGIVA                         085100020111     C                   MOVEL     ZWAOCD        XWAOCD                         085200020111     C                   MOVEL     ZWBBCD        XWBBCD                         085300020111     C                   MOVEL     ZWG4T0        XWG4T0                         085400020111     C                   MOVEL     ZWC7ST        XWC7ST                         085500020111     C                   MOVEL     ZWDAST        XWDAST                         085600020111     C                   MOVEL     ZWBPD0        XWBPD0                         085700020111     C                   MOVEL     ZWBAD0        XWBAD0                         085800020111     C                   MOVEL     ZWKHTX        XWKHTX                         085900020111     C                   MOVEL     ZWF0VA        XWF0VA                         086000020111     C                   MOVEL     ZWASDT        XWASDT                         086100020111     C                   MOVEL     ZWF0V0        XWF0V0                         086200020111     C                   MOVEL     ZWBQDT        XWBQDT                         086300020111     C                   MOVEL     ZWF1VA        XWF1VA                         086400020111     C                   MOVEL     ZWF1V0        XWF1V0                         086500020111     C                   MOVEL     ZWF2VA        XWF2VA                         086600020111     C                   MOVEL     ZWF3VA        XWF3VA                         086700020111     C                   MOVEL     ZWF4VA        XWF4VA                         086800020111     C                   MOVEL     ZWF6VA        XWF6VA                         086900020111     C                   MOVEL     ZWIDV0        XWIDV0                         087000020111     C                   MOVEL     ZWGAVA        XWGAVA                         087100020111     C                   MOVEL     ZWGBVA        XWGBVA                         087200020111     C                   MOVEL     ZWGCVA        XWGCVA                         087300020111     C                   MOVEL     ZWGDVA        XWGDVA                         087400020111     C                   MOVEL     ZWGEVA        XWGEVA                         087500020111     C                   MOVEL     ZWGFVA        XWGFVA                         087600020111     C                   MOVEL     ZWGGVA        XWGGVA                         087700020111     C                   MOVEL     ZCUSNO        CUSNO                          087800020111     C                   ENDSR                                                  087900020111     C**********************************************************************    