000100070317     H*‚--------------------------------------------------------------------    000200071221     H*ˆCOPYRIGHT DATABOROUGH LTD 2007                                          000300070212     H*ˆPROGRAM:  Work with Customers                                           000400010705     H*‚--------------------------------------------------------------------    000500070131     H DATEDIT(*YMD)                                                            000600980122     F**********************************************************************    000700990528     F*‚F i l e s                                                               000800980122     F**********************************************************************    000900101230     FWCUSTSD2  CF   E             WORKSTN                                      001000070130     F                                     SFILE(ZZSF01:SFLRRN)                 001100110426     FCUSTS     UF A E           K DISK    Prefix(N_)                           001200070813     F                                     INFDS(FILEDS)                        001300070213     FSLMEN     IF   E           K DISK                                         001400070213     FCUSFL3    IF   E           K DISK                                         001500110426     FCUSGRP    IF   E           K DISK    prefix(NN)                           001600070213     FDISTS     IF   E           K DISK                                         001700070213     FCONHDRL1  IF   E           K DISK                                         001800070213     FTRNHSTL3  IF   E           K DISK                                         001900070213     D**********************************************************************    002000070213     D*‚D e f i n i t i o n s                                                   002100070213     D**********************************************************************    002200070130     D*‚Set constants                                                           002300070131     D RTNMTX          C                   CONST('RTNMSGTEXT')                  002400070213     D INIDAT          C                   CONST('0001-01-01')                  002500070813                                                                                002600070813     d FILEDS          ds                                                       002700070813     d  FILESTS               11     15s 0                                      002800070303                                                                                002900070305     D  pageno         s              3p 0                                      003000070305     D  noofpages      s              3p 0 inz(2)                               003100070305     D  sflrrn         s              5p 0                                      003200070305     D  sflchg         s              1a   inz('0')                             003300070303                                                                                003400070205     D                 DS                  INZ                                  003500070213     D  ZDATE                  1     10                                         003600070205     D  ZYR                    1      4                                         003700070205     D  FILLR1                 5      5                                         003800070205     D  ZMTH                   6      7                                         003900070205     D  FILLR2                 8      8                                         004000070205     D  ZDAY                   9     10                                         004100101230                                                                                004200110426     D  uwcuid         s                   like(n_xwbccd)                       004300070303                                                                                004400070130     I**********************************************************************    004500070213     IRCUSF                                                                     004600070213     I              DSDCDE                      XSDCDE                          004700070305                                                                                004800070303     C**********************************************************************    004900070130     C*‚M a i n l i n e   C o d e                                               005000070303     C**********************************************************************    005100070202     C*‚Build subfile                                                           005200070202     C                   EXSR      SFLWRT                                       005300070305                                                                                005400070130     C     *IN03         DOWEQ     '0'                                          005500070130     C     *IN12         ANDEQ     '0'                                          005600070212     C                   MOVE      *BLANKS       LOCATE                         005700070219     C*‚Display screens                                                         005800070201     C                   WRITE     ZZTR01                                       005900070215     C   99              WRITE     ZZMC01                                       006000070131     C                   EXFMT     ZZCT01                                       006001110913     C**                 EXFMT     ZZCT02                                       006100070219     C*‚Remove messages                                                         006200070130     C                   CALL      'XBCCLMSG'                                   006300070131     C     *IN03         IFEQ      '1'                                          006400070131     C     *IN12         OREQ      '1'                                          006500070131     C                   LEAVE                                                  006600070131     C                   ENDIF                                                  006700070303     C*‚Action positioner request                                               006800070212     C     LOCATE        IFNE      *BLANKS                                      006900110426     C                   MOVE      LOCATE        N_XWBCCD                       007000070202     C                   EXSR      SFLWRT                                       007100070202     C                   ITER                                                   007200070202     C                   ENDIF                                                  007300070219     C*‚Action command keys                                                     007400070130     C     *IN28         IFEQ      '1'                                          007500070130     C                   EXSR      CMDKEY                                       007600070130     C                   ELSE                                                   007700070219     C*‚Else action selections                                                  007800070130     C                   EXSR      ZSELEC                                       007900070130     C                   ENDIF                                                  008000070219     C*‚If changes made then update display                                     008100070209     C     SFLCHG        IFEQ      '1'                                          008200110426     C                   MOVE      *LOVAL        N_XWBCCD                       008300070209     C                   EXSR      SFLWRT                                       008400070209     C                   ENDIF                                                  008500071221                                                                                008600070130     C                   ENDDO                                                  008700070305                                                                                008800070131     C                   MOVE      '1'           *INLR                          008900070131     C                   RETURN                                                 009000070303     C**********************************************************************    009100070130     C*‚L o g i c a l   E n d   o f   P r o g r a m                             009200070303     C**********************************************************************    009300070303                                                                                009400070303     C**********************************************************************    009500070130     C     SFLWRT        BEGSR                                                  009600070303     C**********************************************************************    009700070130     C*‚Subroutine: Write data to subfile                                       009800070303     C**********************************************************************    009900070130     C*‚Delete subfile                                                          010000070131     C                   SETON                                        74        010100070213     C                   SETOFF                                       717281    010200070131     C                   WRITE     ZZCT01                               99      010300070131     C                   SETOFF                                       74        010400070130     C*‚Write subfile                                                           010500070130     C                   MOVE      *ZEROS        SFLRRN                         010600110426     C     N_XWBCCD      SETLL     CUSTS                                        010700070216     C                   READ(N)   CUSTS                                  81    010800070213     C     *IN81         DOWEQ     '0'                                          010900070130     C                   ADD       1             SFLRRN                         011000070130     C                   MOVE      *BLANKS       DSSEL                          011100070130     C                   WRITE     ZZSF01                               99      011200070216     C                   READ(N)   CUSTS                                  81    011300070130     C                   ENDDO                                                  011400070303                                                                                011500070130     C     SFLRRN        IFGT      *ZEROS                                       011600070130     C     SFLCHG        IFEQ      '0'                                          011700070305     C                   Z-ADD     1             SHWREC                         011800070130     C                   ENDIF                                                  011900070305     C     SHWREC        IFGT      SFLRRN                                       012000070305     C     SHWREC        ORLT      1                                            012100070305     C                   Z-ADD     1             SHWREC                         012200070130     C                   ENDIF                                                  012300070131     C                   SETON                                        71        012400070130     C                   ENDIF                                                  012500070131     C                   SETON                                        72        012600071221                                                                                012700070130     C                   ENDSR                                                  012800070303     C**********************************************************************    012900070305                                                                                013000070305     C**********************************************************************    013100070305     C     CMDKEY        BEGSR                                                  013200070305     C**********************************************************************    013300070305     C*‚Subroutine: Action command keys                                         013400070305     C**********************************************************************    013500070305     C                   SELECT                                                 013600070305                                                                                013700070305     C     *IN06         WHENEQ    '1'                                          013800070305     C                   EXSR      addrec                                       013900101230     C                   Z-ADD     1             SHWREC                         014000101230     C                   MOVE      '1'           SFLCHG                         014001110913     C**                 MOVE      '0'           SFLCHG                         014100101230     C     *IN08         WHENEQ    '1'                                          014200101230     C                   EXSR      Print                                        014300101230     C     *IN09         WHENEQ    '1'                                          014400101230     C                   EXSR      Print                                        014500070305     C                   ENDSL                                                  014600070305                                                                                014700070305     C                   MOVE      '0'           *IN12                          014800070305                                                                                014900070305     C                   ENDSR                                                  015000070305     C**********************************************************************    015100070303                                                                                015200070303     C**********************************************************************    015300070130     C     ZSELEC        BEGSR                                                  015400070303     C**********************************************************************    015500070130     C*‚Subroutine: Action selection                                            015600070303     C**********************************************************************    015700070130     C                   MOVE      '0'           SFLCHG                         015800070130     C                   READC     ZZSF01                                 35    015900070305                                                                                016000070130     C*‚For each selection                                                      016100070130     C     *IN35         DOWEQ     '0'                                          016200070130     C                   MOVE      '1'           SFLCHG                         016300070303                                                                                016400070213     C                   SELECT                                                 016500070219     C*‚Change                                                                  016600070213     C     DSSEL         WHENEQ    '2'                                          016700070305     C                   EXSR      chgrec                                       016800101230     C*‚Print Orders                                                            016900101230     C     DSSEL         WHENEQ    '3'                                          017000101230     C     DSSEL         OREQ      '7'                                          017100110426     C                   eval      uwcuid = N_XWBCCD                            017200101230     C                   EXSR      print                                        017300101230     C                   eval      uwcuid = *blanks                             017400070219     C*‚Delete                                                                  017500070303     C     DSSEL         WHENEQ    '4'                                          017600070305     C                   EXSR      delrec                                       017700070219     C*‚Display                                                                 017800070303     C     DSSEL         WHENEQ    '5'                                          017900070305     C                   EXSR      dsprec                                       018000070718     C*‚Customer Detail Maintenance                                             018100070718     C     DSSEL         WHENEQ    '6'                                          018200070809     C                   call      'CUSTMNT1'                                   018300110426     C                   parm                    N_XWBCCD                       018600070305     C*‚Work with Orders                                                        018700070213     C     DSSEL         WHENEQ    '8'                                          018800090304     C                   EXSR      ZORDER                                       018900070305     C*‚Work with Transaction history                                           019000070213     C     DSSEL         WHENEQ    '9'                                          019100090304     C                   EXSR      ZHISTO                                       019200070213     C                   ENDSL                                                  019300070303                                                                                019400070130     C                   MOVE      *BLANKS       DSSEL                          019500070130     C                   UPDATE    ZZSF01                               99      019600070130     C                   READC     ZZSF01                                 35    019700070305                                                                                019800070219     C*‚End: For each selection                                                 019900070130     C                   ENDDO                                                  020000070303                                                                                020100070130     C                   MOVE      '0'           *IN12                          020200070303                                                                                020300070130     C                   ENDSR                                                  020400101230                                                                                020500101230     C**********************************************************************    020600101230     C     print         BEGSR                                                  020700101230     C**********************************************************************    020800101230     C*‚Subroutine: Print customer orders/Transaction history                   020900101230     C**********************************************************************    021000101230     C*‚Call printing program based on the option selected                      021100101230     C                   Select                                                 021200101230     C                   When      *In08 = *On or Dssel ='3'                    021300101230     C                   Call      'CUSTRPT01'                                  021400101230     C                   Parm                    uwcuid                         021500101230     C                   When      *In09 = *On or Dssel = '7'                   021600101230     C                   Call      'CUSTRPT02'                                  021700101230     C                   Parm                    uwcuid                         021800101230     C                   endsl                                                  021900101230     C                                                                          022000101230     C                   ENDSR                                                  022100070303     C**********************************************************************    022200070303                                                                                022300070303     C**********************************************************************    022400070305     C     dspscns       BEGSR                                                  022500070303     C**********************************************************************    022600070305     C*‚Subroutine: Display detail screens                                      022700070303     C**********************************************************************    022800070305     C*‚Display screen, depending upon page no.                                 022900070305     C                   select                                                 023000070305     C                   when      pageno = 1                                   023100070305     C                   EXFMT     ZZFT01                                       023200070305     C                   when      pageno = 2                                   023300070305     C                   EXFMT     ZZFT02                                       023400070305     C                   endsl                                                  023500080208     C                   EXSR      MVSCDB                                       023600070305                                                                                023700070130     C                   CALL      'XBCCLMSG'                                   023800070306     C                   EXSR      OFFIND                                       023900070305                                                                                024000070305     C*‚Process Command Keys                                                    024100070212     C                   SELECT                                                 024200070305     C*‚Prompt                                                                  024300070212     C     *IN04         WHENEQ    '1'                                          024400070213     C                   EXSR      SRPROM                                       024500070219     C*‚Orders                                                                  024600070213     C     *IN08         WHENEQ    '1'                                          024700090304     C                   EXSR      ZORDER                                       024800070219     C*‚Transaction history                                                     024900070213     C     *IN09         WHENEQ    '1'                                          025000090304     C                   EXSR      ZHISTO                                       025100070201     C                   ENDSL                                                  025200070305                                                                                025300070130     C                   ENDSR                                                  025400070305     C**********************************************************************    025500070305                                                                                025600070305     C**********************************************************************    025700070216     C     VALID1        BEGSR                                                  025800070305     C**********************************************************************    025900070305     C*‚Subroutine: Validation #1                                               026000070305     C**********************************************************************    026100070201     C                   DO                                                     026200070219     C* WHEN ADDING CUSTOMER MUST NOT BE ZERO                                   026300110426     C     N_XWBCCD      IFEQ      *BLANKS                                      026400070209     C                   MOVE      '1'           *IN99                          026500070212     C                   MOVE      *ON           *IN31                          026600070213     C                   MOVE      'OEM0002'     MSGID                          026700070209     C                   CALL      RTNMTX                                       026800070209     C                   PARM                    MSGID             7            026900070209     C                   PARM                    ERRMSG          132            027000070209     C                   LEAVE                                                  027100070209     C                   ENDIF                                                  027200070219     C* WHEN ADDING CUSTOMER MUST NOT EXIST                                     027300090303     C     ACTDSP        IFEQ      'ADDITION'                                   027400110426     C     N_XWBCCD      SETLL     CUSTS                                  99    027500070209     C     *IN99         IFEQ      '1'                                          027600070212     C                   MOVE      *ON           *IN31                          027700070209     C                   MOVE      'Y2U0003'     MSGID                          027800110426     C                   MOVEL     *ALL'-'       N_XWG4TX                       027900070209     C                   CALL      RTNMTX                                       028000070209     C                   PARM                    MSGID             7            028100070209     C                   PARM                    ERRMSG          132            028200070209     C                   LEAVE                                                  028300070209     C                   ENDIF                                                  028400070209     C                   ENDIF                                                  028500070219     C*‚Customer name                                                           028600110426     C     N_XWG4TX      IFEQ      *BLANKS                                      028700070212     C                   MOVE      *ON           *IN32                          028800070212     C                   MOVE      *ON           *IN99                          028900070212     C                   MOVE      'OEM0012'     MSGID                          029000070212     C                   CALL      RTNMTX                                       029100070212     C                   PARM                    MSGID             7            029200070212     C                   PARM                    ERRMSG          132            029300070212     C                   LEAVE                                                  029400070212     C                   ENDIF                                                  029500070219     C*- CUSTOMER GROUP                                                         029600110426     C     N_XWBNCD      CHAIN     CUSGRP                             99        029700070213     C     *IN99         IFEQ      '1'                                          029800070213     C                   MOVE      '1'           *IN33                          029900070213     C                   MOVE      'OES0374'     MSGID                          030000110426     C                   MOVEL     *ALL'-'       NNXWKHTX                       030100070213     C                   CALL      RTNMTX                                       030200070213     C                   PARM                    MSGID             7            030300070213     C                   PARM                    ERRMSG          132            030400070213     C                   LEAVE                                                  030500070213     C                   ENDIF                                                  030600070219     C*- SALESMAN                                                               030700110426     C     N_PERSON      CHAIN     SLMEN                              99        030800070213     C     *IN99         IFEQ      '1'                                          030900070213     C                   MOVE      '1'           *IN34                          031000070213     C                   MOVE      'OEM0023'     MSGID                          031100070213     C                   CALL      RTNMTX                                       031200070213     C                   PARM                    MSGID             7            031300070213     C                   PARM                    ERRMSG          132            031400070213     C                   MOVE      *ALL'-'       PNAME                          031500070213     C                   LEAVE                                                  031600070213     C                   ENDIF                                                  031700070219     C*- Distributor                                                            031800110426     C     N_DSDCDE      CHAIN     DISTS                              99        031900070213     C     *IN99         IFEQ      '1'                                          032000070213     C                   MOVE      '1'           *IN35                          032100070213     C                   MOVE      'OEM0018'     MSGID                          032200070213     C                   CALL      RTNMTX                                       032300070213     C                   PARM                    MSGID             7            032400070213     C                   PARM                    ERRMSG          132            032500070213     C                   MOVE      *ALL'-'       DNAME                          032600070213     C                   LEAVE                                                  032700070213     C                   ENDIF                                                  032800070201     C                   ENDDO                                                  032900070131     C                   ENDSR                                                  033000070305     C**********************************************************************    033100070305                                                                                033200070305     C**********************************************************************    033300070216     C     VALID2        BEGSR                                                  033400070305     C**********************************************************************    033500070305     C*‚Subroutine: Validation #2                                               033600070305     C**********************************************************************    033700070216     C                   DO                                                     033800070219     C*- BALANCE                                                                033900090401     C     ACTDSP        IFNE      'ADDITION'                                   034000110426     C     N_XWGIVA      SUB       N_XWIDV0      XDIFF            15 2          034100090401     C     XDIFF         IFLT      *ZERO                                        034200090401     C                   MOVE      '1'           *IN99                          034300090401     C                   MOVE      '1'           *IN36                          034400090401     C                   MOVE      'OES0373'     MSGID                          034500090401     C                   CALL      RTNMTX                                       034600090401     C                   PARM                    MSGID             7            034700090401     C                   PARM                    ERRMSG          132            034800090401     C                   LEAVE                                                  034900090401     C                   ENDIF                                                  035000090401     C                   ENDIF                                                  035100070219     C*- CUSTOMER CANNOT BE ZERO                                                035200110426     C     N_CUSNO       IFEQ      *ZEROS                                       035300070216     C                   MOVE      '1'           *IN37                          035400070216     C                   MOVE      '1'           *IN99                          035500070216     C                   MOVE      'CNP0008'     MSGID                          035600070216     C                   CALL      RTNMTX                                       035700070216     C                   PARM                    MSGID             7            035800070216     C                   PARM                    ERRMSG          132            035900070216     C                   LEAVE                                                  036000070216     C                   ENDIF                                                  036100070219     C*- CUSTOMER                                                               036200110426     C     N_CUSNO       CHAIN     CUSFL3                             99        036300070216     C     *IN99         IFEQ      '1'                                          036400070216     C                   MOVE      '1'           *IN37                          036500070216     C                   MOVE      'CNP0002'     MSGID                          036600070216     C                   CALL      RTNMTX                                       036700070216     C                   PARM                    MSGID             7            036800070216     C                   PARM                    ERRMSG          132            036900070216     C                   LEAVE                                                  037000070216     C                   ENDIF                                                  037100070216     C                   ENDDO                                                  037200070216     C                   ENDSR                                                  037300070305     C**********************************************************************    037400070305                                                                                037500070305     C**********************************************************************    037600070305     C     ADDREC        BEGSR                                                  037700070305     C**********************************************************************    037800070305     C*‚Subroutine: Add a record                                                037900070305     C**********************************************************************    038000070305     C                   MOVE      '0'           *IN94                          038100070305     C                   MOVE      '1'           *IN96                          038200070305     C                   MOVE      '0'           *IN97                          038300070305     C                   MOVEL     'ADDITION'    ACTDSP                         038400070306     C                   EXSR      OFFIND                                       038500070305                                                                                038600070305     C                   clear                   custsr                         038700080208     C                   eval      pname = *blanks                              038800080208     C                   eval      dname = *blanks                              038900110426     C                   eval      NNXWKHTX = *blanks                           039000080208     C                   exsr      mvdbsc                                       039100070305                                                                                039200070305     C                   eval      pageno = 1                                   039300070305                                                                                039400070305     C*‚For each screen page                                                    039500070305     C                   dow       pageno <= noofpages                          039600070305                                                                                039700070305     C                   EXSR      DSPSCNS                                      039800070305                                                                                039900070305     C     *IN03         IFEQ      '1'                                          040000070305     C     *IN12         OREQ      '1'                                          040100070305     C                   LEAVE                                                  040200070305     C                   ENDIF                                                  040300070305                                                                                040400070305     C     *IN04         IFEQ      '1'                                          040500070305     C     *IN08         OREQ      '1'                                          040600070305     C     *IN09         OREQ      '1'                                          040700070305     C                   ITER                                                   040800070305     C                   ENDIF                                                  040900070305                                                                                041000070305     C                   select                                                 041100070305     C                   when      pageno = 1                                   041200070305     C                   EXSR      VALID1                                       041300070305     C                   when      pageno = 2                                   041400070305     C                   EXSR      VALID2                                       041500070305     C                   endsl                                                  041600070305                                                                                041700070305     C*‚If errors found                                                         041800070305     C     *IN99         IFEQ      '1'                                          041900070305     C*‚Display error message and re-display screen                             042000070305     C                   MOVEL     ERRMSG        ZMSAGE                         042100080208     C                   exsr      mvdbsc                                       042200070305     C                   iter                                                   042300070305     C                   ENDIF                                                  042400070305                                                                                042500070305     C                   eval      pageno = pageno + 1                          042600070305                                                                                042700070305     C*‚End: For each screen page                                               042800070305     C                   ENDDO                                                  042900070305                                                                                043000070305     C*‚If not F3/F12                                                           043100070305     C     *IN03         IFNE      '1'                                          043200070305     C     *IN12         ANDNE     '1'                                          043300070305                                                                                043400070309     C*‚Request confirmation                                                    043500070309     C                   EXFMT     ZZCNF1                                       043600070309     C     *IN03         IFNE      '1'                                          043700070309     C     *IN12         ANDNE     '1'                                          043800070309     C*‚If confirmation received then write record                              043900070305     C                   WRITE     CUSTSR                               99      044000070305     C     *IN99         IFEQ      '1'                                          044100070305     C                   MOVE      'Y2U0004'     MSGID                          044200070305     C                   CALL      RTNMTX                                       044300070305     C                   PARM                    MSGID             7            044400070305     C                   PARM                    ERRMSG          132            044500070305     C* Display error message                                                   044600070305     C                   MOVEL     ERRMSG        ZMSAGE                         044700070305     C                   ENDIF                                                  044800070309     C                   ENDIF                                                  044900070305                                                                                045000070305     C*‚End: If not F3/F12                                                      045100070305     C                   ENDIF                                                  045200070305                                                                                045300070305     C                   ENDSR                                                  045400070305     C**********************************************************************    045500070305                                                                                045600070305     C**********************************************************************    045700070305     C     CHGREC        BEGSR                                                  045800070305     C**********************************************************************    045900070305     C*‚Subroutine: Change a record                                             046000070305     C**********************************************************************    046100070305     C                   MOVEL     '  UPDATE'    ACTDSP                         046200070305     C                   MOVE      '0'           *IN94                          046300070306     C                   MOVE      '0'           *IN96                          046400070305     C                   MOVE      '0'           *IN97                          046500070306     C                   EXSR      OFFIND                                       046600070305                                                                                046700070305     C                   EXSR      GETREC                                       046800070813                                                                                046900080117     C*‚If no record or file error                                              047000070813     C     *IN99         IFEQ      *OFF                                         047100070813     C     *IN66         ANDEQ     *OFF                                         047200070305                                                                                047300070305     C                   eval      pageno = 1                                   047400070305                                                                                047500070305     C*‚For each screen page                                                    047600070305     C                   dow       pageno <= noofpages                          047700070305                                                                                047800070305     C                   EXSR      DSPSCNS                                      047900070305                                                                                048000070305     C     *IN03         IFEQ      '1'                                          048100070305     C     *IN12         OREQ      '1'                                          048200070305     C                   LEAVE                                                  048300070305     C                   ENDIF                                                  048400070305                                                                                048500070305     C     *IN04         IFEQ      '1'                                          048600070305     C     *IN08         OREQ      '1'                                          048700070305     C     *IN09         OREQ      '1'                                          048800070305     C                   ITER                                                   048900070305     C                   ENDIF                                                  049000070305                                                                                049100070305     C                   select                                                 049200070305     C                   when      pageno = 1                                   049300070305     C                   EXSR      VALID1                                       049400070305     C                   when      pageno = 2                                   049500070305     C                   EXSR      VALID2                                       049600070305     C                   endsl                                                  049700070305                                                                                049800070305     C*‚If errors found                                                         049900070305     C     *IN99         IFEQ      '1'                                          050000070305     C*‚Display error message and re-display screen                             050100070305     C                   MOVEL     ERRMSG        ZMSAGE                         050200080208     C                   exsr      mvdbsc                                       050300080208     C                   iter                                                   050400070305     C                   ENDIF                                                  050500070305                                                                                050600070305     C                   eval      pageno = pageno + 1                          050700070305                                                                                050800070305     C*‚End: For each screen page                                               050900070305     C                   ENDDO                                                  051000070305                                                                                051100070305     C*‚If not F3/F12                                                           051200070305     C     *IN03         IFNE      '1'                                          051300070305     C     *IN12         ANDNE     '1'                                          051400070305                                                                                051500070305     C*‚Request confirmation                                                    051600070305     C                   EXFMT     ZZCNF1                                       051700070305     C     *IN03         IFNE      '1'                                          051800070305     C     *IN12         ANDNE     '1'                                          051900070305     C*‚If confirmation received then update record                             052000110426     C     N_XWBCCD      chain(e)  custsr                                       052100080117     C                   if        %found(custs)                                052200080208     C                   exsr      mvscdb                                       052300070305     C                   UPDATE    CUSTSR                               99      052400070305     C     *IN99         IFEQ      '1'                                          052500070305     C                   MOVE      'Y2U0007'     MSGID                          052600070305     C                   CALL      RTNMTX                                       052700070305     C                   PARM                    MSGID             7            052800070305     C                   PARM                    ERRMSG          132            052900070305     C* Display error message                                                   053000070305     C                   MOVEL     ERRMSG        ZMSAGE                         053100070305     C                   ENDIF                                                  053200080117     C                   else                                                   053300080117     C                   unlock(e) custs                                        053400080117     C                   endif                                                  053500070305     C                   ENDIF                                                  053600080117                                                                                053700080117     C*‚End: If not F3/F12                                                      053800080117     C                   ENDIF                                                  053900080117                                                                                054000080117     C*‚End: If no record or file error                                         054100070813     C                   ENDIF                                                  054200070305                                                                                054300070305     C                   MOVE      SFLRRN        SHWREC                         054400070305                                                                                054500070305     C                   ENDSR                                                  054600070305     C**********************************************************************    054700070305                                                                                054800070305     C**********************************************************************    054900070305     C     DELREC        BEGSR                                                  055000070305     C**********************************************************************    055100070305     C*‚Subroutine: Delete a record                                             055200070305     C**********************************************************************    055300070305     C                   MOVEL     '  DELETE'    ACTDSP                         055400070305     C                   MOVE      '1'           *IN94                          055500070306     C                   MOVE      '0'           *IN96                          055600070305     C                   MOVE      '1'           *IN97                          055700070306     C                   EXSR      OFFIND                                       055800070305                                                                                055900070305     C                   EXSR      GETREC                                       056000070305                                                                                056100070305     C                   eval      pageno = 1                                   056200070305                                                                                056300070305     C*‚For each screen page                                                    056400070305     C                   dow       pageno <= noofpages                          056500070305                                                                                056600070305     C                   EXSR      DSPSCNS                                      056700070305                                                                                056800070305     C     *IN03         IFEQ      '1'                                          056900070305     C     *IN12         OREQ      '1'                                          057000070305     C                   LEAVE                                                  057100070305     C                   ENDIF                                                  057200070305                                                                                057300070305     C     *IN04         IFEQ      '1'                                          057400070305     C     *IN08         OREQ      '1'                                          057500070305     C     *IN09         OREQ      '1'                                          057600070305     C                   ITER                                                   057700070305     C                   ENDIF                                                  057800070305                                                                                057900070305     C                   eval      pageno = pageno + 1                          058000070305                                                                                058100070305     C*‚End: For each screen page                                               058200070305     C                   ENDDO                                                  058300070305                                                                                058400070309     C*‚If not F3/F12                                                           058500070309     C     *IN03         IFNE      '1'                                          058600070309     C     *IN12         ANDNE     '1'                                          058700070309                                                                                058800070309     C*‚Request confirmation                                                    058900070309     C                   EXFMT     ZZCNF1                                       059000080117                                                                                059100070309     C     *IN03         IFNE      '1'                                          059200070309     C     *IN12         ANDNE     '1'                                          059300070309     C*‚If confirmation received then delete record                             059400110426     C     N_XWBCCD      chain(e)  custsr                                       059500080117     C                   if        %found(custs)                                059600080117     C                   delete(e) custsr                                       059700080117     C                   else                                                   059800080117     C                   unlock(e) custs                                        059900080117     C                   endif                                                  060000080117     C                   ENDIF                                                  060100070309                                                                                060200070309     C*‚End: If not F3/F12                                                      060300070309     C                   ENDIF                                                  060400070305                                                                                060500070305     C                   MOVE      SFLRRN        SHWREC                         060600070305                                                                                060700070305     C                   ENDSR                                                  060800070305     C**********************************************************************    060900070305                                                                                061000070305     C**********************************************************************    061100070305     C     DSPREC        BEGSR                                                  061200070305     C**********************************************************************    061300070305     C*‚Subroutine: Display a record                                            061400070305     C**********************************************************************    061500070305     C                   MOVE      '1'           *IN94                          061600070306     C                   MOVE      '0'           *IN96                          061700070305     C                   MOVE      '0'           *IN97                          061800070305     C                   MOVEL     ' DISPLAY'    ACTDSP                         061900070306     C                   EXSR      OFFIND                                       062000070305                                                                                062100070305     C                   EXSR      GETREC                                       062200080117                                                                                062300070305     C                   eval      pageno = 1                                   062400070305                                                                                062500070305     C*‚For each screen page                                                    062600070305     C                   dow       pageno <= noofpages                          062700070305                                                                                062800070305     C                   EXSR      DSPSCNS                                      062900070305                                                                                063000070305     C     *IN03         IFEQ      '1'                                          063100070305     C     *IN12         OREQ      '1'                                          063200070305     C                   LEAVE                                                  063300070305     C                   ENDIF                                                  063400070305                                                                                063500070305     C     *IN04         IFEQ      '1'                                          063600070305     C     *IN08         OREQ      '1'                                          063700070305     C     *IN09         OREQ      '1'                                          063800070305     C                   ITER                                                   063900070305     C                   ENDIF                                                  064000070305                                                                                064100070305     C                   eval      pageno = pageno + 1                          064200070305                                                                                064300070305     C*‚End: For each screen page                                               064400070305     C                   ENDDO                                                  064500070305                                                                                064600070305     C                   MOVE      SFLRRN        SHWREC                         064700070305                                                                                064800070305     C                   ENDSR                                                  064900070305     C**********************************************************************    065000070305                                                                                065100070305     C**********************************************************************    065200070305     C     GETREC        BEGSR                                                  065300070305     C**********************************************************************    065400070305     C*‚Subroutine: Retrieve a record                                           065500070305     C**********************************************************************    065600110426     C     N_XWBCCD      CHAIN(N)  CUSTS                              9966      065700071221                                                                                065800071221     C                   select                                                 065900071221     C*‚If record error                                                         066000071221     C                   when      *in99 = *on                                  066100070813     C                   MOVE      'OES0115'     MSGID                          066200070305     C                   CALL      RTNMTX                                       066300070305     C                   PARM                    MSGID             7            066400070305     C                   PARM                    ERRMSG          132            066500070305     C                   MOVEL     ERRMSG        ZMSAGE                         066600071221                                                                                066700071221     C*‚If file error                                                           066800071221     C                   when      *in66 = *on                                  066900070813     C     FILESTS       IFEQ      1218                                         067000070813     C                   MOVE      'Y3U9999'     MSGID                          067100070813     C                   CALL      RTNMTX                                       067200070813     C                   PARM                    MSGID             7            067300070813     C                   PARM                    ERRMSG          132            067400070813     C                   MOVEL     ERRMSG        ZMSAGE                         067500070813     C                   ELSE                                                   067600070813     C                   MOVE      'OEM0004'     MSGID                          067700070813     C                   CALL      RTNMTX                                       067800070813     C                   PARM                    MSGID             7            067900070813     C                   PARM                    ERRMSG          132            068000070813     C                   MOVEL     ERRMSG        ZMSAGE                         068100070813     C                   ENDIF                                                  068200071221                                                                                068300071221     C*‚If no errors                                                            068400071221     C                   other                                                  068500070305                                                                                068600071221     C*‚Retrieve Salesman's name                                                068700110426     C     N_PERSON      CHAIN(E)  SLMEN                                        068800071221     C                   if        not %found(slmen)                            068900071221     C                   eval      pname = *all'-'                              069000071221     C                   endif                                                  069100071221                                                                                069200071221     C*‚Retrieve Distributor's name                                             069300110426     C     N_DSDCDE      CHAIN(E)  DISTS                                        069400071221     C                   if        not %found(dists)                            069500071221     C                   eval      dname = *all'-'                              069600071221     C                   endif                                                  069700071221                                                                                069800071221     C*‚Retrieve Customer Group's name                                          069900110426     C     N_XWBNCD      CHAIN(E)  CUSGRP                                       070000071221     C                   if        not %found(cusgrp)                           070100110426     C                   eval      nnxwkhtx = *all'-'                           070200071221     C                   endif                                                  070300080117                                                                                070400080208     C                   exsr      mvdbsc                                       070500071221                                                                                070600071221     C                   endsl                                                  070700071221                                                                                070800070305     C                   ENDSR                                                  070900070305     C**********************************************************************    071000070305                                                                                071100070305     C**********************************************************************    071200070130     C     *INZSR        BEGSR                                                  071300070305     C**********************************************************************    071400070130     C*‚Subroutine: Initialisation routines                                     071500070305     C**********************************************************************    071600070130     C*‚Initialise message subfile                                              071700070213     C                   MOVE      '1'           *IN82                          071800070212     C                   MOVEL     'WWCUSTS '    ZZPGM                          071900070130     C*-‚Set date                                                               072000070130     C                   MOVE      *DATE         ZZDATE                         072100070205     C                   MOVE      *YEAR         ZYR                            072200070205     C                   MOVE      '-'           FILLR1                         072300070205     C                   MOVE      *MONTH        ZMTH                           072400070205     C                   MOVE      '-'           FILLR2                         072500070205     C                   MOVE      *DAY          ZDAY                           072600070130     C                   ENDSR                                                  072700070305     C**********************************************************************    072800070305                                                                                072900070305     C**********************************************************************    073000070213     C     SRPROM        BEGSR                                                  073100070305     C**********************************************************************    073200070213     C*‚Subroutine: prompts for F04                                             073300070305     C**********************************************************************    073400070213     C                   SELECT                                                 073500080208     C     SFIELD        WHENEQ    'ZPERSON'                                    073600070213     C                   CALL      'SLMENSEL'                                   073700080208     C                   PARM                    ZPERSON                        073800070213     C                   PARM                    PNAME                          073900080208     C     SFIELD        WHENEQ    'ZCUSNO'                                     074000070213     C                   CALL      'CUSFSEL'                                    074100070213     C                   PARM      *ZEROS        CUSPRM            5 0          074200070213     C     CUSPRM        IFNE      *ZEROS                                       074300080208     C                   MOVE      CUSPRM        ZCUSNO                         074400070213     C                   ENDIF                                                  074500080208     C     SFIELD        WHENEQ    'ZWBNCD'                                     074600070213     C                   CALL      'CUSGRSEL'                                   074700080208     C                   PARM                    ZWBNCD                         074800080208     C                   PARM                    ZWKHTX                         074900080208     C     SFIELD        WHENEQ    'ZDSDCDE'                                    075000070213     C                   CALL      'DISTSSEL'                                   075100080208     C                   PARM                    ZDSDCDE                        075200070213     C                   PARM                    DNAME                          075300070213     C                   ENDSL                                                  075400070213     C                   ENDSR                                                  075500070305     C**********************************************************************    075600070305                                                                                075700070305     C**********************************************************************    075800070306     C     OFFIND        BEGSR                                                  075900070305     C**********************************************************************    076000070213     C*‚Subroutine: Set error indicators to OFF                                 076100070305     C**********************************************************************    076200070212     C                   MOVE      *OFF          *IN99                          076300070212     C                   MOVE      *OFF          *IN31                          076400070212     C                   MOVE      *OFF          *IN32                          076500070212     C                   MOVE      *OFF          *IN33                          076600070212     C                   MOVE      *OFF          *IN34                          076700070212     C                   MOVE      *OFF          *IN35                          076800070306     C                   MOVE      *OFF          *IN36                          076900070306     C                   MOVE      *OFF          *IN37                          077000070306     C                   MOVE      *BLANKS       ZMSAGE                         077100070212     C                   ENDSR                                                  077200070305     C**********************************************************************    077300070305                                                                                077400070305     C**********************************************************************    077500070213     C     ZORDER        BEGSR                                                  077600070305     C**********************************************************************    077700070213     C*‚Subroutine: Customer Orders                                             077800070305     C**********************************************************************    077900110426     C*    N_XWBCCD      CHAIN     CONHDRL1                           77        078000090304     C*    *IN77         IFEQ      '0'                                          078100070214     C                   CALL      'WWCONHDR'                                   078200110426     C                   PARM                    N_XWBCCD                       078300090304     C*                  ELSE                                                   078400090304     C*                  MOVE      '1'           *IN99                          078500090304     C*                  MOVE      'YYG0012'     MSGID                          078600090304     C*                  CALL      RTNMTX                                       078700090304     C*                  PARM                    MSGID             7            078800090304     C*                  PARM                    ERRMSG          132            078900070219     C* Display error message                                                   079000090304     C*                  MOVEL     ERRMSG        ZMSAGE                         079100090304     C*                  ENDIF                                                  079200070213     C                   ENDSR                                                  079300070305     C**********************************************************************    079400070305                                                                                079500070305     C**********************************************************************    079600070213     C     ZHISTO        BEGSR                                                  079700070305     C**********************************************************************    079800070213     C*‚Subroutine: Transaction history                                         079900070305     C**********************************************************************    080000110426     C*    N_XWBCCD      CHAIN     TRNHSTL3                           77        080100090304     C*    *IN77         IFEQ      '0'                                          080200070213     C                   CALL      'WWTRNHST'                                   080300110426     C                   PARM                    N_XWBCCD                       080400090304     C*                  ELSE                                                   080500090304     C*                  MOVE      '1'           *IN99                          080600090304     C*                  MOVE      'YYG0012'     MSGID                          080700090304     C*                  CALL      RTNMTX                                       080800090304     C*                  PARM                    MSGID             7            080900090304     C*                  PARM                    ERRMSG          132            081000070219     C* Display error message                                                   081100090304     C*                  MOVEL     ERRMSG        ZMSAGE                         081200090304     C*                  ENDIF                                                  081300070213     C                   ENDSR                                                  081400080208     C**********************************************************************    081500080208     C     MVDBSC        BEGSR                                                  081600110426     C                   MOVEL     N_XWBCCD      ZWBCCD                         081700110426     C                   MOVEL     N_XWG4TX      ZWG4TX                         081800110426     C                   MOVEL     N_XWB2CD      ZWB2CD                         081900110426     C                   MOVEL     N_XWB3CD      ZWB3CD                         082000110426     C                   MOVEL     N_XWHITX      ZWHITX                         082100110426     C                   MOVEL     N_XWE0NB      ZWE0NB                         082200110426     C                   MOVEL     N_XWJUN0      ZWJUN0                         082300110426     C                   MOVEL     N_XWDVCD      ZWDVCD                         082400110426     C                   MOVEL     N_XWBNCD      ZWBNCD                         082500110426     C                   MOVEL     N_PERSON      ZPERSON                        082600110426     C                   MOVEL     N_DSDCDE      ZDSDCDE                        082700110426     C                   MOVEL     N_XWBTCD      ZWBTCD                         082800110426     C                   MOVEL     N_XWGIVA      ZWGIVA                         082900110426     C                   MOVEL     N_XWAOCD      ZWAOCD                         083000110426     C                   MOVEL     N_XWBBCD      ZWBBCD                         083100110426     C                   MOVEL     N_XWG4T0      ZWG4T0                         083200110426     C                   MOVEL     N_XWC7ST      ZWC7ST                         083300110426     C                   MOVEL     N_XWDAST      ZWDAST                         083400110426     C                   MOVEL     N_XWBPD0      ZWBPD0                         083500110426     C                   MOVEL     N_XWBAD0      ZWBAD0                         083600110426     C                   MOVEL     NNXWKHTX      ZWKHTX                         083700110426     C                   MOVEL     N_XWF0VA      ZWF0VA                         083800110426     C                   MOVEL     N_XWASDT      ZWASDT                         083900110426     C                   MOVEL     N_XWF0V0      ZWF0V0                         084000110426     C                   MOVEL     N_XWBQDT      ZWBQDT                         084100110426     C                   MOVEL     N_XWF1VA      ZWF1VA                         084200110426     C                   MOVEL     N_XWF1V0      ZWF1V0                         084300110426     C                   MOVEL     N_XWF2VA      ZWF2VA                         084400110426     C                   MOVEL     N_XWF3VA      ZWF3VA                         084500110426     C                   MOVEL     N_XWF4VA      ZWF4VA                         084600110426     C                   MOVEL     N_XWF6VA      ZWF6VA                         084700110426     C                   MOVEL     N_XWIDV0      ZWIDV0                         084800110426     C                   MOVEL     N_XWGAVA      ZWGAVA                         084900110426     C                   MOVEL     N_XWGBVA      ZWGBVA                         085000110426     C                   MOVEL     N_XWGCVA      ZWGCVA                         085100110426     C                   MOVEL     N_XWGDVA      ZWGDVA                         085200110426     C                   MOVEL     N_XWGEVA      ZWGEVA                         085300110426     C                   MOVEL     N_XWGFVA      ZWGFVA                         085400110426     C                   MOVEL     N_XWGGVA      ZWGGVA                         085500110426     C                   MOVEL     N_CUSNO       ZCUSNO                         085600080208     C                   ENDSR                                                  085700080208     C**********************************************************************    085800080208     C     MVSCDB        BEGSR                                                  085900110426     C                   MOVEL     ZWBCCD        N_XWBCCD                       086000110426     C                   MOVEL     ZWG4TX        N_XWG4TX                       086100110426     C                   MOVEL     ZWB2CD        N_XWB2CD                       086200110426     C                   MOVEL     ZWB3CD        N_XWB3CD                       086300110426     C                   MOVEL     ZWHITX        N_XWHITX                       086400110426     C                   MOVEL     ZWE0NB        N_XWE0NB                       086500110426     C                   MOVEL     ZWJUN0        N_XWJUN0                       086600110426     C                   MOVEL     ZWDVCD        N_XWDVCD                       086700110426     C                   MOVEL     ZWBNCD        N_XWBNCD                       086800110426     C                   MOVEL     ZPERSON       N_PERSON                       086900110426     C                   MOVEL     ZDSDCDE       N_DSDCDE                       087000110426     C                   MOVEL     ZWBTCD        N_XWBTCD                       087100110426     C                   MOVEL     ZWGIVA        N_XWGIVA                       087200110426     C                   MOVEL     ZWAOCD        N_XWAOCD                       087300110426     C                   MOVEL     ZWBBCD        N_XWBBCD                       087400110426     C                   MOVEL     ZWG4T0        N_XWG4T0                       087500110426     C                   MOVEL     ZWC7ST        N_XWC7ST                       087600110426     C                   MOVEL     ZWDAST        N_XWDAST                       087700110426     C                   MOVEL     ZWBPD0        N_XWBPD0                       087800110426     C                   MOVEL     ZWBAD0        N_XWBAD0                       087900110426     C                   MOVEL     ZWKHTX        NNXWKHTX                       088000110426     C                   MOVEL     ZWF0VA        N_XWF0VA                       088100110426     C                   MOVEL     ZWASDT        N_XWASDT                       088200110426     C                   MOVEL     ZWF0V0        N_XWF0V0                       088300110426     C                   MOVEL     ZWBQDT        N_XWBQDT                       088400110426     C                   MOVEL     ZWF1VA        N_XWF1VA                       088500110426     C                   MOVEL     ZWF1V0        N_XWF1V0                       088600110426     C                   MOVEL     ZWF2VA        N_XWF2VA                       088700110426     C                   MOVEL     ZWF3VA        N_XWF3VA                       088800110426     C                   MOVEL     ZWF4VA        N_XWF4VA                       088900110426     C                   MOVEL     ZWF6VA        N_XWF6VA                       089000110426     C                   MOVEL     ZWIDV0        N_XWIDV0                       089100110426     C                   MOVEL     ZWGAVA        N_XWGAVA                       089200110426     C                   MOVEL     ZWGBVA        N_XWGBVA                       089300110426     C                   MOVEL     ZWGCVA        N_XWGCVA                       089400110426     C                   MOVEL     ZWGDVA        N_XWGDVA                       089500110426     C                   MOVEL     ZWGEVA        N_XWGEVA                       089600110426     C                   MOVEL     ZWGFVA        N_XWGFVA                       089700110426     C                   MOVEL     ZWGGVA        N_XWGGVA                       089800110426     C                   MOVEL     ZCUSNO        N_CUSNO                        089900080208     C                   ENDSR                                                  090000070305     C**********************************************************************    