000100070317     H*‚--------------------------------------------------------------------    000200110209     H*ˆCOPYRIGHT DATABOROUGH LTD 2011                                          000300110209     H*ˆPROGRAM:  Work with Items                                               000400010705     H*‚--------------------------------------------------------------------    000500070131     H DATEDIT(*YMD)                                                            000600980122     F**********************************************************************    000700990528     F*‚F i l e s                                                               000800980122     F**********************************************************************    000900110209     FWITEMSD   CF   E             WORKSTN                                      001000070130     F                                     SFILE(ZZSF01:SFLRRN)                 001100110209     FITEMS     UF A E           K DISK                                         001200070813     F                                     INFDS(FILEDS)                        001300070213     D**********************************************************************    001400070213     D*‚D e f i n i t i o n s                                                   001500070213     D**********************************************************************    001600070130     D*‚Set constants                                                           001700070131     D RTNMTX          C                   CONST('RTNMSGTEXT')                  001800070213     D INIDAT          C                   CONST('0001-01-01')                  001900070813                                                                                002000070813     d FILEDS          ds                                                       002100070813     d  FILESTS               11     15s 0                                      002200070303                                                                                002300070305     D  pageno         s              3p 0                                      002400070305     D  noofpages      s              3p 0 inz(2)                               002500070305     D  sflrrn         s              5p 0                                      002600070305     D  sflchg         s              1a   inz('0')                             002700110103     D  sflCTR         s              3P 0                                      002800070303                                                                                002900070205     D                 DS                  INZ                                  003000070213     D  ZDATE                  1     10                                         003100070205     D  ZYR                    1      4                                         003200070205     D  FILLR1                 5      5                                         003300070205     D  ZMTH                   6      7                                         003400070205     D  FILLR2                 8      8                                         003500070205     D  ZDAY                   9     10                                         003600070303                                                                                003700070303     C**********************************************************************    003800070130     C*‚M a i n l i n e   C o d e                                               003900070303     C**********************************************************************    004000070202     C*‚Build subfile                                                           004100070202     C                   EXSR      SFLWRT                                       004200070305                                                                                004300070130     C     *IN03         DOWEQ     '0'                                          004400070130     C     *IN12         ANDEQ     '0'                                          004500070212     C                   MOVE      *BLANKS       LOCATE                         004600070219     C*‚Display screens                                                         004700070201     C                   WRITE     ZZTR01                                       004800070215     C   99              WRITE     ZZMC01                                       004900070131     C                   EXFMT     ZZCT01                                       005000070219     C*‚Remove messages                                                         005100070130     C                   CALL      'XBCCLMSG'                                   005200070131     C     *IN03         IFEQ      '1'                                          005300070131     C     *IN12         OREQ      '1'                                          005400070131     C                   LEAVE                                                  005500070131     C                   ENDIF                                                  005600070303     C*‚Action positioner request                                               005700070212     C     LOCATE        IFNE      *BLANKS                                      005800110103     C                   MOVE      *ZEROS        SFLRRN                         005900110209     C                   MOVE      LOCATE        #ITEM                          006000070202     C                   EXSR      SFLWRT                                       006100070202     C                   ITER                                                   006200070202     C                   ENDIF                                                  006300070219     C*‚Action command keys                                                     006400070130     C     *IN28         IFEQ      '1'                                          006500070130     C                   EXSR      CMDKEY                                       006501110913     C***                EXSR      CMDFUN                                       006600070130     C                   ELSE                                                   006700070219     C*‚Else action selections                                                  006800070130     C                   EXSR      ZSELEC                                       006900070130     C                   ENDIF                                                  007000070219     C*‚If changes made then update display                                     007100070209     C     SFLCHG        IFEQ      '1'                                          007200110209     C                   MOVE      *LOVAL        #ITEM                          007300070209     C                   EXSR      SFLWRT                                       007400070209     C                   ENDIF                                                  007500071221                                                                                007600070130     C                   ENDDO                                                  007700070305                                                                                007800070131     C                   MOVE      '1'           *INLR                          007900070131     C                   RETURN                                                 008000070303     C**********************************************************************    008100070130     C*‚L o g i c a l   E n d   o f   P r o g r a m                             008200070303     C**********************************************************************    008300070303                                                                                008400070303     C**********************************************************************    008500070130     C     SFLWRT        BEGSR                                                  008600070303     C**********************************************************************    008700070130     C*‚Subroutine: Write data to subfile                                       008800070303     C**********************************************************************    008900070130     C*‚Delete subfile                                                          009000110103     C                   IF        SFLRRN = 0                                   009100070131     C                   SETON                                        74        009200070213     C                   SETOFF                                       717281    009201110913     C***                SETON                                        717281    009300070131     C                   WRITE     ZZCT01                               99      009400070131     C                   SETOFF                                       74        009500070130     C*‚Write subfile                                                           009600070130     C                   MOVE      *ZEROS        SFLRRN                         009700110209     C     #ITEM         SETLL     ITEMS                                        009800110103     C                   ENDIF                                                  009900110103     C*                                                                         010000110103     C                   MOVE      *ZEROS        SFLCTR                         010100070213     C     *IN81         DOWEQ     '0'                                          010200110103     C     SFLCTR        ANDLT     12                                           010300110209     C                   READ(N)   ITEMS                                  81    010400110104     C     *IN81         IFEQ      '0'                                          010500070130     C                   ADD       1             SFLRRN                         010600110103     C                   ADD       1             SFLCTR                         010700110103     C                   IF        SFLCTR = 1                                   010800110103     C                   Z-ADD     SFLRRN        SHWREC                         010900110103     C                   ENDIF                                                  011000070130     C                   MOVE      *BLANKS       DSSEL                          011100070130     C                   WRITE     ZZSF01                               99      011200110103     C                   ENDIF                                                  011300070130     C                   ENDDO                                                  011400070303                                                                                011500110103     C     SFLRRN        IFGT      0                                            011600070131     C                   SETON                                        71        011700070130     C                   ENDIF                                                  011800070131     C                   SETON                                        72        011900071221                                                                                012000070130     C                   ENDSR                                                  012100070303     C**********************************************************************    012200070305                                                                                012300070305     C**********************************************************************    012400070305     C     CMDKEY        BEGSR                                                  012500070305     C**********************************************************************    012600070305     C*‚Subroutine: Action command keys                                         012700070305     C**********************************************************************    012800070305     C                   SELECT                                                 012900110103                                                                                013000110103     C     *IN26         WHENEQ    '1'                                          013100110103     C                   EXSR      SFLWRT                                       013200070305                                                                                013300070305     C     *IN06         WHENEQ    '1'                                          013400070305     C                   EXSR      addrec                                       013500070305     C                   Z-ADD     1             SHWREC                         013600070305     C                   MOVE      '1'           SFLCHG                         013700070305     C                   ENDSL                                                  013800070305                                                                                013900070305     C                   MOVE      '0'           *IN12                          014000070305                                                                                014100070305     C                   ENDSR                                                  014200070305     C**********************************************************************    014300070303                                                                                014400070303     C**********************************************************************    014500070130     C     ZSELEC        BEGSR                                                  014600070303     C**********************************************************************    014700070130     C*‚Subroutine: Action selection                                            014800070303     C**********************************************************************    014900070130     C                   MOVE      '0'           SFLCHG                         015000070130     C                   READC     ZZSF01                                 35    015100070305                                                                                015200070130     C*‚For each selection                                                      015300070130     C     *IN35         DOWEQ     '0'                                          015400070130     C                   MOVE      '1'           SFLCHG                         015500070303                                                                                015600070213     C                   SELECT                                                 015700070219     C*‚Change                                                                  015800070213     C     DSSEL         WHENEQ    '2'                                          015900070305     C                   EXSR      chgrec                                       016000070219     C*‚Delete                                                                  016100070303     C     DSSEL         WHENEQ    '4'                                          016200070305     C                   EXSR      delrec                                       016300070219     C*‚Display                                                                 016400070303     C     DSSEL         WHENEQ    '5'                                          016500070305     C                   EXSR      dsprec                                       016600070213     C                   ENDSL                                                  016700070303                                                                                016800070130     C                   MOVE      *BLANKS       DSSEL                          016900070130     C                   UPDATE    ZZSF01                               99      017000070130     C                   READC     ZZSF01                                 35    017100070305                                                                                017200070219     C*‚End: For each selection                                                 017300070130     C                   ENDDO                                                  017400070303                                                                                017500070130     C                   MOVE      '0'           *IN12                          017600070303                                                                                017700070130     C                   ENDSR                                                  017800070303     C**********************************************************************    017900070303                                                                                018000070303     C**********************************************************************    018100070305     C     dspscns       BEGSR                                                  018200070303     C**********************************************************************    018300070305     C*‚Subroutine: Display detail screens                                      018400070303     C**********************************************************************    018500110209     C*‚Display screen                                                          018600070305     C                   EXFMT     ZZFT01                                       018700080208     C                   EXSR      MVSCDB                                       018800070305                                                                                018900070130     C                   CALL      'XBCCLMSG'                                   019000070306     C                   EXSR      OFFIND                                       019100070305                                                                                019200070305                                                                                019300070130     C                   ENDSR                                                  019400070305     C**********************************************************************    019500070305                                                                                019600070305     C**********************************************************************    019700070216     C     VALID1        BEGSR                                                  019800070305     C**********************************************************************    019900070305     C*‚Subroutine: Validation #1                                               020000070305     C**********************************************************************    020100110209     C* WHEN ADDING ITEM #  MUST NOT BE *BLANKS                                 020200110209     C     ZITEM         IFEQ      *BLANKS                                      020300070209     C                   MOVE      '1'           *IN99                          020400070212     C                   MOVE      *ON           *IN31                          020500110209     C                   MOVE      'ITM0001'     MSGID                          020600070209     C                   CALL      RTNMTX                                       020700070209     C                   PARM                    MSGID             7            020800070209     C                   PARM                    ERRMSG          132            020900070209     C                   ENDIF                                                  021000110209     C* WHEN ADDING ITEM # MUST NOT EXIST                                       021100090303     C     ACTDSP        IFEQ      'ADDITION'                                   021200110209     C     ZITEM         SETLL     ITEMS                                  99    021300070209     C     *IN99         IFEQ      '1'                                          021400070212     C                   MOVE      *ON           *IN31                          021500070209     C                   MOVE      'Y2U0003'     MSGID                          021600070209     C                   CALL      RTNMTX                                       021700070209     C                   PARM                    MSGID             7            021800070209     C                   PARM                    ERRMSG          132            021900070209     C                   ENDIF                                                  022000070209     C                   ENDIF                                                  022100110209     C*‚Item Description                                                        022200110209     C     ZDESC         IFEQ      *BLANKS                                      022300070212     C                   MOVE      *ON           *IN32                          022400070212     C                   MOVE      *ON           *IN99                          022500110209     C                   MOVE      'ITM0001'     MSGID                          022600070212     C                   CALL      RTNMTX                                       022700070212     C                   PARM                    MSGID             7            022800070212     C                   PARM                    ERRMSG          132            022900070212     C                   ENDIF                                                  023000110209     C*-‚Part #                                                                 023100110209     C     ZPART         IFEQ      *BLANKS                                      023200070213     C                   MOVE      '1'           *IN33                          023300110209     C                   MOVE      'ITM0003'     MSGID                          023400070213     C                   CALL      RTNMTX                                       023500070213     C                   PARM                    MSGID             7            023600070213     C                   PARM                    ERRMSG          132            023700070213     C                   ENDIF                                                  023800070131     C                   ENDSR                                                  023900070305     C**********************************************************************    024000070305                                                                                024100070305                                                                                024200070305     C**********************************************************************    024300070305     C     ADDREC        BEGSR                                                  024400070305     C**********************************************************************    024500070305     C*‚Subroutine: Add a record                                                024600070305     C**********************************************************************    024700070305     C                   MOVE      '0'           *IN94                          024800070305     C                   MOVE      '1'           *IN96                          024900070305     C                   MOVE      '0'           *IN97                          025000070305     C                   MOVEL     'ADDITION'    ACTDSP                         025100070306     C                   EXSR      OFFIND                                       025200070305                                                                                025300110209     C                   clear                   ritems                         025400080208     C                   exsr      mvdbsc                                       025500070305                                                                                025600110209     C                   do                                                     025700070305                                                                                025800070305     C                   EXSR      DSPSCNS                                      025900070305                                                                                026000070305     C     *IN03         IFEQ      '1'                                          026100070305     C     *IN12         OREQ      '1'                                          026200070305     C                   LEAVE                                                  026300070305     C                   ENDIF                                                  026400070305                                                                                026500070305     C                   EXSR      VALID1                                       026600070305                                                                                026700070305     C*‚If errors found                                                         026800070305     C     *IN99         IFEQ      '1'                                          026900070305     C*‚Display error message and re-display screen                             027000070305     C                   MOVEL     ERRMSG        ZMSAGE                         027100080208     C                   exsr      mvdbsc                                       027200070305     C                   iter                                                   027300110209     C                   else                                                   027400110209     C                   leave                                                  027500110209     c                   endif                                                  027600070305     C*‚End: For each screen page                                               027700070305     C                   ENDDO                                                  027800070305                                                                                027900070305     C*‚If not F3/F12                                                           028000070305     C     *IN03         IFNE      '1'                                          028100070305     C     *IN12         ANDNE     '1'                                          028200070305                                                                                028300070309     C*‚Request confirmation                                                    028400070309     C                   EXFMT     ZZCNF1                                       028500070309     C     *IN03         IFNE      '1'                                          028600070309     C     *IN12         ANDNE     '1'                                          028700070309     C*‚If confirmation received then write record                              028800110209     C                   WRITE     RITEMS                               99      028900070305     C     *IN99         IFEQ      '1'                                          029000070305     C                   MOVE      'Y2U0004'     MSGID                          029100070305     C                   CALL      RTNMTX                                       029200070305     C                   PARM                    MSGID             7            029300070305     C                   PARM                    ERRMSG          132            029400070305     C* Display error message                                                   029500070305     C                   MOVEL     ERRMSG        ZMSAGE                         029600070305     C                   ENDIF                                                  029700070309     C                   ENDIF                                                  029800070305                                                                                029900070305     C*‚End: If not F3/F12                                                      030000070305     C                   ENDIF                                                  030100070305                                                                                030200070305     C                   ENDSR                                                  030300070305     C**********************************************************************    030400070305                                                                                030500070305     C**********************************************************************    030600070305     C     CHGREC        BEGSR                                                  030700070305     C**********************************************************************    030800070305     C*‚Subroutine: Change a record                                             030900070305     C**********************************************************************    031000070305     C                   MOVEL     '  UPDATE'    ACTDSP                         031100070305     C                   MOVE      '0'           *IN94                          031200070306     C                   MOVE      '0'           *IN96                          031300070305     C                   MOVE      '0'           *IN97                          031400070306     C                   EXSR      OFFIND                                       031500070305                                                                                031600070305     C                   EXSR      GETREC                                       031700070813                                                                                031800080117     C*‚If no record or file error                                              031900070813     C     *IN99         IFEQ      *OFF                                         032000070813     C     *IN66         ANDEQ     *OFF                                         032100070305                                                                                032200070305     C*‚For each screen page                                                    032300110209     C                   do                                                     032400070305                                                                                032500070305     C                   EXSR      DSPSCNS                                      032600070305                                                                                032700070305     C     *IN03         IFEQ      '1'                                          032800070305     C     *IN12         OREQ      '1'                                          032900070305     C                   LEAVE                                                  033000070305     C                   ENDIF                                                  033100070305                                                                                033200070305     C                   EXSR      VALID1                                       033300070305                                                                                033400070305     C*‚If errors found                                                         033500070305     C     *IN99         IFEQ      '1'                                          033600070305     C*‚Display error message and re-display screen                             033700070305     C                   MOVEL     ERRMSG        ZMSAGE                         033800080208     C                   exsr      mvdbsc                                       033900080208     C                   iter                                                   034000110209     C                   else                                                   034100110209     c                   leave                                                  034200110209     c                   endif                                                  034300070305                                                                                034400070305     C*‚End: For each screen page                                               034500070305     C                   ENDDO                                                  034600070305                                                                                034700070305     C*‚If not F3/F12                                                           034800070305     C     *IN03         IFNE      '1'                                          034900070305     C     *IN12         ANDNE     '1'                                          035000070305                                                                                035100070305     C*‚Request confirmation                                                    035200070305     C                   EXFMT     ZZCNF1                                       035300070305     C     *IN03         IFNE      '1'                                          035400070305     C     *IN12         ANDNE     '1'                                          035500070305     C*‚If confirmation received then update record                             035600110209     C     zitem         chain(e)  ritems                                       035700110209     C                   if        %found(items)                                035800080208     C                   exsr      mvscdb                                       035900110209     C                   UPDATE    RITEMS                               99      036000070305     C     *IN99         IFEQ      '1'                                          036100070305     C                   MOVE      'Y2U0007'     MSGID                          036200070305     C                   CALL      RTNMTX                                       036300070305     C                   PARM                    MSGID             7            036400070305     C                   PARM                    ERRMSG          132            036500070305     C* Display error message                                                   036600070305     C                   MOVEL     ERRMSG        ZMSAGE                         036700070305     C                   ENDIF                                                  036800080117     C                   else                                                   036900110209     C                   unlock(e) items                                        037000080117     C                   endif                                                  037100070305     C                   ENDIF                                                  037200080117                                                                                037300080117     C*‚End: If not F3/F12                                                      037400080117     C                   ENDIF                                                  037500080117                                                                                037600080117     C*‚End: If no record or file error                                         037700070813     C                   ENDIF                                                  037800070305                                                                                037900070305     C                   MOVE      SFLRRN        SHWREC                         038000070305                                                                                038100070305     C                   ENDSR                                                  038200070305     C**********************************************************************    038300070305                                                                                038400070305     C**********************************************************************    038500070305     C     DELREC        BEGSR                                                  038600070305     C**********************************************************************    038700070305     C*‚Subroutine: Delete a record                                             038800070305     C**********************************************************************    038900070305     C                   MOVEL     '  DELETE'    ACTDSP                         039000070305     C                   MOVE      '1'           *IN94                          039100070306     C                   MOVE      '0'           *IN96                          039200070305     C                   MOVE      '1'           *IN97                          039300070306     C                   EXSR      OFFIND                                       039400070305                                                                                039500070305     C                   EXSR      GETREC                                       039600070305                                                                                039700070305     C                   EXSR      DSPSCNS                                      039800070305                                                                                039900070309     C*‚If not F3/F12                                                           040000070309     C     *IN03         IFNE      '1'                                          040100070309     C     *IN12         ANDNE     '1'                                          040200070309                                                                                040300070309     C*‚Request confirmation                                                    040400070309     C                   EXFMT     ZZCNF1                                       040500080117                                                                                040600070309     C     *IN03         IFNE      '1'                                          040700070309     C     *IN12         ANDNE     '1'                                          040800070309     C*‚If confirmation received then delete record                             040900110209     C     zitem         chain(e)  ritems                                       041000110209     C                   if        %found(items)                                041100110209     C                   delete(e) ritems                                       041200080117     C                   else                                                   041300110209     C                   unlock(e) items                                        041400080117     C                   endif                                                  041500080117     C                   ENDIF                                                  041600070309                                                                                041700070309     C*‚End: If not F3/F12                                                      041800070309     C                   ENDIF                                                  041900070305                                                                                042000070305     C                   MOVE      SFLRRN        SHWREC                         042100070305                                                                                042200070305     C                   ENDSR                                                  042300070305     C**********************************************************************    042400070305                                                                                042500070305     C**********************************************************************    042600070305     C     DSPREC        BEGSR                                                  042700070305     C**********************************************************************    042800070305     C*‚Subroutine: Display a record                                            042900070305     C**********************************************************************    043000070305     C                   MOVE      '1'           *IN94                          043100070306     C                   MOVE      '0'           *IN96                          043200070305     C                   MOVE      '0'           *IN97                          043300070305     C                   MOVEL     ' DISPLAY'    ACTDSP                         043400070306     C                   EXSR      OFFIND                                       043500070305                                                                                043600070305     C                   EXSR      GETREC                                       043700080117                                                                                043800070305     C                   EXSR      DSPSCNS                                      043900070305                                                                                044000070305     C                   MOVE      SFLRRN        SHWREC                         044100070305                                                                                044200070305     C                   ENDSR                                                  044300070305     C**********************************************************************    044400070305                                                                                044500070305     C**********************************************************************    044600070305     C     GETREC        BEGSR                                                  044700070305     C**********************************************************************    044800070305     C*‚Subroutine: Retrieve a record                                           044900070305     C**********************************************************************    045000110209     C     #ITEM         CHAIN(N)  ITEMS                              9966      045100071221                                                                                045200071221     C                   select                                                 045300071221     C*‚If record error                                                         045400071221     C                   when      *in99 = *on                                  045500070813     C                   MOVE      'OES0115'     MSGID                          045600070305     C                   CALL      RTNMTX                                       045700070305     C                   PARM                    MSGID             7            045800070305     C                   PARM                    ERRMSG          132            045900070305     C                   MOVEL     ERRMSG        ZMSAGE                         046000071221                                                                                046100071221     C*‚If file error                                                           046200071221     C                   when      *in66 = *on                                  046300070813     C     FILESTS       IFEQ      1218                                         046400070813     C                   MOVE      'Y3U9999'     MSGID                          046500070813     C                   CALL      RTNMTX                                       046600070813     C                   PARM                    MSGID             7            046700070813     C                   PARM                    ERRMSG          132            046800070813     C                   MOVEL     ERRMSG        ZMSAGE                         046900070813     C                   ELSE                                                   047000070813     C                   MOVE      'OEM0004'     MSGID                          047100070813     C                   CALL      RTNMTX                                       047200070813     C                   PARM                    MSGID             7            047300070813     C                   PARM                    ERRMSG          132            047400070813     C                   MOVEL     ERRMSG        ZMSAGE                         047500070813     C                   ENDIF                                                  047600071221                                                                                047700071221     C*‚If no errors                                                            047800071221     C                   other                                                  047900080208     C                   exsr      mvdbsc                                       048000071221                                                                                048100071221     C                   endsl                                                  048200071221                                                                                048300070305     C                   ENDSR                                                  048400070305     C**********************************************************************    048500070305                                                                                048600070305     C**********************************************************************    048700070130     C     *INZSR        BEGSR                                                  048800070305     C**********************************************************************    048900070130     C*‚Subroutine: Initialisation routines                                     049000070305     C**********************************************************************    049100070130     C*‚Initialise message subfile                                              049200070213     C                   MOVE      '1'           *IN82                          049300110209     C                   MOVEL     'WWITEMS '    ZZPGM                          049400070130     C*-‚Set date                                                               049500070130     C                   MOVE      *DATE         ZZDATE                         049600070205     C                   MOVE      *YEAR         ZYR                            049700070205     C                   MOVE      '-'           FILLR1                         049800070205     C                   MOVE      *MONTH        ZMTH                           049900070205     C                   MOVE      '-'           FILLR2                         050000070205     C                   MOVE      *DAY          ZDAY                           050100070130     C                   ENDSR                                                  050200070305     C**********************************************************************    050300070305                                                                                050400070305     C**********************************************************************    050500070306     C     OFFIND        BEGSR                                                  050600070305     C**********************************************************************    050700070213     C*‚Subroutine: Set error indicators to OFF                                 050800070305     C**********************************************************************    050900070212     C                   MOVE      *OFF          *IN99                          051000070212     C                   MOVE      *OFF          *IN31                          051100070212     C                   MOVE      *OFF          *IN32                          051200070212     C                   MOVE      *OFF          *IN33                          051300070212     C                   MOVE      *OFF          *IN34                          051400070212     C                   MOVE      *OFF          *IN35                          051500070306     C                   MOVE      *OFF          *IN36                          051600070306     C                   MOVE      *OFF          *IN37                          051700070306     C                   MOVE      *BLANKS       ZMSAGE                         051800070212     C                   ENDSR                                                  051900070305     C**********************************************************************    052000080208     C**********************************************************************    052100080208     C     MVDBSC        BEGSR                                                  052200110209     C                   MOVEL     #ITEM         ZITEM                          052300110209     C                   MOVEL     #DESC         ZDESC                          052400110209     C                   MOVEL     #PART         ZPART                          052500080208     C                   ENDSR                                                  052600080208     C**********************************************************************    052700080208     C     MVSCDB        BEGSR                                                  052800110209     C                   MOVEL     ZITEM         #ITEM                          052900110209     C                   MOVEL     ZDESC         #DESC                          053000110209     C                   MOVEL     ZPART         #PART                          053100080208     C                   ENDSR                                                  053200070305     C**********************************************************************    