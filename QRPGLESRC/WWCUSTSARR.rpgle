000100120525      //‚--------------------------------------------------------------------   000200120525      //ˆCOPYRIGHT DATABOROUGH LTD 2007                                         000300120525      //ˆPROGRAM:  Work with Customers                                          000400120525      //‚--------------------------------------------------------------------   000500070131     H DATEDIT(*YMD)                                                            000600120525     H OPTION(*NODEBUGIO:*SRCSTMT)                                              000700120525      //*********************************************************************   000800120525      //‚F i l e s                                                              000900120525      //*********************************************************************   001000120525     FWCUSTSDARRCF   E             WORKSTN                                      001100070212     FCUSTS     UF A E           K DISK                                         001200070813     F                                     INFDS(FILEDS)                        001300070213     FSLMEN     IF   E           K DISK                                         001400070213     FCUSFL3    IF   E           K DISK                                         001500070213     FCUSGRP    IF   E           K DISK                                         001600070213     FDISTS     IF   E           K DISK                                         001700070213     FCONHDRL1  IF   E           K DISK                                         001800070213     FTRNHSTL3  IF   E           K DISK                                         001900120525      //*********************************************************************   002000120525      //‚D e f i n i t i o n s                                                  002100120525      //*********************************************************************   002200120525      //‚Set constants                                                          002300120525                                                                                002400120525                                                                                002500120525                                                                                002600120525      // On-screen array and index:                                             002700120525     D OSArrIdx        S             10U 0                                      002800120525                                                                                002900120525     D                 DS                                                       003000120525     D OSArr                   1    624A   Dim(12)                              003100120525     D  OSA01                  1     52A                                        003200120525     D  OSA02                 53    104A                                        003300120525     D  OSA03                105    156A                                        003400120525     D  OSA04                157    208A                                        003500120525     D  OSA05                209    260A                                        003600120525     D  OSA06                261    312A                                        003700120525     D  OSA07                313    364A                                        003800120525     D  OSA08                365    416A                                        003900120525     D  OSA09                417    468A                                        004000120525     D  OSA10                469    520A                                        004100120525     D  OSA11                521    572A                                        004200120525     D  OSA12                573    624A                                        004300120525                                                                                004400120525      // Selection array and index:                                             004500120525     D DSSELIdx        S             10U 0                                      004600120525                                                                                004700120525     D                 DS                                                       004800120525     D DSSEL                   1     12A   Dim(12)                              004900120525     D  DSSEL01                1      1A                                        005000120525     D  DSSEL02                2      2A                                        005100120525     D  DSSEL03                3      3A                                        005200120525     D  DSSEL04                4      4A                                        005300120525     D  DSSEL05                5      5A                                        005400120525     D  DSSEL06                6      6A                                        005500120525     D  DSSEL07                7      7A                                        005600120525     D  DSSEL08                8      8A                                        005700120525     D  DSSEL09                9      9A                                        005800120525     D  DSSEL10               10     10A                                        005900120525     D  DSSEL11               11     11A                                        006000120525     D  DSSEL12               12     12A                                        006100120525                                                                                006200120525     D Count           S             10U 0 Inz(0)                               006300120525                                                                                006400070131     D RTNMTX          C                   CONST('RTNMSGTEXT')                  006500070213     D INIDAT          C                   CONST('0001-01-01')                  006600070813                                                                                006700070813     d FILEDS          ds                                                       006800070813     d  FILESTS               11     15s 0                                      006900070303                                                                                007000070305     D  sflrrn         s              5p 0                                      007100070305     D  sflchg         s              1a   inz('0')                             007200110103     D  sflCTR         s              3P 0                                      007300070303                                                                                007400070205     D                 DS                  INZ                                  007500070213     D  ZDATE                  1     10                                         007600070205     D  ZYR                    1      4                                         007700070205     D  FILLR1                 5      5                                         007800070205     D  ZMTH                   6      7                                         007900070205     D  FILLR2                 8      8                                         008000070205     D  ZDAY                   9     10                                         008100120525                                                                                008200120525     D CUSTMNT1        PR                  ExtPgm('CUSTMNT1')                   008300120525     D  XWBCCD                       11A   Const                                008400070303                                                                                008500120525      //*********************************************************************   008600070213     IRCUSF                                                                     008700070213     I              DSDCDE                      XSDCDE                          008800070305                                                                                008900120525      //*********************************************************************   009000120525      //‚M a i n l i n e   C o d e                                              009100120525      //*********************************************************************   009200120525      //‚Build subfile                                                          009300120525      /Free                                                                     009400120525       ExSR SflWrt;                                                             009500070305                                                                                009600120525       DoW *IN03 = *OFF and *IN12 = *OFF;                                       009700120525         LOCATE = *BLANKS;                                                      009800120525         //‚Display screens                                                     009900120525         Write ZZTR01;                                                          010000120525         If *IN99;                                                              010100120525           Write ZZMC01;                                                        010200120525         EndIf;                                                                 010300120525         ExFmt FLTSCN;                                                          010400120525         //‚Remove messages                                                     010500120525      /END-FREE                                                                 010600120525     C                   CALL      'XBCCLMSG'                                   010700120525      /FREE                                                                     010800120525         IF *IN03 = '1'                                                         010900120525         OR *IN12 = '1';                                                        011000120525           Leave;                                                               011100120525         EndIf;                                                                 011200120525         //‚Action positioner request                                           011300120525         If LOCATE <> *BLANKS;                                                  011400120525           SFLRRN = 0;                                                          011500120525           XWBCCD = LOCATE;                                                     011600120525           ExSR SflWrt;                                                         011700120525           Iter;                                                                011800120525         EndIf;                                                                 011900120525         //‚Action command keys                                                 012000120525         If *IN28;                                                              012100120525           ExSR CmdKey;                                                         012200120525         Else;                                                                  012300120525           //‚Else action selections                                            012400120525           ExSR ZSelec;                                                         012500120525         EndIf;                                                                 012600120525         //‚If changes made then update display                                 012700120525         If SFLCHG = *ON;                                                       012800120525           XWBCCD = *LOVAL;                                                     012900120525           ExSR SflWrt;                                                         013000120525         EndIf;                                                                 013100071221                                                                                013200120525       EndDo;                                                                   013300070305                                                                                013400120525       *INLR = *ON;                                                             013500120525       Return;                                                                  013600120525                                                                                013700120525       //*********************************************************************  013800120525       //‚L o g i c a l   E n d   o f   P r o g r a m                           013900120525       //*********************************************************************  014000070303                                                                                014100120525       //*********************************************************************  014200120525       BegSR SflWrt;                                                            014300120525         //*********************************************************************014400120525         //‚Subroutine: Write data to subfile                                   014500120525         //*********************************************************************014600120525         //‚Delete subfile                                                      014700120525         If SFLRRN = 0;                                                         014800120525           *IN74 = *ON;                                                         014900120525           *IN71 = *OFF;                                                        015000120525           *IN72 = *OFF;                                                        015100120525           *IN81 = *OFF;                                                        015200120525           *IN74 = *OFF;                                                        015300120525           Clear OSArr;                                                         015400120525           SFLRRN = 0;                                                          015500120525           SETLL XWBCCD CUSTS;                                                  015600120525         EndIf;                                                                 015700120525         Clear OSArr;                                                           015800120525         SFLCTR = 0;                                                            015900120525         DOW *IN81 = '0'                                                        016000120525         AND SFLCTR < 12;                                                       016100120525           READ(N) CUSTS;                                                       016200120525           *IN81 = %EOF;                                                        016300120525           If *IN81 = '0';                                                      016400120525             SFLRRN += 1;                                                       016500120525             SFLCTR += 1;                                                       016600120525             If SFLCTR = 1;                                                     016700120525               SHWREC = SFLRRN;                                                 016800120525             EndIf;                                                             016900120525             DSSEL(SFLCTR) = *BLANKS;                                           017000120525             If SFLCTR >= 1 and SFLCTR <= %ELEM(OSArr);                         017100120525               %Subst(OSArr(SFLCTR):1:11) = XWBCCD;                             017200120525               %Subst(OSArr(SFLCTR):13:40) = XWG4TX;                            017300120525               DSSEL(SFLCTR) = *BLANKS;                                         017400120525             EndIf;                                                             017500120525           EndIf;                                                               017600120525         EndDo;                                                                 017700070303                                                                                017800120525         If SFLRRN > 0;                                                         017900120525           *IN71 = *ON;                                                         018000120525         EndIf;                                                                 018100120525         *IN72 = *ON;                                                           018200071221                                                                                018300120525       EndSr;                                                                   018400120525       //*********************************************************************  018500070305                                                                                018600120525       //*********************************************************************  018700120525       BegSR CmdKey;                                                            018800120525         //*********************************************************************018900120525         //‚Subroutine: Action command keys                                     019000120525         //*********************************************************************019100120525         Select;                                                                019200110103                                                                                019300120525         When *IN26 = '1';                                                      019400120525           ExSR SFLWRT;                                                         019500070305                                                                                019600120525         When *IN06 = '1';                                                      019700120525           EXSR addrec;                                                         019800120525           SHWREC = 1;                                                          019900120525           SFLCHG = '1';                                                        020000120525         EndSl;                                                               //020100070305                                                                                020200120525         *IN12 = *OFF;                                                          020300120525       EndSr;                                                                   020400120525       //*********************************************************************  020500070303                                                                                020600120525       //*********************************************************************  020700120525       BegSr ZSelec;                                                            020800120525         //*********************************************************************020900120525         //‚Subroutine: Action selection                                        021000120525         //*********************************************************************021100120525         SFLCHG = *OFF;                                                         021200070305                                                                                021300120525         //‚For each selection                                                  021400120525         For Count = 1 to %Elem(OSArr);                                         021500120525           If DSSEL(Count) <> *BLANKS;                                          021600120525             XWBCCD = %Subst(OSArr(Count):1:11);                                021700120525             XWG4TX =  %Subst(OSArr(Count):13:40);                              021800120525             SFLCHG = *ON;                                                      021900120525                                                                                022000120525             Select;                                                            022100120525             //‚Change                                                          022200120525             When DSSEL(Count) = '2';                                           022300120525               ExSR chgrec;                                                     022400120525             //‚Delete                                                          022500120525             When DSSEL(Count) = '4';                                           022600120525               ExSR delrec;                                                     022700120525             //‚Display                                                         022800120525             When DSSEL(Count) = '5';                                           022900120525               ExSR dsprec;                                                     023000120525             //‚Customer Detail Maintenance                                     023100120525             When DSSEL(Count) = '6';                                           023200120525               CUSTMNT1(XWBCCD);                                                023300120525             //‚Work with Orders                                                023400120525             When DSSEL(Count) = '8';                                           023500120525               ExSR ZOrder;                                                     023600120525             //‚Work with Transaction history                                   023700120525             When DSSEL(Count) = '9';                                           023800120525               ExSR ZHISTO;                                                     023900120525             EndSl;                                                             024000070303                                                                                024100120525             DSSEL(Count) = *BLANKS;                                            024200120525           //‚End: For each selection                                           024300120525           EndIf;                                                               024400120525                                                                                024500120525         EndFor;                                                                024600120525                                                                                024700120525         *IN12 = *OFF;                                                          024800120525                                                                                024900120525       EndSR;                                                                   025000120525       //*********************************************************************  025100070303                                                                                025200120525       //*********************************************************************  025300120525       BEGSR dspscns;                                                           025400120525         //*********************************************************************025500120525         //‚Subroutine: Display detail screens                                  025600120525         //*********************************************************************025700120525         //‚Display screen, depending upon page no.                             025800120525         EXFMT ZZFT01;                                                          025900110823                                                                                026000120525         EXSR MVSCDB;                                                           026100070305                                                                                026200120525      /END-FREE                                                                 026300120525     C                   CALL      'XBCCLMSG'                                   026400120525      /FREE                                                                     026500120525         EXSR OFFIND;                                                           026600070305                                                                                026700120525         //‚Process Command Keys                                                026800120525         SELECT;                                                                026900120525           //‚Prompt                                                            027000120525         WHEN *IN04 = '1';                                                      027100120525           EXSR SRPROM;                                                         027200120525           //‚Orders                                                            027300120525         WHEN *IN08 = '1';                                                      027400120525           EXSR ZORDER;                                                         027500120525           //‚Transaction history                                               027600120525         WHEN *IN09 = '1';                                                      027700120525           EXSR ZHISTO;                                                         027800120525           //* Custtomer History                                                027900120525           //*   *IN07         WHENEQ    '1'                                    028000120525           //*                 EXSR      ZCUSTS                                 028100120525         ENDSL;                                                                 028200070305                                                                                028300120525       ENDSR;                                                                   028400120525       //*********************************************************************  028500070305                                                                                028600120525       //*********************************************************************  028700120525       BEGSR VALID1;                                                            028800120525         //*********************************************************************028900120525         //‚Subroutine: Validation #1                                           029000120525         //*********************************************************************029100120525      /END-FREE                                                                 029200120525     C                   DO                                                     029300120525      // WHEN ADDING CUSTOMER MUST NOT BE ZERO                                  029400120525      /FREE                                                                     029500120525           IF XWBCCD = *BLANKS;                                                 029600120525      /END-FREE                                                                 029700120525     C                   MOVE      '1'           *IN99                          029800120525     C                   MOVE      *ON           *IN31                          029900120525     C                   MOVE      'OEM0002'     MSGID                          030000120525     C                   CALL      RTNMTX                                       030100120525     C                   PARM                    MSGID             7            030200120525     C                   PARM                    ERRMSG          132            030300120525      /FREE                                                                     030400120525             LEAVE;                                                             030500120525           ENDIF;                                                               030600120525           // WHEN ADDING CUSTOMER MUST NOT EXIST                               030700120525           IF ACTDSP = 'ADDITION';                                              030800120525             SETLL XWBCCD CUSTS;                                                030900120525             *IN99 = %EQUAL;                                                    031000120525             IF *IN99 = '1';                                                    031100120525      /END-FREE                                                                 031200120525     C                   MOVE      *ON           *IN31                          031300120525     C                   MOVE      'Y2U0003'     MSGID                          031400120525     C                   MOVEL     *ALL'-'       XWG4TX                         031500120525     C                   CALL      RTNMTX                                       031600120525     C                   PARM                    MSGID             7            031700120525     C                   PARM                    ERRMSG          132            031800120525      /FREE                                                                     031900120525               LEAVE;                                                           032000120525             ENDIF;                                                             032100120525           ENDIF;                                                               032200120525           //‚Customer name                                                     032300120525           IF XWG4TX = *BLANKS;                                                 032400120525      /END-FREE                                                                 032500120525     C                   MOVE      *ON           *IN32                          032600120525     C                   MOVE      *ON           *IN99                          032700120525     C                   MOVE      'OEM0012'     MSGID                          032800120525     C                   CALL      RTNMTX                                       032900120525     C                   PARM                    MSGID             7            033000120525     C                   PARM                    ERRMSG          132            033100120525      /FREE                                                                     033200120525             LEAVE;                                                             033300120525           ENDIF;                                                               033400120525           //- CUSTOMER GROUP                                                   033500120525           CHAIN XWBNCD CUSGRP;                                                 033600120525           *IN99 = NOT %FOUND;                                                  033700120525           IF *IN99 = '1';                                                      033800120525      /END-FREE                                                                 033900120525     C                   MOVE      '1'           *IN33                          034000120525     C                   MOVE      'OES0374'     MSGID                          034100120525     C                   MOVEL     *ALL'-'       XWKHTX                         034200120525     C                   CALL      RTNMTX                                       034300120525     C                   PARM                    MSGID             7            034400120525     C                   PARM                    ERRMSG          132            034500120525      /FREE                                                                     034600120525             LEAVE;                                                             034700120525           ENDIF;                                                               034800120525           //- SALESMAN                                                         034900120525           CHAIN PERSON SLMEN;                                                  035000120525           *IN99 = NOT %FOUND;                                                  035100120525           IF *IN99 = '1';                                                      035200120525      /END-FREE                                                                 035300120525     C                   MOVE      '1'           *IN34                          035400120525     C                   MOVE      'OEM0023'     MSGID                          035500120525     C                   CALL      RTNMTX                                       035600120525     C                   PARM                    MSGID             7            035700120525     C                   PARM                    ERRMSG          132            035800120525     C                   MOVE      *ALL'-'       PNAME                          035900120525      /FREE                                                                     036000120525             LEAVE;                                                             036100120525           ENDIF;                                                               036200120525           //- Distributor                                                      036300120525           CHAIN DSDCDE DISTS;                                                  036400120525           *IN99 = NOT %FOUND;                                                  036500120525           IF *IN99 = '1';                                                      036600120525      /END-FREE                                                                 036700120525     C                   MOVE      '1'           *IN35                          036800120525     C                   MOVE      'OEM0018'     MSGID                          036900120525     C                   CALL      RTNMTX                                       037000120525     C                   PARM                    MSGID             7            037100120525     C                   PARM                    ERRMSG          132            037200120525     C                   MOVE      *ALL'-'       DNAME                          037300120525      /FREE                                                                     037400120525             LEAVE;                                                             037500120525           ENDIF;                                                               037600120525         ENDDO;                                                                 037700120525       ENDSR;                                                                   037800120525       //*********************************************************************  037900070305                                                                                038000120525       //*********************************************************************  038100120525       BEGSR ADDREC;                                                            038200120525         //*********************************************************************038300120525         //‚Subroutine: Add a record                                            038400120525         //*********************************************************************038500120525      /END-FREE                                                                 038600070305     C                   MOVE      '0'           *IN94                          038700070305     C                   MOVE      '1'           *IN96                          038800070305     C                   MOVE      '0'           *IN97                          038900070305     C                   MOVEL     'ADDITION'    ACTDSP                         039000120525      /FREE                                                                     039100120525         EXSR OFFIND;                                                           039200070305                                                                                039300120525         clear custsr;                                                          039400120525         pname = *blanks;                                                       039500120525         dname = *blanks;                                                       039600120525         xwkhtx = *blanks;                                                      039700120525         exsr mvdbsc;                                                           039800070305                                                                                039900120525         //‚For each screen page                                                040000120525         DOW *IN03 <> '1'                                                       040100120525         AND *IN12 <> '1';                                                      040200110823                                                                                040300120525           EXSR DSPSCNS;                                                        040400070305                                                                                040500120525           IF *IN03 = '1'                                                       040600120525           OR *IN12 = '1';                                                      040700120525             LEAVE;                                                             040800120525           ENDIF;                                                               040900070305                                                                                041000120525           IF *IN04 = '1'                                                       041100120525           OR *IN08 = '1'                                                       041200120525           OR *IN09 = '1';                                                      041300120525             ITER;                                                              041400120525           ENDIF;                                                               041500120525                                                                                041600120525           EXSR VALID1;                                                         041700120525                                                                                041800120525           //‚If errors found                                                   041900120525           IF *IN99 = '1';                                                      042000120525             //‚Display error message and re-display screen                     042100120525      /END-FREE                                                                 042200120525     C                   MOVEL     ERRMSG        ZMSAGE                         042300120525      /FREE                                                                     042400120525             exsr mvdbsc;                                                       042500120525             iter;                                                              042600120525           ENDIF;                                                               042700110823                                                                                042800120525           //‚Request confirmation                                              042900120525           EXFMT ZZCNF1;                                                        043000120525           IF *IN03 <> '1'                                                      043100120525           AND *IN12 <> '1';                                                    043200120525             //‚If confirmation received then write record                      043300120525             WRITE(E) CUSTSR;                                                   043400120525             *IN99 = %ERROR;                                                    043500120525             IF *IN99 = '1';                                                    043600120525      /END-FREE                                                                 043700120525     C                   MOVE      'Y2U0004'     MSGID                          043800120525     C                   CALL      RTNMTX                                       043900120525     C                   PARM                    MSGID             7            044000120525     C                   PARM                    ERRMSG          132            044100120525      // Display error message                                                  044200120525     C                   MOVEL     ERRMSG        ZMSAGE                         044300120525      /FREE                                                                     044400120525             ELSE;                                                              044500120525               LEAVE;                                                           044600120525             ENDIF;                                                             044700120525           ENDIF;                                                               044800070305                                                                                044900120525         ENDDO;                                                                 045000070305                                                                                045100120525       ENDSR;                                                                   045200120525       //*********************************************************************  045300070305                                                                                045400120525       //*********************************************************************  045500120525       BEGSR CHGREC;                                                            045600120525         //*********************************************************************045700120525         //‚Subroutine: Change a record                                         045800120525         //*********************************************************************045900120525      /END-FREE                                                                 046000120525     C                   MOVEL     '  UPDATE'    ACTDSP                         046100120525     C                   MOVE      '0'           *IN94                          046200070306     C                   MOVE      '0'           *IN96                          046300070305     C                   MOVE      '0'           *IN97                          046400120525      /FREE                                                                     046500120525         EXSR OFFIND;                                                           046600070305                                                                                046700120525         EXSR GETREC;                                                           046800070813                                                                                046900120525         //‚If no record or file error                                          047000120525         IF *IN99 = *OFF                                                        047100120525         AND *IN66 = *OFF;                                                      047200070305                                                                                047300120525           DOW *IN03 <> '1'                                                     047400120525           AND *IN12 <> '1';                                                    047500110823                                                                                047600120525             EXSR DSPSCNS;                                                      047700070305                                                                                047800120525             IF *IN03 = '1'                                                     047900120525             OR *IN12 = '1';                                                    048000120525               LEAVE;                                                           048100120525             ENDIF;                                                             048200070305                                                                                048300120525             IF *IN04 = '1'                                                     048400120525             OR *IN08 = '1'                                                     048500120525             OR *IN09 = '1';                                                    048600120525               ITER;                                                            048700120525             ENDIF;                                                             048800070305                                                                                048900120525             EXSR VALID1;                                                       049000070305                                                                                049100120525             //‚If errors found                                                 049200120525             IF *IN99 = '1';                                                    049300120525               //‚Display error message and re-display screen                   049400120525      /END-FREE                                                                 049500120525     C                   MOVEL     ERRMSG        ZMSAGE                         049600120525      /FREE                                                                     049700120525               exsr mvdbsc;                                                     049800120525               iter;                                                            049900120525             ENDIF;                                                             050000070305                                                                                050100120525             //‚Request confirmation                                            050200120525             EXFMT ZZCNF1;                                                      050300120525             IF *IN03 <> '1'                                                    050400120525             AND *IN12 <> '1';                                                  050500120525               //‚If confirmation received then update record                   050600120525               chain(e) xwbccd custsr;                                          050700120525               if %found(custs);                                                050800120525                 exsr mvscdb;                                                   050900120525                 UPDATE(E) CUSTSR;                                              051000120525                 *IN99 = %ERROR;                                                051100120525                 IF *IN99 = '1';                                                051200120525      /END-FREE                                                                 051300120525     C                   MOVE      'Y2U0007'     MSGID                          051400120525     C                   CALL      RTNMTX                                       051500120525     C                   PARM                    MSGID             7            051600120525     C                   PARM                    ERRMSG          132            051700120525      // Display error message                                                  051800120525     C                   MOVEL     ERRMSG        ZMSAGE                         051900120525      /FREE                                                                     052000120525                 ENDIF;                                                         052100120525               else;                                                            052200120525                 unlock(e) custs;                                               052300120525               endif;                                                           052400120525             ENDIF;                                                             052500080117                                                                                052600120525           ENDDO;                                                               052700110823                                                                                052800120525           //‚End: If no record or file error                                   052900120525         ENDIF;                                                                 053000070305                                                                                053100120525      /END-FREE                                                                 053200120525     C                   MOVE      SFLRRN        SHWREC                         053300070305                                                                                053400120525      /FREE                                                                     053500120525       ENDSR;                                                                   053600120525       //*********************************************************************  053700070305                                                                                053800120525       //*********************************************************************  053900120525       BEGSR DELREC;                                                            054000120525         //*********************************************************************054100120525         //‚Subroutine: Delete a record                                         054200120525         //*********************************************************************054300120525      /END-FREE                                                                 054400120525     C                   MOVEL     '  DELETE'    ACTDSP                         054500070305     C                   MOVE      '1'           *IN94                          054600070306     C                   MOVE      '0'           *IN96                          054700120525     C                   MOVE      '1'           *IN97                          054800120525      /FREE                                                                     054900120525         EXSR OFFIND;                                                           055000070305                                                                                055100120525         EXSR GETREC;                                                           055200070305                                                                                055300120525         DOW *IN03 <> '1'                                                       055400120525         AND *IN12 <> '1';                                                      055500110823                                                                                055600120525           EXSR DSPSCNS;                                                        055700070305                                                                                055800120525           IF *IN03 = '1'                                                       055900120525           OR *IN12 = '1';                                                      056000120525             LEAVE;                                                             056100120525           ENDIF;                                                               056200070305                                                                                056300120525           IF *IN04 = '1'                                                       056400120525           OR *IN08 = '1'                                                       056500120525           OR *IN09 = '1';                                                      056600120525             ITER;                                                              056700120525           ENDIF;                                                               056800070305                                                                                056900120525           //‚Request confirmation                                              057000120525           EXFMT ZZCNF1;                                                        057100080117                                                                                057200120525           IF *IN03 <> '1'                                                      057300120525           AND *IN12 <> '1';                                                    057400120525             //‚If confirmation received then delete record                     057500120525             chain(e) xwbccd custsr;                                            057600120525             if %found(custs);                                                  057700120525               delete(e) custsr;                                                057800120525             else;                                                              057900120525               unlock(e) custs;                                                 058000120525             endif;                                                             058100120525             LEAVE;                                                             058200120525           ENDIF;                                                               058300070309                                                                                058400120525           //‚End: If not F3/F12                                                058500120525         ENDDO;                                                                 058600070305                                                                                058700120525      /END-FREE                                                                 058800120525     C                   MOVE      SFLRRN        SHWREC                         058900070305                                                                                059000120525      /FREE                                                                     059100120525       ENDSR;                                                                   059200120525       //*********************************************************************  059300070305                                                                                059400120525       //*********************************************************************  059500120525       BEGSR DSPREC;                                                            059600120525         //*********************************************************************059700120525         //‚Subroutine: Display a record                                        059800120525         //*********************************************************************059900120525      /END-FREE                                                                 060000070305     C                   MOVE      '1'           *IN94                          060100070306     C                   MOVE      '0'           *IN96                          060200070305     C                   MOVE      '0'           *IN97                          060300120525     C                   MOVEL     ' DISPLAY'    ACTDSP                         060400120525      /FREE                                                                     060500120525         EXSR OFFIND;                                                           060600070305                                                                                060700120525         EXSR GETREC;                                                           060800080117                                                                                060900120525         DOW *IN03 <> '1'                                                       061000120525         AND *IN12 <> '1';                                                      061100110823                                                                                061200120525           EXSR DSPSCNS;                                                        061300070305                                                                                061400120525           IF *IN03 = '1'                                                       061500120525           OR *IN12 = '1';                                                      061600120525             LEAVE;                                                             061700120525           ENDIF;                                                               061800120525                                                                                061900120525           IF *IN04 = '1'                                                       062000120525           OR *IN08 = '1'                                                       062100120525           OR *IN09 = '1';                                                      062200120525             ITER;                                                              062300120525           ENDIF;                                                               062400070305                                                                                062500120525         ENDDO;                                                                 062600110823                                                                                062700120525      /END-FREE                                                                 062800120525     C                   MOVE      SFLRRN        SHWREC                         062900070305                                                                                063000120525      /FREE                                                                     063100120525       ENDSR;                                                                   063200120525       //*********************************************************************  063300070305                                                                                063400120525       //*********************************************************************  063500120525       BEGSR GETREC;                                                            063600120525         //*********************************************************************063700120525         //‚Subroutine: Retrieve a record                                       063800120525         //*********************************************************************063900120525         CHAIN(NE) XWBCCD CUSTS;                                                064000120525         *IN99 = NOT %ERROR AND NOT %FOUND;                                     064100120525         *IN66 = %ERROR;                                                        064200071221                                                                                064300120525         select;                                                                064400120525           //‚If record error                                                   064500120525         when *in99 = *on;                                                      064600120525      /END-FREE                                                                 064700120525     C                   MOVE      'OES0115'     MSGID                          064800120525     C                   CALL      RTNMTX                                       064900120525     C                   PARM                    MSGID             7            065000120525     C                   PARM                    ERRMSG          132            065100120525     C                   MOVEL     ERRMSG        ZMSAGE                         065200071221                                                                                065300120525      //‚If file error                                                          065400120525      /FREE                                                                     065500120525         when *in66 = *on;                                                      065600120525           IF FILESTS = 1218;                                                   065700120525      /END-FREE                                                                 065800120525     C                   MOVE      'Y3U9999'     MSGID                          065900120525     C                   CALL      RTNMTX                                       066000120525     C                   PARM                    MSGID             7            066100120525     C                   PARM                    ERRMSG          132            066200120525     C                   MOVEL     ERRMSG        ZMSAGE                         066300120525      /FREE                                                                     066400120525           ELSE;                                                                066500120525      /END-FREE                                                                 066600120525     C                   MOVE      'OEM0004'     MSGID                          066700120525     C                   CALL      RTNMTX                                       066800120525     C                   PARM                    MSGID             7            066900120525     C                   PARM                    ERRMSG          132            067000120525     C                   MOVEL     ERRMSG        ZMSAGE                         067100120525      /FREE                                                                     067200120525           ENDIF;                                                               067300071221                                                                                067400120525           //‚If no errors                                                      067500120525         other;                                                                 067600070305                                                                                067700120525           //‚Retrieve Salesman's name                                          067800120525           CHAIN(E) PERSON SLMEN;                                               067900120525           if not %found(slmen);                                                068000120525             pname = *all'-';                                                   068100120525           endif;                                                               068200071221                                                                                068300120525           //‚Retrieve Distributor's name                                       068400120525           CHAIN(E) DSDCDE DISTS;                                               068500120525           if not %found(dists);                                                068600120525             dname = *all'-';                                                   068700120525           endif;                                                               068800071221                                                                                068900120525           //‚Retrieve Customer Group's name                                    069000120525           CHAIN(E) XWBNCD CUSGRP;                                              069100120525           if not %found(cusgrp);                                               069200120525             xwkhtx = *all'-';                                                  069300120525           endif;                                                               069400080117                                                                                069500120525           exsr mvdbsc;                                                         069600071221                                                                                069700120525         endsl;                                                                 069800071221                                                                                069900120525       ENDSR;                                                                   070000120525       //*********************************************************************  070100070305                                                                                070200120525       //*********************************************************************  070300120525       BEGSR *INZSR;                                                            070400120525         //*********************************************************************070500120525         //‚Subroutine: Initialisation routines                                 070600120525         //*********************************************************************070700120525         //‚Initialise message subfile                                          070800120525      /END-FREE                                                                 070900070213     C                   MOVE      '1'           *IN82                          071000070212     C                   MOVEL     'WWCUSTS '    ZZPGM                          071100120525      //-‚Set date                                                              071200070130     C                   MOVE      *DATE         ZZDATE                         071300070205     C                   MOVE      *YEAR         ZYR                            071400070205     C                   MOVE      '-'           FILLR1                         071500070205     C                   MOVE      *MONTH        ZMTH                           071600070205     C                   MOVE      '-'           FILLR2                         071700070205     C                   MOVE      *DAY          ZDAY                           071800120525      /FREE                                                                     071900120525       ENDSR;                                                                   072000120525       //*********************************************************************  072100070305                                                                                072200120525       //*********************************************************************  072300120525       BEGSR SRPROM;                                                            072400120525         //*********************************************************************072500120525         //‚Subroutine: prompts for F04                                         072600120525         //*********************************************************************072700120525         SELECT;                                                                072800120525         WHEN SFIELD = 'ZPERSON';                                               072900120525      /END-FREE                                                                 073000120525     C                   CALL      'SLMENSEL'                                   073100120525     C                   PARM                    ZPERSON                        073200120525     C                   PARM                    PNAME                          073300120525      /FREE                                                                     073400120525         WHEN SFIELD = 'ZWBNCD';                                                073500120525      /END-FREE                                                                 073600120525     C                   CALL      'CUSGRSEL'                                   073700120525     C                   PARM                    ZWBNCD                         073800120525     C                   PARM                    ZWKHTX                         073900120525      /FREE                                                                     074000120525         WHEN SFIELD = 'ZDSDCDE';                                               074100120525      /END-FREE                                                                 074200120525     C                   CALL      'DISTSSEL'                                   074300120525     C                   PARM                    ZDSDCDE                        074400120525     C                   PARM                    DNAME                          074500120525      /FREE                                                                     074600120525         ENDSL;                                                                 074700120525       ENDSR;                                                                   074800120525       //*********************************************************************  074900070305                                                                                075000120525       //*********************************************************************  075100120525       BEGSR OFFIND;                                                            075200120525         //*********************************************************************075300120525         //‚Subroutine: Set error indicators to OFF                             075400120525         //*********************************************************************075500120525      /END-FREE                                                                 075600070212     C                   MOVE      *OFF          *IN99                          075700070212     C                   MOVE      *OFF          *IN31                          075800070212     C                   MOVE      *OFF          *IN32                          075900070212     C                   MOVE      *OFF          *IN33                          076000070212     C                   MOVE      *OFF          *IN34                          076100070212     C                   MOVE      *OFF          *IN35                          076200070306     C                   MOVE      *OFF          *IN36                          076300070306     C                   MOVE      *OFF          *IN37                          076400070306     C                   MOVE      *BLANKS       ZMSAGE                         076500120525      /FREE                                                                     076600120525       ENDSR;                                                                   076700120525       //*********************************************************************  076800070305                                                                                076900120525       //*********************************************************************  077000120525       BEGSR ZORDER;                                                            077100120525         //*********************************************************************077200120525         //‚Subroutine: Customer Orders                                         077300120525         //*********************************************************************077400120525         //    XWBCCD        CHAIN     CONHDRL1                           77    077500120525         //    *IN77         IFEQ      '0'                                      077600120525      /END-FREE                                                                 077700120525     C                   CALL      'WWCONHDR'                                   077800120525     C                   PARM                    XWBCCD                         077900120525      //                  ELSE                                                  078000120525      //                  MOVE      '1'           *IN99                         078100120525      //                  MOVE      'YYG0012'     MSGID                         078200120525      //                  CALL      RTNMTX                                      078300120525      //                  PARM                    MSGID             7           078400120525      //                  PARM                    ERRMSG          132           078500120525      // Display error message                                                  078600120525      //                  MOVEL     ERRMSG        ZMSAGE                        078700120525      //                  ENDIF                                                 078800120525      /FREE                                                                     078900120525       ENDSR;                                                                   079000120525       //*********************************************************************  079100070305                                                                                079200120525       //*********************************************************************  079300120525       BEGSR ZHISTO;                                                            079400120525         //*********************************************************************079500120525         //‚Subroutine: Transaction history                                     079600120525         //*********************************************************************079700120525         //    XWBCCD        CHAIN     TRNHSTL3                           77    079800120525         //    *IN77         IFEQ      '0'                                      079900120525      /END-FREE                                                                 080000120525     C                   CALL      'WWTRNHST'                                   080100120525     C                   PARM                    XWBCCD                         080200120525      //                  ELSE                                                  080300120525      //                  MOVE      '1'           *IN99                         080400120525      //                  MOVE      'YYG0012'     MSGID                         080500120525      //                  CALL      RTNMTX                                      080600120525      //                  PARM                    MSGID             7           080700120525      //                  PARM                    ERRMSG          132           080800120525      // Display error message                                                  080900120525      //                  MOVEL     ERRMSG        ZMSAGE                        081000120525      //                  ENDIF                                                 081100120525      /FREE                                                                     081200120525       ENDSR;                                                                   081300120525       //*********************************************************************  081400120525       BEGSR MVDBSC;                                                            081500120525      /END-FREE                                                                 081600120525     C                   MOVEL     XWBCCD        ZWBCCD                         081700120525     C                   MOVEL     XWG4TX        ZWG4TX                         081800120525     C                   MOVEL     XWB2CD        ZWB2CD                         081900120525     C                   MOVEL     XWB3CD        ZWB3CD                         082000120525     C                   MOVEL     XWHITX        ZWHITX                         082100120525     C                   MOVEL     XWE0NB        ZWE0NB                         082200120525     C                   MOVEL     XWJUN0        ZWJUN0                         082300120525     C                   MOVEL     XWDVCD        ZWDVCD                         082400120525     C                   MOVEL     XWBNCD        ZWBNCD                         082500120525     C                   MOVEL     PERSON        ZPERSON                        082600120525     C                   MOVEL     DSDCDE        ZDSDCDE                        082700120525     C                   MOVEL     XWBTCD        ZWBTCD                         082800120525     C                   MOVEL     XWGIVA        ZWGIVA                         082900120525     C                   MOVEL     XWAOCD        ZWAOCD                         083000120525     C                   MOVEL     XWBBCD        ZWBBCD                         083100120525     C                   MOVEL     XWG4T0        ZWG4T0                         083200120525     C                   MOVEL     XWC7ST        ZWC7ST                         083300120525     C                   MOVEL     XWDAST        ZWDAST                         083400120525     C                   MOVEL     XWBPD0        ZWBPD0                         083500120525     C                   MOVEL     XWBAD0        ZWBAD0                         083600120525     C                   MOVEL     XWKHTX        ZWKHTX                         083700120525      /FREE                                                                     083800120525       ENDSR;                                                                   083900120525       //*********************************************************************  084000120525       BEGSR MVSCDB;                                                            084100120525      /END-FREE                                                                 084200120525     C                   MOVEL     ZWBCCD        XWBCCD                         084300120525     C                   MOVEL     ZWG4TX        XWG4TX                         084400120525     C                   MOVEL     ZWB2CD        XWB2CD                         084500120525     C                   MOVEL     ZWB3CD        XWB3CD                         084600120525     C                   MOVEL     ZWHITX        XWHITX                         084700120525     C                   MOVEL     ZWE0NB        XWE0NB                         084800120525     C                   MOVEL     ZWJUN0        XWJUN0                         084900120525     C                   MOVEL     ZWDVCD        XWDVCD                         085000120525     C                   MOVEL     ZWBNCD        XWBNCD                         085100120525     C                   MOVEL     ZPERSON       PERSON                         085200120525     C                   MOVEL     ZDSDCDE       DSDCDE                         085300120525     C                   MOVEL     ZWBTCD        XWBTCD                         085400120525     C                   MOVEL     ZWGIVA        XWGIVA                         085500120525     C                   MOVEL     ZWAOCD        XWAOCD                         085600120525     C                   MOVEL     ZWBBCD        XWBBCD                         085700120525     C                   MOVEL     ZWG4T0        XWG4T0                         085800120525     C                   MOVEL     ZWC7ST        XWC7ST                         085900120525     C                   MOVEL     ZWDAST        XWDAST                         086000120525     C                   MOVEL     ZWBPD0        XWBPD0                         086100120525     C                   MOVEL     ZWBAD0        XWBAD0                         086200120525     C                   MOVEL     ZWKHTX        XWKHTX                         086300120525      /FREE                                                                     086400120525       ENDSR;                                                                   086500120525       //*********************************************************************  086600120525      /END-FREE                                                                 