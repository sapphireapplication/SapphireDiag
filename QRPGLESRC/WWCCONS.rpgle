000100070317     H*‚--------------------------------------------------------------------    000200050726     H*ˆCOPYRIGHT DATABOROUGH LTD 2005                                          000300050818     H*ˆPROGRAM:  Work with Customer Contacts                                   000400010705     H*‚--------------------------------------------------------------------    000500050804     H debug(*yes) copyright('Databorough Ltd. 2005')                           000600980127                                                                                000700980122     F**********************************************************************    000800990528     F*‚F i l e s                                                               000900980122     F**********************************************************************    001000050818     Fwwcconsd  cf   e             workstn sfile(zzsf01:sflrrn)                 001100050818     Fcntacs    if   e           k disk                                         001200980126                                                                                001300980126     D**********************************************************************    001400990528     D*‚D e f i n i t i o n s                                                   001500980126     D**********************************************************************    001600050818     D customer        s              5p 0                                      001700020906     D sflchanged      s               n   inz(*off)                            001800020906     D sflrrn          s              5p 0                                      001900020906     D zcmd            s            200a                                        002000050804     D mainloop        s              5p 0 inz(*zeros)                          002100050804     D cdate           s               d   datfmt(*iso) inz(*sys)               002200050818     D dsdate          s               d   datfmt(*iso)                         002300010705                                                                                002400050818     D xfdate          ds             6                                         002500050818     D  numdate                       6s 0                                      002600050818     D  chardate                      6a   overlay(numdate)                     002700050818                                                                                002800050804     D xbcclmsg        pr                  extpgm('XBCCLMSG')                   002900020906                                                                                003000020906     D xmcsnmsg        pr                  extpgm('XMCSNMSG')                   003100050726     D                                7a   const                                003200050726     D                               10a   const                                003300050726     D                               10a   const                                003400050726     D                               50a   const                                003500050726     D                               10a   const                                003600050726     D                                7a   const                                003700050826                                                                                003800050826     D cusfsel         pr                  extpgm('CUSFSEL')                    003900050826     D                                5p 0                                      004000011119                                                                                004100050804      /free                                                                     004200050804       // ******************************************************************    004300050804       //‚M a i n l i n e   C o d e                                             004400050804       // ******************************************************************    004500050804       dow mainloop < *hival;                                                   004600050804                                                                                004700050804       //‚Build subfile                                                         004800050804       exsr zsflwrt;                                                            004900050804       //‚Display screens                                                       005000050804       write(e) zztr01;                                                         005100050804       write(e) zzmc01;                                                         005200050804       exfmt(e) zzct01;                                                         005300050804       //‚Remove messages                                                       005400050804       xbcclmsg();                                                              005500050804       //‚Action command keys                                                   005600050804       if *in28;                                                                005700050804       exsr zcmdkeys;                                                           005800050804       else;                                                                    005900050804       //‚Else action selections                                                006000050804       exsr zselect;                                                            006100050804       endif;                                                                   006200050804                                                                                006300050804       enddo;                                                                   006400050804       // ******************************************************************    006500050804       //‚L o g i c a l   E n d   o f   P r o g r a m                           006600050804       // ******************************************************************    006700050804                                                                                006800050804       // ******************************************************************    006900050804       begsr zsflwrt;                                                           007000050804       // ******************************************************************    007100050804       //‚Subroutine: Write data to subfile                                     007200050804       // ******************************************************************    007300050804       //‚Delete subfile                                                        007400050804       if *in40;                                                                007500050804       *in30 = *on;                                                             007600050804       write(e) zzct01;                                                         007700050804       *in30 = *off;                                                            007800050804       endif;                                                                   007900050804       //‚Write subfile                                                         008000050804       *in31 = *off;                                                            008100050804       sflrrn = *zeros;                                                         008200991115                                                                                008300050818       setll(e) customer rcntac;                                                008400050818       reade(e) customer rcntac;                                                008500020906                                                                                008600050818       dow not %eof(cntacs) and not %error;                                     008700991115                                                                                008800050804       sflrrn = sflrrn + 1;                                                     008900050804       dssel = *blanks;                                                         009000050818       dsprpcde = prpcde;                                                       009100050818       dsusernm = usernm;                                                       009200050804       dstelno = telno;                                                         009300050804       write(e) zzsf01;                                                         009400991115                                                                                009500050818       reade(e) customer rcntac;                                                009600050804       enddo;                                                                   009700991115                                                                                009800050804       if sflrrn > *zeros;                                                      009900991115                                                                                010000050804       if not sflchanged;                                                       010100050804       dsprec = 1;                                                              010200050804       endif;                                                                   010300991115                                                                                010400050804       if dsprec > sflrrn                                                       010500050804        or dsprec < 1;                                                          010600050804       dsprec = 1;                                                              010700050804       endif;                                                                   010800020423                                                                                010900050804       *in40 = *on;                                                             011000050804       *in31 = *on;                                                             011100991115                                                                                011200050804       endif;                                                                   011300991115                                                                                011400050804       endsr;                                                                   011500050804       // ******************************************************************    011600050804                                                                                011700050804       // ******************************************************************    011800050804       begsr zselect;                                                           011900050804       // ******************************************************************    012000050804       //‚Subroutine: Action selection                                          012100050804       // ******************************************************************    012200050804       sflchanged = *off;                                                       012300980126                                                                                012400050804       readc(e) zzsf01;                                                         012500980126                                                                                012600050804       //‚For each selection                                                    012700050804       dow not %eof and not %error;                                             012800980126                                                                                012900050804       sflchanged = *on;                                                        013000980126                                                                                013100050804       select;                                                                  013200020906                                                                                013300050804       //‚Display                                                               013400050804       when dssel = ' 5' or dssel = '5 ';                                       013500050804       exsr zdisplay;                                                           013600050804       dsprec = sflrrn;                                                         013700980126                                                                                013800050804       endsl;                                                                   013900980126                                                                                014000050804       dssel = *blanks;                                                         014100050804       update(e) zzsf01;                                                        014200980126                                                                                014300050804       readc(e) zzsf01;                                                         014400980126                                                                                014500050804       //‚End: For each selection                                               014600050804       enddo;                                                                   014700980126                                                                                014800050804       //‚If changes made then update display                                   014900050804       if sflchanged;                                                           015000050804       exsr zsflwrt;                                                            015100050804       endif;                                                                   015200980126                                                                                015300050804       endsr;                                                                   015400050804       // ******************************************************************    015500050804                                                                                015600050804       // ******************************************************************    015700050804       begsr zdisplay;                                                          015800050804       // ******************************************************************    015900050804       //‚Subroutine: Display record                                            016000050804       // ******************************************************************    016100050818       chain(e) dscusno rcntac;                                                 016200050804                                                                                016300050818       if %found(cntacs);                                                       016400050804                                                                                016500050804       dscusno = cusno;                                                         016600050818       dsprpcde = prpcde;                                                       016700050818       dsusernm = usernm;                                                       016800050818       dstelno = telno;                                                         016900050818       dsfaxno = faxno;                                                         017000050818       dsemail = email;                                                         017001110913       //dsemail = email;                                                       017100050818       numdate = lctdat;                                                        017200050818       dsdate = %date(chardate:*YMD0);                                          017300050818       dslctdat = %char(dsdate);                                                017400050818       numdate = apdate;                                                        017500050818       dsdate = %date(chardate:*YMD0);                                          017600050818       dsapdate = %char(dsdate);                                                017700050818       dssinit = sinit;                                                         017800050804       dsstatus = status;                                                       017900050804                                                                                018000050804       dow not *in03 and not *in12;                                             018100050804                                                                                018200050804       *in34 = *on;                                                             018300050804       write(e) zztr01;                                                         018400050804       write(e) zzmc01;                                                         018500050804       exfmt(e) zzft01;                                                         018600050804       xbcclmsg();                                                              018700020906                                                                                018800050804       enddo;                                                                   018900020909                                                                                019000050804       endif;                                                                   019100020906                                                                                019200050804       endsr;                                                                   019300050804       // ******************************************************************    019400050804                                                                                019500050804       // ******************************************************************    019600050804       begsr zcmdkeys;                                                          019700050804       // ******************************************************************    019800050804       //‚Subroutine: Action command keys                                       019900050804       // ******************************************************************    020000050804       select;                                                                  020100050804       when *in03;                                                              020200050804       exsr zf03;                                                               020300050804       when *in12;                                                              020400050804       exsr zf12;                                                               020401110913       // leavesr;                                                              020500050804       endsl;                                                                   020600020906                                                                                020700050804       endsr;                                                                   020800050804       // ******************************************************************    020900050804                                                                                021000050804       // ******************************************************************    021100050804       begsr zf03;                                                              021200050804       // ******************************************************************    021300050804       //‚Subroutine: F3=Exit                                                   021400050804       // ******************************************************************    021500050804       *inlr = *on;                                                             021600050804       return;                                                                  021700050804                                                                                021800050804       endsr;                                                                   021900050804       // ******************************************************************    022000050804                                                                                022100050804       // ******************************************************************    022200050804       begsr zf12;                                                              022300050804       // ******************************************************************    022400050804       //‚Subroutine: F12=Cancel                                                022500050804       // ******************************************************************    022600050804       *inlr = *on;                                                             022700050804       return;                                                                  022800050804                                                                                022900050804       endsr;                                                                   023000050804       // ******************************************************************    023100020906                                                                                023200050804       begsr *inzsr;                                                            023300050804       // ******************************************************************    023400050804       //‚Subroutine: Initialisation routines                                   023500050804       // ******************************************************************    023600021001                                                                                023700050804       //‚Initialise message subfile                                            023800050804       *in32 = *on;                                                             023900050818       zzpgm = 'WWCCONS';                                                       024000980126                                                                                024100050804       //‚Set date                                                              024200050804       zzdate = %char(cdate);                                                   024300050826                                                                                024400050826       //‚If customer number not provided then prompt                           024500050826       if customer = *zeros;                                                    024600050826       cusfsel(customer);                                                       024700050826       endif;                                                                   024800050818                                                                                024900050818       //‚Set displayed customer no.                                            025000050818       dscusno = customer;                                                      025100020320                                                                                025200050804       endsr;                                                                   025300050804       // ******************************************************************    025400050804                                                                                025500050804      /end-free                                                                 025600050818                                                                                025700050818     C**********************************************************************    025800050818     C*‚N o n - E x e c u t a b l e   C o d e                                   025900050818     C**********************************************************************    026000050818     C     *entry        plist                                                  026100050818     C                   parm                    customer                       026200050818     C**********************************************************************    