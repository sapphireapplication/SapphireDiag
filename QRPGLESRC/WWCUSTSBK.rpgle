000100070317     H*‚--------------------------------------------------------------------    000200071221     H*ˆCOPYRIGHT DATABOROUGH LTD 2007                                          000300070212     H*ˆPROGRAM:  Work with Customers                                           000400010705     H*‚--------------------------------------------------------------------    000500070131     H DATEDIT(*YMD)                                                            000600980122     F**********************************************************************    000700990528     F*‚F i l e s                                                               000800980122     F**********************************************************************    000900110103     FWCUSTSD   CF   E             WORKSTN                                      001000070130     F                                     SFILE(ZZSF01:SFLRRN)                 001100070212     FCUSTS     UF A E           K DISK                                         001200070813     F                                     INFDS(FILEDS)                        001300070213     FSLMEN     IF   E           K DISK                                         001400070213     FCUSFL3    IF   E           K DISK                                         001500070213     FCUSGRP    IF   E           K DISK                                         001600070213     FDISTS     IF   E           K DISK                                         001700070213     FCONHDRL1  IF   E           K DISK                                         001800070213     FTRNHSTL3  IF   E           K DISK                                         001900070213     D**********************************************************************    002000070213     D*‚D e f i n i t i o n s                                                   002100070213     D**********************************************************************    002200070130     D*‚Set constants                                                           002300070131     D RTNMTX          C                   CONST('RTNMSGTEXT')                  002400070213     D INIDAT          C                   CONST('0001-01-01')                  002500070813                                                                                002600070813     d FILEDS          ds                                                       002700070813     d  FILESTS               11     15s 0                                      002800070303                                                                                002900070305     D  pageno         s              3p 0                                      003000070305     D  noofpages      s              3p 0 inz(2)                               003100070305     D  sflrrn         s              5p 0                                      003200070305     D  sflchg         s              1a   inz('0')                             003300110103     D  sflCTR         s              3P 0                                      003400070303                                                                                003500070205     D                 DS                  INZ                                  003600070213     D  ZDATE                  1     10                                         003700070205     D  ZYR                    1      4                                         003800070205     D  FILLR1                 5      5                                         003900070205     D  ZMTH                   6      7                                         004000070205     D  FILLR2                 8      8                                         004100070205     D  ZDAY                   9     10                                         004200070303                                                                                004300070130     I**********************************************************************    004400070213     IRCUSF                                                                     004500070213     I              DSDCDE                      XSDCDE                          004600070305                                                                                004700070303     C**********************************************************************    004800070130     C*‚M a i n l i n e   C o d e                                               004900070303     C**********************************************************************    005000070202     C*‚Build subfile                                                           005100070202     C                   EXSR      SFLWRT                                       005200070305                                                                                005300070130     C     *IN03         DOWEQ     '0'                                          005400070130     C     *IN12         ANDEQ     '0'                                          005500070212     C                   MOVE      *BLANKS       LOCATE                         005600070219     C*‚Display screens                                                         005700070201     C                   WRITE     ZZTR01                                       005800070215     C   99              WRITE     ZZMC01                                       005900070131     C                   EXFMT     ZZCT01                                       006000070219     C*‚Remove messages                                                         006100070130     C                   CALL      'XBCCLMSG'                                   006200070131     C     *IN03         IFEQ      '1'                                          006300070131     C     *IN12         OREQ      '1'                                          006400070131     C                   LEAVE                                                  006500070131     C                   ENDIF                                                  006600070303     C*‚Action positioner request                                               006700070212     C     LOCATE        IFNE      *BLANKS                                      006800110103     C                   MOVE      *ZEROS        SFLRRN                         006900070212     C                   MOVE      LOCATE        XWBCCD                         007000070202     C                   EXSR      SFLWRT                                       007100070202     C                   ITER                                                   007200070202     C                   ENDIF                                                  007300070219     C*‚Action command keys                                                     007400070130     C     *IN28         IFEQ      '1'                                          007500070130     C                   EXSR      CMDKEY                                       007600070130     C                   ELSE                                                   007700070219     C*‚Else action selections                                                  007800070130     C                   EXSR      ZSELEC                                       007900070130     C                   ENDIF                                                  008000070219     C*‚If changes made then update display                                     008100070209     C     SFLCHG        IFEQ      '1'                                          008200070212     C                   MOVE      *LOVAL        XWBCCD                         008300070209     C                   EXSR      SFLWRT                                       008400070209     C                   ENDIF                                                  008500071221                                                                                008600070130     C                   ENDDO                                                  008700070305                                                                                008800070131     C                   MOVE      '1'           *INLR                          008900070131     C                   RETURN                                                 009000070303     C**********************************************************************    009100070130     C*‚L o g i c a l   E n d   o f   P r o g r a m                             009200070303     C**********************************************************************    009300070303                                                                                009400070303     C**********************************************************************    009500070130     C     SFLWRT        BEGSR                                                  009600070303     C**********************************************************************    009700070130     C*‚Subroutine: Write data to subfile                                       009800070303     C**********************************************************************    009900070130     C*‚Delete subfile                                                          010000110103     C                   IF        SFLRRN = 0                                   010100070131     C                   SETON                                        74        010200070213     C                   SETOFF                                       717281    010300070131     C                   WRITE     ZZCT01                               99      010400070131     C                   SETOFF                                       74        010500070130     C*‚Write subfile                                                           010600070130     C                   MOVE      *ZEROS        SFLRRN                         010700070213     C     XWBCCD        SETLL     CUSTS                                        010800110103     C                   ENDIF                                                  010900110103     C*                                                                         011000110103     C                   MOVE      *ZEROS        SFLCTR                         011100070213     C     *IN81         DOWEQ     '0'                                          011200110103     C     SFLCTR        ANDLT     12                                           011300110103     C                   READ(N)   CUSTS                                  81    011400110104     C     *IN81         IFEQ      '0'                                          011500070130     C                   ADD       1             SFLRRN                         011600110103     C                   ADD       1             SFLCTR                         011700110103     C                   IF        SFLCTR = 1                                   011800110103     C                   Z-ADD     SFLRRN        SHWREC                         011900110103     C                   ENDIF                                                  012000070130     C                   MOVE      *BLANKS       DSSEL                          012100070130     C                   WRITE     ZZSF01                               99      012200110103     C                   ENDIF                                                  012300070130     C                   ENDDO                                                  012400070303                                                                                012500110103     C     SFLRRN        IFGT      0                                            012600070131     C                   SETON                                        71        012700070130     C                   ENDIF                                                  012800070131     C                   SETON                                        72        012900071221                                                                                013000070130     C                   ENDSR                                                  013100070303     C**********************************************************************    013200070305                                                                                013300070305     C**********************************************************************    013400070305     C     CMDKEY        BEGSR                                                  013500070305     C**********************************************************************    013600070305     C*‚Subroutine: Action command keys                                         013700070305     C**********************************************************************    013800070305     C                   SELECT                                                 013900110103                                                                                014000110103     C     *IN26         WHENEQ    '1'                                          014100110103     C                   EXSR      SFLWRT                                       014200070305                                                                                014300070305     C     *IN06         WHENEQ    '1'                                          014400070305     C                   EXSR      addrec                                       014500070305     C                   Z-ADD     1             SHWREC                         014600070305     C                   MOVE      '1'           SFLCHG                         014700070305     C                   ENDSL                                                  014800070305                                                                                014900070305     C                   MOVE      '0'           *IN12                          015000070305                                                                                015100070305     C                   ENDSR                                                  015200070305     C**********************************************************************    015300070303                                                                                015400070303     C**********************************************************************    015500070130     C     ZSELEC        BEGSR                                                  015600070303     C**********************************************************************    015700070130     C*‚Subroutine: Action selection                                            015800070303     C**********************************************************************    015900070130     C                   MOVE      '0'           SFLCHG                         016000070130     C                   READC     ZZSF01                                 35    016100070305                                                                                016200070130     C*‚For each selection                                                      016300070130     C     *IN35         DOWEQ     '0'                                          016400070130     C                   MOVE      '1'           SFLCHG                         016500070303                                                                                016600070213     C                   SELECT                                                 016700070219     C*‚Change                                                                  016800070213     C     DSSEL         WHENEQ    '2'                                          016900070305     C                   EXSR      chgrec                                       017000070219     C*‚Delete                                                                  017100070303     C     DSSEL         WHENEQ    '4'                                          017200070305     C                   EXSR      delrec                                       017300070219     C*‚Display                                                                 017400070303     C     DSSEL         WHENEQ    '5'                                          017500070305     C                   EXSR      dsprec                                       017600070718     C*‚Customer Detail Maintenance                                             017700070718     C     DSSEL         WHENEQ    '6'                                          017800070809     C                   call      'CUSTMNT1'                                   017900070718     C                   parm                    XWBCCD                         018000070305     C*‚Work with Orders                                                        018100070213     C     DSSEL         WHENEQ    '8'                                          018200090304     C                   EXSR      ZORDER                                       018300070305     C*‚Work with Transaction history                                           018400070213     C     DSSEL         WHENEQ    '9'                                          018500090304     C                   EXSR      ZHISTO                                       018600070213     C                   ENDSL                                                  018700070303                                                                                018800070130     C                   MOVE      *BLANKS       DSSEL                          018900070130     C                   UPDATE    ZZSF01                               99      019000070130     C                   READC     ZZSF01                                 35    019100070305                                                                                019200070219     C*‚End: For each selection                                                 019300070130     C                   ENDDO                                                  019400070303                                                                                019500070130     C                   MOVE      '0'           *IN12                          019600070303                                                                                019700070130     C                   ENDSR                                                  019800070303     C**********************************************************************    019900070303                                                                                020000070303     C**********************************************************************    020100070305     C     dspscns       BEGSR                                                  020200070303     C**********************************************************************    020300070305     C*‚Subroutine: Display detail screens                                      020400070303     C**********************************************************************    020500070305     C*‚Display screen, depending upon page no.                                 020600070305     C                   select                                                 020700070305     C                   when      pageno = 1                                   020800070305     C                   EXFMT     ZZFT01                                       020900070305     C                   when      pageno = 2                                   021000070305     C                   EXFMT     ZZFT02                                       021100070305     C                   endsl                                                  021200080208     C                   EXSR      MVSCDB                                       021300070305                                                                                021400070130     C                   CALL      'XBCCLMSG'                                   021500070306     C                   EXSR      OFFIND                                       021600070305                                                                                021700070305     C*‚Process Command Keys                                                    021800070212     C                   SELECT                                                 021900070305     C*‚Prompt                                                                  022000070212     C     *IN04         WHENEQ    '1'                                          022100070213     C                   EXSR      SRPROM                                       022200070219     C*‚Orders                                                                  022300070213     C     *IN08         WHENEQ    '1'                                          022400090304     C                   EXSR      ZORDER                                       022500070219     C*‚Transaction history                                                     022600070213     C     *IN09         WHENEQ    '1'                                          022700090304     C                   EXSR      ZHISTO                                       022800070201     C                   ENDSL                                                  022900070305                                                                                023000070130     C                   ENDSR                                                  023100070305     C**********************************************************************    023200070305                                                                                023300070305     C**********************************************************************    023400070216     C     VALID1        BEGSR                                                  023500070305     C**********************************************************************    023600070305     C*‚Subroutine: Validation #1                                               023700070305     C**********************************************************************    023800070201     C                   DO                                                     023900070219     C* WHEN ADDING CUSTOMER MUST NOT BE ZERO                                   024000070212     C     XWBCCD        IFEQ      *BLANKS                                      024100070209     C                   MOVE      '1'           *IN99                          024200070212     C                   MOVE      *ON           *IN31                          024300070213     C                   MOVE      'OEM0002'     MSGID                          024400070209     C                   CALL      RTNMTX                                       024500070209     C                   PARM                    MSGID             7            024600070209     C                   PARM                    ERRMSG          132            024700070209     C                   LEAVE                                                  024800070209     C                   ENDIF                                                  024900070219     C* WHEN ADDING CUSTOMER MUST NOT EXIST                                     025000090303     C     ACTDSP        IFEQ      'ADDITION'                                   025100070212     C     XWBCCD        SETLL     CUSTS                                  99    025200070209     C     *IN99         IFEQ      '1'                                          025300070212     C                   MOVE      *ON           *IN31                          025400070209     C                   MOVE      'Y2U0003'     MSGID                          025500070213     C                   MOVEL     *ALL'-'       XWG4TX                         025600070209     C                   CALL      RTNMTX                                       025700070209     C                   PARM                    MSGID             7            025800070209     C                   PARM                    ERRMSG          132            025900070209     C                   LEAVE                                                  026000070209     C                   ENDIF                                                  026100070209     C                   ENDIF                                                  026200070219     C*‚Customer name                                                           026300070213     C     XWG4TX        IFEQ      *BLANKS                                      026400070212     C                   MOVE      *ON           *IN32                          026500070212     C                   MOVE      *ON           *IN99                          026600070212     C                   MOVE      'OEM0012'     MSGID                          026700070212     C                   CALL      RTNMTX                                       026800070212     C                   PARM                    MSGID             7            026900070212     C                   PARM                    ERRMSG          132            027000070212     C                   LEAVE                                                  027100070212     C                   ENDIF                                                  027200070219     C*- CUSTOMER GROUP                                                         027300070306     C     XWBNCD        CHAIN     CUSGRP                             99        027400070213     C     *IN99         IFEQ      '1'                                          027500070213     C                   MOVE      '1'           *IN33                          027600070213     C                   MOVE      'OES0374'     MSGID                          027700070213     C                   MOVEL     *ALL'-'       XWKHTX                         027800070213     C                   CALL      RTNMTX                                       027900070213     C                   PARM                    MSGID             7            028000070213     C                   PARM                    ERRMSG          132            028100070213     C                   LEAVE                                                  028200070213     C                   ENDIF                                                  028300070219     C*- SALESMAN                                                               028400070306     C     PERSON        CHAIN     SLMEN                              99        028500070213     C     *IN99         IFEQ      '1'                                          028600070213     C                   MOVE      '1'           *IN34                          028700070213     C                   MOVE      'OEM0023'     MSGID                          028800070213     C                   CALL      RTNMTX                                       028900070213     C                   PARM                    MSGID             7            029000070213     C                   PARM                    ERRMSG          132            029100070213     C                   MOVE      *ALL'-'       PNAME                          029200070213     C                   LEAVE                                                  029300070213     C                   ENDIF                                                  029400070219     C*- Distributor                                                            029500070306     C     DSDCDE        CHAIN     DISTS                              99        029600070213     C     *IN99         IFEQ      '1'                                          029700070213     C                   MOVE      '1'           *IN35                          029800070213     C                   MOVE      'OEM0018'     MSGID                          029900070213     C                   CALL      RTNMTX                                       030000070213     C                   PARM                    MSGID             7            030100070213     C                   PARM                    ERRMSG          132            030200070213     C                   MOVE      *ALL'-'       DNAME                          030300070213     C                   LEAVE                                                  030400070213     C                   ENDIF                                                  030500070201     C                   ENDDO                                                  030600070131     C                   ENDSR                                                  030700070305     C**********************************************************************    030800070305                                                                                030900070305     C**********************************************************************    031000070216     C     VALID2        BEGSR                                                  031100070305     C**********************************************************************    031200070305     C*‚Subroutine: Validation #2                                               031300070305     C**********************************************************************    031400070216     C                   DO                                                     031500070219     C*- BALANCE                                                                031600090401     C     ACTDSP        IFNE      'ADDITION'                                   031700090401     C     XWGIVA        SUB       XWIDV0        XDIFF            15 2          031800090401     C     XDIFF         IFLT      *ZERO                                        031900090401     C                   MOVE      '1'           *IN99                          032000090401     C                   MOVE      '1'           *IN36                          032100090401     C                   MOVE      'OES0373'     MSGID                          032200090401     C                   CALL      RTNMTX                                       032300090401     C                   PARM                    MSGID             7            032400090401     C                   PARM                    ERRMSG          132            032500090401     C                   LEAVE                                                  032600090401     C                   ENDIF                                                  032700090401     C                   ENDIF                                                  032800070219     C*- CUSTOMER CANNOT BE ZERO                                                032900070216     C     CUSNO         IFEQ      *ZEROS                                       033000070216     C                   MOVE      '1'           *IN37                          033100070216     C                   MOVE      '1'           *IN99                          033200070216     C                   MOVE      'CNP0008'     MSGID                          033300070216     C                   CALL      RTNMTX                                       033400070216     C                   PARM                    MSGID             7            033500070216     C                   PARM                    ERRMSG          132            033600070216     C                   LEAVE                                                  033700070216     C                   ENDIF                                                  033800070219     C*- CUSTOMER                                                               033900070306     C     CUSNO         CHAIN     CUSFL3                             99        034000070216     C     *IN99         IFEQ      '1'                                          034100070216     C                   MOVE      '1'           *IN37                          034200070216     C                   MOVE      'CNP0002'     MSGID                          034300070216     C                   CALL      RTNMTX                                       034400070216     C                   PARM                    MSGID             7            034500070216     C                   PARM                    ERRMSG          132            034600070216     C                   LEAVE                                                  034700070216     C                   ENDIF                                                  034800070216     C                   ENDDO                                                  034900070216     C                   ENDSR                                                  035000070305     C**********************************************************************    035100070305                                                                                035200070305     C**********************************************************************    035300070305     C     ADDREC        BEGSR                                                  035400070305     C**********************************************************************    035500070305     C*‚Subroutine: Add a record                                                035600070305     C**********************************************************************    035700070305     C                   MOVE      '0'           *IN94                          035800070305     C                   MOVE      '1'           *IN96                          035900070305     C                   MOVE      '0'           *IN97                          036000070305     C                   MOVEL     'ADDITION'    ACTDSP                         036100070306     C                   EXSR      OFFIND                                       036200070305                                                                                036300070305     C                   clear                   custsr                         036400080208     C                   eval      pname = *blanks                              036500080208     C                   eval      dname = *blanks                              036600080208     C                   eval      xwkhtx = *blanks                             036700080208     C                   exsr      mvdbsc                                       036800070305                                                                                036900070305     C                   eval      pageno = 1                                   037000070305                                                                                037100070305     C*‚For each screen page                                                    037200070305     C                   dow       pageno <= noofpages                          037300070305                                                                                037400070305     C                   EXSR      DSPSCNS                                      037500070305                                                                                037600070305     C     *IN03         IFEQ      '1'                                          037700070305     C     *IN12         OREQ      '1'                                          037800070305     C                   LEAVE                                                  037900070305     C                   ENDIF                                                  038000070305                                                                                038100070305     C     *IN04         IFEQ      '1'                                          038200070305     C     *IN08         OREQ      '1'                                          038300070305     C     *IN09         OREQ      '1'                                          038400070305     C                   ITER                                                   038500070305     C                   ENDIF                                                  038600070305                                                                                038700070305     C                   select                                                 038800070305     C                   when      pageno = 1                                   038900070305     C                   EXSR      VALID1                                       039000070305     C                   when      pageno = 2                                   039100070305     C                   EXSR      VALID2                                       039200070305     C                   endsl                                                  039300070305                                                                                039400070305     C*‚If errors found                                                         039500070305     C     *IN99         IFEQ      '1'                                          039600070305     C*‚Display error message and re-display screen                             039700070305     C                   MOVEL     ERRMSG        ZMSAGE                         039800080208     C                   exsr      mvdbsc                                       039900070305     C                   iter                                                   040000070305     C                   ENDIF                                                  040100070305                                                                                040200070305     C                   eval      pageno = pageno + 1                          040300070305                                                                                040400070305     C*‚End: For each screen page                                               040500070305     C                   ENDDO                                                  040600070305                                                                                040700070305     C*‚If not F3/F12                                                           040800070305     C     *IN03         IFNE      '1'                                          040900070305     C     *IN12         ANDNE     '1'                                          041000070305                                                                                041100070309     C*‚Request confirmation                                                    041200070309     C                   EXFMT     ZZCNF1                                       041300070309     C     *IN03         IFNE      '1'                                          041400070309     C     *IN12         ANDNE     '1'                                          041500070309     C*‚If confirmation received then write record                              041600070305     C                   WRITE     CUSTSR                               99      041700070305     C     *IN99         IFEQ      '1'                                          041800070305     C                   MOVE      'Y2U0004'     MSGID                          041900070305     C                   CALL      RTNMTX                                       042000070305     C                   PARM                    MSGID             7            042100070305     C                   PARM                    ERRMSG          132            042200070305     C* Display error message                                                   042300070305     C                   MOVEL     ERRMSG        ZMSAGE                         042400070305     C                   ENDIF                                                  042500070309     C                   ENDIF                                                  042600070305                                                                                042700070305     C*‚End: If not F3/F12                                                      042800070305     C                   ENDIF                                                  042900070305                                                                                043000070305     C                   ENDSR                                                  043100070305     C**********************************************************************    043200070305                                                                                043300070305     C**********************************************************************    043400070305     C     CHGREC        BEGSR                                                  043500070305     C**********************************************************************    043600070305     C*‚Subroutine: Change a record                                             043700070305     C**********************************************************************    043800070305     C                   MOVEL     '  UPDATE'    ACTDSP                         043900070305     C                   MOVE      '0'           *IN94                          044000070306     C                   MOVE      '0'           *IN96                          044100070305     C                   MOVE      '0'           *IN97                          044200070306     C                   EXSR      OFFIND                                       044300070305                                                                                044400070305     C                   EXSR      GETREC                                       044500070813                                                                                044600080117     C*‚If no record or file error                                              044700070813     C     *IN99         IFEQ      *OFF                                         044800070813     C     *IN66         ANDEQ     *OFF                                         044900070305                                                                                045000070305     C                   eval      pageno = 1                                   045100070305                                                                                045200070305     C*‚For each screen page                                                    045300070305     C                   dow       pageno <= noofpages                          045400070305                                                                                045500070305     C                   EXSR      DSPSCNS                                      045600070305                                                                                045700070305     C     *IN03         IFEQ      '1'                                          045800070305     C     *IN12         OREQ      '1'                                          045900070305     C                   LEAVE                                                  046000070305     C                   ENDIF                                                  046100070305                                                                                046200070305     C     *IN04         IFEQ      '1'                                          046300070305     C     *IN08         OREQ      '1'                                          046400070305     C     *IN09         OREQ      '1'                                          046500070305     C                   ITER                                                   046600070305     C                   ENDIF                                                  046700070305                                                                                046800070305     C                   select                                                 046900070305     C                   when      pageno = 1                                   047000070305     C                   EXSR      VALID1                                       047100070305     C                   when      pageno = 2                                   047200070305     C                   EXSR      VALID2                                       047300070305     C                   endsl                                                  047400070305                                                                                047500070305     C*‚If errors found                                                         047600070305     C     *IN99         IFEQ      '1'                                          047700070305     C*‚Display error message and re-display screen                             047800070305     C                   MOVEL     ERRMSG        ZMSAGE                         047900080208     C                   exsr      mvdbsc                                       048000080208     C                   iter                                                   048100070305     C                   ENDIF                                                  048200070305                                                                                048300070305     C                   eval      pageno = pageno + 1                          048400070305                                                                                048500070305     C*‚End: For each screen page                                               048600070305     C                   ENDDO                                                  048700070305                                                                                048800070305     C*‚If not F3/F12                                                           048900070305     C     *IN03         IFNE      '1'                                          049000070305     C     *IN12         ANDNE     '1'                                          049100070305                                                                                049200070305     C*‚Request confirmation                                                    049300070305     C                   EXFMT     ZZCNF1                                       049400070305     C     *IN03         IFNE      '1'                                          049500070305     C     *IN12         ANDNE     '1'                                          049600070305     C*‚If confirmation received then update record                             049700080117     C     xwbccd        chain(e)  custsr                                       049800080117     C                   if        %found(custs)                                049900080208     C                   exsr      mvscdb                                       050000070305     C                   UPDATE    CUSTSR                               99      050100070305     C     *IN99         IFEQ      '1'                                          050200070305     C                   MOVE      'Y2U0007'     MSGID                          050300070305     C                   CALL      RTNMTX                                       050400070305     C                   PARM                    MSGID             7            050500070305     C                   PARM                    ERRMSG          132            050600070305     C* Display error message                                                   050700070305     C                   MOVEL     ERRMSG        ZMSAGE                         050800070305     C                   ENDIF                                                  050900080117     C                   else                                                   051000080117     C                   unlock(e) custs                                        051100080117     C                   endif                                                  051200070305     C                   ENDIF                                                  051300080117                                                                                051400080117     C*‚End: If not F3/F12                                                      051500080117     C                   ENDIF                                                  051600080117                                                                                051700080117     C*‚End: If no record or file error                                         051800070813     C                   ENDIF                                                  051900070305                                                                                052000070305     C                   MOVE      SFLRRN        SHWREC                         052100070305                                                                                052200070305     C                   ENDSR                                                  052300070305     C**********************************************************************    052400070305                                                                                052500070305     C**********************************************************************    052600070305     C     DELREC        BEGSR                                                  052700070305     C**********************************************************************    052800070305     C*‚Subroutine: Delete a record                                             052900070305     C**********************************************************************    053000070305     C                   MOVEL     '  DELETE'    ACTDSP                         053100070305     C                   MOVE      '1'           *IN94                          053200070306     C                   MOVE      '0'           *IN96                          053300070305     C                   MOVE      '1'           *IN97                          053400070306     C                   EXSR      OFFIND                                       053500070305                                                                                053600070305     C                   EXSR      GETREC                                       053700070305                                                                                053800070305     C                   eval      pageno = 1                                   053900070305                                                                                054000070305     C*‚For each screen page                                                    054100070305     C                   dow       pageno <= noofpages                          054200070305                                                                                054300070305     C                   EXSR      DSPSCNS                                      054400070305                                                                                054500070305     C     *IN03         IFEQ      '1'                                          054600070305     C     *IN12         OREQ      '1'                                          054700070305     C                   LEAVE                                                  054800070305     C                   ENDIF                                                  054900070305                                                                                055000070305     C     *IN04         IFEQ      '1'                                          055100070305     C     *IN08         OREQ      '1'                                          055200070305     C     *IN09         OREQ      '1'                                          055300070305     C                   ITER                                                   055400070305     C                   ENDIF                                                  055500070305                                                                                055600070305     C                   eval      pageno = pageno + 1                          055700070305                                                                                055800070305     C*‚End: For each screen page                                               055900070305     C                   ENDDO                                                  056000070305                                                                                056100070309     C*‚If not F3/F12                                                           056200070309     C     *IN03         IFNE      '1'                                          056300070309     C     *IN12         ANDNE     '1'                                          056400070309                                                                                056500070309     C*‚Request confirmation                                                    056600070309     C                   EXFMT     ZZCNF1                                       056700080117                                                                                056800070309     C     *IN03         IFNE      '1'                                          056900070309     C     *IN12         ANDNE     '1'                                          057000070309     C*‚If confirmation received then delete record                             057100080117     C     xwbccd        chain(e)  custsr                                       057200080117     C                   if        %found(custs)                                057300080117     C                   delete(e) custsr                                       057400080117     C                   else                                                   057500080117     C                   unlock(e) custs                                        057600080117     C                   endif                                                  057700080117     C                   ENDIF                                                  057800070309                                                                                057900070309     C*‚End: If not F3/F12                                                      058000070309     C                   ENDIF                                                  058100070305                                                                                058200070305     C                   MOVE      SFLRRN        SHWREC                         058300070305                                                                                058400070305     C                   ENDSR                                                  058500070305     C**********************************************************************    058600070305                                                                                058700070305     C**********************************************************************    058800070305     C     DSPREC        BEGSR                                                  058900070305     C**********************************************************************    059000070305     C*‚Subroutine: Display a record                                            059100070305     C**********************************************************************    059200070305     C                   MOVE      '1'           *IN94                          059300070306     C                   MOVE      '0'           *IN96                          059400070305     C                   MOVE      '0'           *IN97                          059500070305     C                   MOVEL     ' DISPLAY'    ACTDSP                         059600070306     C                   EXSR      OFFIND                                       059700070305                                                                                059800070305     C                   EXSR      GETREC                                       059900080117                                                                                060000070305     C                   eval      pageno = 1                                   060100070305                                                                                060200070305     C*‚For each screen page                                                    060300070305     C                   dow       pageno <= noofpages                          060400070305                                                                                060500070305     C                   EXSR      DSPSCNS                                      060600070305                                                                                060700070305     C     *IN03         IFEQ      '1'                                          060800070305     C     *IN12         OREQ      '1'                                          060900070305     C                   LEAVE                                                  061000070305     C                   ENDIF                                                  061100070305                                                                                061200070305     C     *IN04         IFEQ      '1'                                          061300070305     C     *IN08         OREQ      '1'                                          061400070305     C     *IN09         OREQ      '1'                                          061500070305     C                   ITER                                                   061600070305     C                   ENDIF                                                  061700070305                                                                                061800070305     C                   eval      pageno = pageno + 1                          061900070305                                                                                062000070305     C*‚End: For each screen page                                               062100070305     C                   ENDDO                                                  062200070305                                                                                062300070305     C                   MOVE      SFLRRN        SHWREC                         062400070305                                                                                062500070305     C                   ENDSR                                                  062600070305     C**********************************************************************    062700070305                                                                                062800070305     C**********************************************************************    062900070305     C     GETREC        BEGSR                                                  063000070305     C**********************************************************************    063100070305     C*‚Subroutine: Retrieve a record                                           063200070305     C**********************************************************************    063300080117     C     XWBCCD        CHAIN(N)  CUSTS                              9966      063400071221                                                                                063500071221     C                   select                                                 063600071221     C*‚If record error                                                         063700071221     C                   when      *in99 = *on                                  063800070813     C                   MOVE      'OES0115'     MSGID                          063900070305     C                   CALL      RTNMTX                                       064000070305     C                   PARM                    MSGID             7            064100070305     C                   PARM                    ERRMSG          132            064200070305     C                   MOVEL     ERRMSG        ZMSAGE                         064300071221                                                                                064400071221     C*‚If file error                                                           064500071221     C                   when      *in66 = *on                                  064600070813     C     FILESTS       IFEQ      1218                                         064700070813     C                   MOVE      'Y3U9999'     MSGID                          064800070813     C                   CALL      RTNMTX                                       064900070813     C                   PARM                    MSGID             7            065000070813     C                   PARM                    ERRMSG          132            065100070813     C                   MOVEL     ERRMSG        ZMSAGE                         065200070813     C                   ELSE                                                   065300070813     C                   MOVE      'OEM0004'     MSGID                          065400070813     C                   CALL      RTNMTX                                       065500070813     C                   PARM                    MSGID             7            065600070813     C                   PARM                    ERRMSG          132            065700070813     C                   MOVEL     ERRMSG        ZMSAGE                         065800070813     C                   ENDIF                                                  065900071221                                                                                066000071221     C*‚If no errors                                                            066100071221     C                   other                                                  066200070305                                                                                066300071221     C*‚Retrieve Salesman's name                                                066400071221     C     PERSON        CHAIN(E)  SLMEN                                        066500071221     C                   if        not %found(slmen)                            066600071221     C                   eval      pname = *all'-'                              066700071221     C                   endif                                                  066800071221                                                                                066900071221     C*‚Retrieve Distributor's name                                             067000071221     C     DSDCDE        CHAIN(E)  DISTS                                        067100071221     C                   if        not %found(dists)                            067200071221     C                   eval      dname = *all'-'                              067300071221     C                   endif                                                  067400071221                                                                                067500071221     C*‚Retrieve Customer Group's name                                          067600071221     C     XWBNCD        CHAIN(E)  CUSGRP                                       067700071221     C                   if        not %found(cusgrp)                           067800071221     C                   eval      xwkhtx = *all'-'                             067900071221     C                   endif                                                  068000080117                                                                                068100080208     C                   exsr      mvdbsc                                       068200071221                                                                                068300071221     C                   endsl                                                  068400071221                                                                                068500070305     C                   ENDSR                                                  068600070305     C**********************************************************************    068700070305                                                                                068800070305     C**********************************************************************    068900070130     C     *INZSR        BEGSR                                                  069000070305     C**********************************************************************    069100070130     C*‚Subroutine: Initialisation routines                                     069200070305     C**********************************************************************    069300070130     C*‚Initialise message subfile                                              069400070213     C                   MOVE      '1'           *IN82                          069500070212     C                   MOVEL     'WWCUSTS '    ZZPGM                          069600070130     C*-‚Set date                                                               069700070130     C                   MOVE      *DATE         ZZDATE                         069800070205     C                   MOVE      *YEAR         ZYR                            069900070205     C                   MOVE      '-'           FILLR1                         070000070205     C                   MOVE      *MONTH        ZMTH                           070100070205     C                   MOVE      '-'           FILLR2                         070200070205     C                   MOVE      *DAY          ZDAY                           070300070130     C                   ENDSR                                                  070400070305     C**********************************************************************    070500070305                                                                                070600070305     C**********************************************************************    070700070213     C     SRPROM        BEGSR                                                  070800070305     C**********************************************************************    070900070213     C*‚Subroutine: prompts for F04                                             071000070305     C**********************************************************************    071100070213     C                   SELECT                                                 071200080208     C     SFIELD        WHENEQ    'ZPERSON'                                    071300070213     C                   CALL      'SLMENSEL'                                   071400080208     C                   PARM                    ZPERSON                        071500070213     C                   PARM                    PNAME                          071600080208     C     SFIELD        WHENEQ    'ZCUSNO'                                     071700070213     C                   CALL      'CUSFSEL'                                    071800070213     C                   PARM      *ZEROS        CUSPRM            5 0          071900070213     C     CUSPRM        IFNE      *ZEROS                                       072000080208     C                   MOVE      CUSPRM        ZCUSNO                         072100070213     C                   ENDIF                                                  072200080208     C     SFIELD        WHENEQ    'ZWBNCD'                                     072300070213     C                   CALL      'CUSGRSEL'                                   072400080208     C                   PARM                    ZWBNCD                         072500080208     C                   PARM                    ZWKHTX                         072600080208     C     SFIELD        WHENEQ    'ZDSDCDE'                                    072700070213     C                   CALL      'DISTSSEL'                                   072800080208     C                   PARM                    ZDSDCDE                        072900070213     C                   PARM                    DNAME                          073000070213     C                   ENDSL                                                  073100070213     C                   ENDSR                                                  073200070305     C**********************************************************************    073300070305                                                                                073400070305     C**********************************************************************    073500070306     C     OFFIND        BEGSR                                                  073600070305     C**********************************************************************    073700070213     C*‚Subroutine: Set error indicators to OFF                                 073800070305     C**********************************************************************    073900070212     C                   MOVE      *OFF          *IN99                          074000070212     C                   MOVE      *OFF          *IN31                          074100070212     C                   MOVE      *OFF          *IN32                          074200070212     C                   MOVE      *OFF          *IN33                          074300070212     C                   MOVE      *OFF          *IN34                          074400070212     C                   MOVE      *OFF          *IN35                          074500070306     C                   MOVE      *OFF          *IN36                          074600070306     C                   MOVE      *OFF          *IN37                          074700070306     C                   MOVE      *BLANKS       ZMSAGE                         074800070212     C                   ENDSR                                                  074900070305     C**********************************************************************    075000070305                                                                                075100070305     C**********************************************************************    075200070213     C     ZORDER        BEGSR                                                  075300070305     C**********************************************************************    075400070213     C*‚Subroutine: Customer Orders                                             075500070305     C**********************************************************************    075600090304     C*    XWBCCD        CHAIN     CONHDRL1                           77        075700090304     C*    *IN77         IFEQ      '0'                                          075800070214     C                   CALL      'WWCONHDR'                                   075900070213     C                   PARM                    XWBCCD                         076000090304     C*                  ELSE                                                   076100090304     C*                  MOVE      '1'           *IN99                          076200090304     C*                  MOVE      'YYG0012'     MSGID                          076300090304     C*                  CALL      RTNMTX                                       076400090304     C*                  PARM                    MSGID             7            076500090304     C*                  PARM                    ERRMSG          132            076600070219     C* Display error message                                                   076700090304     C*                  MOVEL     ERRMSG        ZMSAGE                         076800090304     C*                  ENDIF                                                  076900070213     C                   ENDSR                                                  077000070305     C**********************************************************************    077100070305                                                                                077200070305     C**********************************************************************    077300070213     C     ZHISTO        BEGSR                                                  077400070305     C**********************************************************************    077500070213     C*‚Subroutine: Transaction history                                         077600070305     C**********************************************************************    077700090304     C*    XWBCCD        CHAIN     TRNHSTL3                           77        077800090304     C*    *IN77         IFEQ      '0'                                          077900070213     C                   CALL      'WWTRNHST'                                   078000070213     C                   PARM                    XWBCCD                         078100090304     C*                  ELSE                                                   078200090304     C*                  MOVE      '1'           *IN99                          078300090304     C*                  MOVE      'YYG0012'     MSGID                          078400090304     C*                  CALL      RTNMTX                                       078500090304     C*                  PARM                    MSGID             7            078600090304     C*                  PARM                    ERRMSG          132            078700070219     C* Display error message                                                   078800090304     C*                  MOVEL     ERRMSG        ZMSAGE                         078900090304     C*                  ENDIF                                                  079000070213     C                   ENDSR                                                  079100080208     C**********************************************************************    079200080208     C     MVDBSC        BEGSR                                                  079300080208     C                   MOVEL     XWBCCD        ZWBCCD                         079400080208     C                   MOVEL     XWG4TX        ZWG4TX                         079500080208     C                   MOVEL     XWB2CD        ZWB2CD                         079600080208     C                   MOVEL     XWB3CD        ZWB3CD                         079700080208     C                   MOVEL     XWHITX        ZWHITX                         079800080208     C                   MOVEL     XWE0NB        ZWE0NB                         079900080208     C                   MOVEL     XWJUN0        ZWJUN0                         080000080208     C                   MOVEL     XWDVCD        ZWDVCD                         080100080208     C                   MOVEL     XWBNCD        ZWBNCD                         080200080208     C                   MOVEL     PERSON        ZPERSON                        080300080208     C                   MOVEL     DSDCDE        ZDSDCDE                        080400080208     C                   MOVEL     XWBTCD        ZWBTCD                         080500080208     C                   MOVEL     XWGIVA        ZWGIVA                         080600080208     C                   MOVEL     XWAOCD        ZWAOCD                         080700080208     C                   MOVEL     XWBBCD        ZWBBCD                         080800080208     C                   MOVEL     XWG4T0        ZWG4T0                         080900080208     C                   MOVEL     XWC7ST        ZWC7ST                         081000080208     C                   MOVEL     XWDAST        ZWDAST                         081100080208     C                   MOVEL     XWBPD0        ZWBPD0                         081200080208     C                   MOVEL     XWBAD0        ZWBAD0                         081300080208     C                   MOVEL     XWKHTX        ZWKHTX                         081400080208     C                   MOVEL     XWF0VA        ZWF0VA                         081500080208     C                   MOVEL     XWASDT        ZWASDT                         081600080208     C                   MOVEL     XWF0V0        ZWF0V0                         081700080208     C                   MOVEL     XWBQDT        ZWBQDT                         081800080208     C                   MOVEL     XWF1VA        ZWF1VA                         081900080208     C                   MOVEL     XWF1V0        ZWF1V0                         082000080208     C                   MOVEL     XWF2VA        ZWF2VA                         082100080208     C                   MOVEL     XWF3VA        ZWF3VA                         082200080208     C                   MOVEL     XWF4VA        ZWF4VA                         082300080208     C                   MOVEL     XWF6VA        ZWF6VA                         082400080208     C                   MOVEL     XWIDV0        ZWIDV0                         082500080208     C                   MOVEL     XWGAVA        ZWGAVA                         082600080208     C                   MOVEL     XWGBVA        ZWGBVA                         082700080208     C                   MOVEL     XWGCVA        ZWGCVA                         082800080208     C                   MOVEL     XWGDVA        ZWGDVA                         082900080208     C                   MOVEL     XWGEVA        ZWGEVA                         083000080208     C                   MOVEL     XWGFVA        ZWGFVA                         083100080208     C                   MOVEL     XWGGVA        ZWGGVA                         083200080208     C                   MOVEL     CUSNO         ZCUSNO                         083300080208     C                   ENDSR                                                  083400080208     C**********************************************************************    083500080208     C     MVSCDB        BEGSR                                                  083600080208     C                   MOVEL     ZWBCCD        XWBCCD                         083700080208     C                   MOVEL     ZWG4TX        XWG4TX                         083800080208     C                   MOVEL     ZWB2CD        XWB2CD                         083900080208     C                   MOVEL     ZWB3CD        XWB3CD                         084000080208     C                   MOVEL     ZWHITX        XWHITX                         084100080208     C                   MOVEL     ZWE0NB        XWE0NB                         084200080208     C                   MOVEL     ZWJUN0        XWJUN0                         084300080208     C                   MOVEL     ZWDVCD        XWDVCD                         084400080208     C                   MOVEL     ZWBNCD        XWBNCD                         084500080208     C                   MOVEL     ZPERSON       PERSON                         084600080208     C                   MOVEL     ZDSDCDE       DSDCDE                         084700080208     C                   MOVEL     ZWBTCD        XWBTCD                         084800080208     C                   MOVEL     ZWGIVA        XWGIVA                         084900080208     C                   MOVEL     ZWAOCD        XWAOCD                         085000080208     C                   MOVEL     ZWBBCD        XWBBCD                         085100080208     C                   MOVEL     ZWG4T0        XWG4T0                         085200080208     C                   MOVEL     ZWC7ST        XWC7ST                         085300080208     C                   MOVEL     ZWDAST        XWDAST                         085400080208     C                   MOVEL     ZWBPD0        XWBPD0                         085500080208     C                   MOVEL     ZWBAD0        XWBAD0                         085600080208     C                   MOVEL     ZWKHTX        XWKHTX                         085700080208     C                   MOVEL     ZWF0VA        XWF0VA                         085800080208     C                   MOVEL     ZWASDT        XWASDT                         085900080208     C                   MOVEL     ZWF0V0        XWF0V0                         086000080208     C                   MOVEL     ZWBQDT        XWBQDT                         086100080208     C                   MOVEL     ZWF1VA        XWF1VA                         086200080208     C                   MOVEL     ZWF1V0        XWF1V0                         086300080208     C                   MOVEL     ZWF2VA        XWF2VA                         086400080208     C                   MOVEL     ZWF3VA        XWF3VA                         086500080208     C                   MOVEL     ZWF4VA        XWF4VA                         086600080208     C                   MOVEL     ZWF6VA        XWF6VA                         086700080208     C                   MOVEL     ZWIDV0        XWIDV0                         086800080208     C                   MOVEL     ZWGAVA        XWGAVA                         086900080208     C                   MOVEL     ZWGBVA        XWGBVA                         087000080208     C                   MOVEL     ZWGCVA        XWGCVA                         087100080208     C                   MOVEL     ZWGDVA        XWGDVA                         087200080208     C                   MOVEL     ZWGEVA        XWGEVA                         087300080208     C                   MOVEL     ZWGFVA        XWGFVA                         087400080208     C                   MOVEL     ZWGGVA        XWGGVA                         087500080208     C                   MOVEL     ZCUSNO        CUSNO                          087600080208     C                   ENDSR                                                  087700070305     C**********************************************************************    