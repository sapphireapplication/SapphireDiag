000100070317     H*‚--------------------------------------------------------------------    000200050726     H*ˆCOPYRIGHT DATABOROUGH LTD 2005                                          000300050804     H*ˆPROGRAM:  Work with Customer Sites                                      000400010705     H*‚--------------------------------------------------------------------    000500050804     H debug(*yes) copyright('Databorough Ltd. 2005')                           000600980127                                                                                000700980122     F**********************************************************************    000800990528     F*‚F i l e s                                                               000900980122     F**********************************************************************    001000050804     Fwwcusfd   cf   e             workstn sfile(zzsf01:sflrrn)                 001100050804     Fcusfl3    uf a e           k disk                                         001200050804     Fdists     if   e           k disk                                         001300980126                                                                                001400980126     D**********************************************************************    001500990528     D*‚D e f i n i t i o n s                                                   001600980126     D**********************************************************************    001700020906     D sflchanged      s               n   inz(*off)                            001800020906     D sflrrn          s              5p 0                                      001900020906     D zcmd            s            200a                                        002000050804     D zupdated        s              1a                                        002100050804     D mainloop        s              5p 0 inz(*zeros)                          002200050804     D cdate           s               d   datfmt(*iso) inz(*sys)               002300050804     D statuses        s              1a   dim(37) ctdata perrcd(37)            002400021001                                                                                002500050804     D xbcclmsg        pr                  extpgm('XBCCLMSG')                   002600020906                                                                                002700020906     D xmcsnmsg        pr                  extpgm('XMCSNMSG')                   002800050726     D                                7a   const                                002900050726     D                               10a   const                                003000050726     D                               10a   const                                003100050726     D                               50a   const                                003200050726     D                               10a   const                                003300050726     D                                7a   const                                003400050804                                                                                003500050804     D cusfmaint       pr                  extpgm('CUSFMAINT')                  003600050804     D                                5p 0 const                                003700050804     D                                1a                                        003800011119                                                                                003900050804      /free                                                                     004000050804       // ******************************************************************    004100050804       //‚M a i n l i n e   C o d e                                             004200050804       // ******************************************************************    004300050804       dow mainloop < *hival;                                                   004400050804                                                                                004500050804       //‚Build subfile                                                         004600050804       exsr zsflwrt;                                                            004700050804       //‚Display screens                                                       004800050804       write(e) zztr01;                                                         004900050804       write(e) zzmc01;                                                         005000050804       exfmt(e) zzct01;                                                         005100050804       //‚Remove messages                                                       005200050804       xbcclmsg();                                                              005300050804       //‚Action command keys                                                   005400050804       if *in28;                                                                005500050804       exsr zcmdkeys;                                                           005501110914       // Leave;                                                                005600050804       else;                                                                    005700050804       //‚Else action selections                                                005800050804       exsr zselect;                                                            005900050804       endif;                                                                   006000050804                                                                                006100050804       enddo;                                                                   006200050804       // ******************************************************************    006300050804       //‚L o g i c a l   E n d   o f   P r o g r a m                           006400050804       // ******************************************************************    006500050804                                                                                006600050804       // ******************************************************************    006700050804       begsr zsflwrt;                                                           006800050804       // ******************************************************************    006900050804       //‚Subroutine: Write data to subfile                                     007000050804       // ******************************************************************    007100050804       //‚Delete subfile                                                        007200050804       if *in40;                                                                007300050804       *in30 = *on;                                                             007400050804       write(e) zzct01;                                                         007500050804       *in30 = *off;                                                            007600050804       endif;                                                                   007700050804       //‚Write subfile                                                         007800050804       *in31 = *off;                                                            007900050804       sflrrn = *zeros;                                                         008000991115                                                                                008100050804       setll(e) *loval rcusf;                                                   008200050804       read(e) rcusf;                                                           008300020906                                                                                008400050804       dow not %eof(cusfl3) and not %error;                                     008500991115                                                                                008600050804       sflrrn = sflrrn + 1;                                                     008700050804       dssel = *blanks;                                                         008800050804       dscusno = cusno;                                                         008900050804       dscname = cname;                                                         009000050804       dstelno = telno;                                                         009100050804       write(e) zzsf01;                                                         009200991115                                                                                009300050804       read(e) rcusf;                                                           009400050804       enddo;                                                                   009500991115                                                                                009600050804       if sflrrn > *zeros;                                                      009700991115                                                                                009800050804       if not sflchanged;                                                       009900050804       dsprec = 1;                                                              010000050804       endif;                                                                   010100991115                                                                                010200050804       if dsprec > sflrrn                                                       010300050804        or dsprec < 1;                                                          010400050804       dsprec = 1;                                                              010500050804       endif;                                                                   010600020423                                                                                010700050804       *in40 = *on;                                                             010800050804       *in31 = *on;                                                             010801110914       //*in61 = *off;                                                          010900991115                                                                                011000050804       endif;                                                                   011100991115                                                                                011200050804       endsr;                                                                   011300050804       // ******************************************************************    011400050804                                                                                011500050804       // ******************************************************************    011600050804       begsr zselect;                                                           011700050804       // ******************************************************************    011800050804       //‚Subroutine: Action selection                                          011900050804       // ******************************************************************    012000050804       sflchanged = *off;                                                       012100980126                                                                                012200050804       readc(e) zzsf01;                                                         012300980126                                                                                012400050804       //‚For each selection                                                    012500050804       dow not %eof and not %error;                                             012600980126                                                                                012700050804       sflchanged = *on;                                                        012800980126                                                                                012900050804       select;                                                                  013000020906                                                                                013100050804       //‚Change                                                                013200050804       when dssel = ' 2' or dssel = '2 ';                                       013300050804       cusfmaint(dscusno:zupdated);                                             013400050804       dsprec = sflrrn;                                                         013500980126                                                                                013600050804       //‚Delete                                                                013700050804       when dssel = ' 4' or dssel = '4 ';                                       013800050804       exsr zdelete;                                                            013900050804       if sflrrn > 1;                                                           014000050804       dsprec = sflrrn - 1;                                                     014100050804       else;                                                                    014200050804       dsprec = 1;                                                              014300050804       endif;                                                                   014400020906                                                                                014500050804       //‚Display                                                               014600050804       when dssel = ' 5' or dssel = '5 ';                                       014700050804       exsr zdisplay;                                                           014800050804       dsprec = sflrrn;                                                         014900980126                                                                                015000050804       endsl;                                                                   015100980126                                                                                015200050804       dssel = *blanks;                                                         015300050804       update(e) zzsf01;                                                        015400980126                                                                                015500050804       readc(e) zzsf01;                                                         015600980126                                                                                015700050804       //‚End: For each selection                                               015800050804       enddo;                                                                   015900980126                                                                                016000050804       //‚If changes made then update display                                   016100050804       if sflchanged;                                                           016200050804       exsr zsflwrt;                                                            016300050804       endif;                                                                   016400980126                                                                                016500050804       endsr;                                                                   016600050804       // ******************************************************************    016700050804                                                                                016800050804       // ******************************************************************    016900050804       begsr zdelete;                                                           017000050804       // ******************************************************************    017100050804       //‚Subroutine: Delete record                                             017200050804       // ******************************************************************    017300050804       chain(e) dscusno rcusf;                                                  017400020906                                                                                017500050804       if %found(cusfl3);                                                       017600030610                                                                                017700050804       dscusno = cusno;                                                         017800050804       dscname = cname;                                                         017900050804       dsadd1 = add1;                                                           018000050804       dsadd2 = add2;                                                           018100050804       dsadd3 = add3;                                                           018200050804       dsadd4 = add4;                                                           018300050804       dscntry = cntry;                                                         018400050804       dspscd = pscd;                                                           018500050804       dstelno = telno;                                                         018600050804       dsfaxno = faxno;                                                         018700050804       dsemail = email;                                                         018800050804       dswebsit = websit;                                                       018900050804       dsdsdcde = dsdcde;                                                       019000050804       dsstatus = status;                                                       019100050804       dsusernm = usernm;                                                       019200070305       *in23='1';                                                               019300030610                                                                                019400050804       dow not *in03 and not *in12;                                             019500020906                                                                                019600050804       write(e) zzmc01;                                                         019700050804       exfmt(e) zzft01;                                                         019800050804       xbcclmsg();                                                              019900020906                                                                                020000050804       if not *in03 and not *in12;                                              020100020906                                                                                020200050804       delete(e) rcusf;                                                         020300020909                                                                                020400050804       //‚"Record deleted."                                                     020500050804       xmcsnmsg('OEM0030':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                020600050804       leave;                                                                   020700020909                                                                                020800050804       endif;                                                                   020900020906                                                                                021000050804       enddo;                                                                   021100020909                                                                                021200050804       endif;                                                                   021300030610                                                                                021400050804       endsr;                                                                   021500050804       // ******************************************************************    021600050804                                                                                021700050804       // ******************************************************************    021800050804       begsr zdisplay;                                                          021900050804       // ******************************************************************    022000050804       //‚Subroutine: Display record                                            022100050804       // ******************************************************************    022200050804       chain(e) dscusno rcusf;                                                  022300050804                                                                                022400050804       if %found(cusfl3);                                                       022500050804                                                                                022600050804       dscusno = cusno;                                                         022700050804       dscname = cname;                                                         022800050804       dsadd1 = add1;                                                           022900050804       dsadd2 = add2;                                                           023000050804       dsadd3 = add3;                                                           023100050804       dsadd4 = add4;                                                           023200050804       dscntry = cntry;                                                         023300050804       dspscd = pscd;                                                           023400050804       dstelno = telno;                                                         023500050804       dsfaxno = faxno;                                                         023600050804       dsemail = email;                                                         023700050804       dswebsit = websit;                                                       023800050804       dsdsdcde = dsdcde;                                                       023801110914       //dsdsde = dsdcde;                                                       023900050804       dsstatus = status;                                                       024000050804       dsusernm = usernm;                                                       024100070305       *in23='0';                                                               024200050804                                                                                024300050804       dow not *in03 and not *in12;                                             024400050804                                                                                024500050804       *in34 = *on;                                                             024600050804       write(e) zzmc01;                                                         024700050804       exfmt(e) zzft01;                                                         024800050804       xbcclmsg();                                                              024900020906                                                                                025000050804       enddo;                                                                   025100020909                                                                                025200050804       endif;                                                                   025300020906                                                                                025400050804       endsr;                                                                   025500050804       // ******************************************************************    025600050804                                                                                025700050804       // ******************************************************************    025800050804       begsr zadd;                                                              025900050804       // ******************************************************************    026000050804       //‚Subroutine: Add record                                                026100050804       // ******************************************************************    026200050804       dscusno = *zeros;                                                        026300050804       dscname = *blanks;                                                       026400050804       dsadd1 = *blanks;                                                        026500050804       dsadd2 = *blanks;                                                        026600050804       dsadd3 = *blanks;                                                        026700050804       dsadd4 = *blanks;                                                        026800050804       dscntry = *blanks;                                                       026900050804       dspscd = *blanks;                                                        026901110914       //dspscdse = *blanks;                                                    027000050804       dstelno = *blanks;                                                       027100050804       dsfaxno = *blanks;                                                       027200050804       dsemail = *blanks;                                                       027300050804       dswebsit = *blanks;                                                      027400050804       dsdsdcde = *blanks;                                                      027500050804       dsstatus = *blanks;                                                      027600050804       dsusernm = *blanks;                                                      027700020909                                                                                027800050804       *in03 = *off;                                                            027900050804       *in12 = *off;                                                            028000070305       *in23 = *off;                                                            028100020909                                                                                028200050804       dow not *in03 and not *in12;                                             028300050804                                                                                028400050804       *in34 = *off;                                                            028500050804       write(e) zzmc01;                                                         028600050804       exfmt(e) zzft02;                                                         028700050804       xbcclmsg();                                                              028800050804                                                                                028900050804       *in50 = *off;                                                            029000050804       *in51 = *off;                                                            029100050804       *in52 = *off;                                                            029200050804       *in53 = *off;                                                            029300050804       *in54 = *off;                                                            029400050804       *in55 = *off;                                                            029500050804       *in56 = *off;                                                            029600050804       *in57 = *off;                                                            029700050804       *in58 = *off;                                                            029800050804       *in59 = *off;                                                            029900050804       *in60 = *off;                                                            030000050804                                                                                030100050804       if not *in03 and not *in12;                                              030200050804                                                                                030300050804       //‚Customer number                                                       030400050804       if dscusno = *zeros;                                                     030500050804       *in51 = *on;                                                             030600050804       xmcsnmsg('OEM0002':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                030700050804       iter;                                                                    030800050804       endif;                                                                   030900050804                                                                                031000050804       //‚Customer name                                                         031100050804       if dscname = *blanks;                                                    031200050804       *in52 = *on;                                                             031300050804       xmcsnmsg('OEM0012':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                031400050804       iter;                                                                    031500050804       endif;                                                                   031600050804                                                                                031700050804       //‚Telephone number                                                      031800050804       if dstelno <> *blanks;                                                   031900050804       if %check(' 0123456789':dstelno) > *zeros;                               032000050804       *in54 = *on;                                                             032100050804       xmcsnmsg('OEM0014':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                032200050804       iter;                                                                    032300050804       endif;                                                                   032400050804       endif;                                                                   032500050804                                                                                032600050804       //‚Fax number                                                            032700050804       if dsfaxno <> *blanks;                                                   032800050804       if %check(' 0123456789':dsfaxno) > *zeros;                               032900050804       *in55 = *on;                                                             033000050804       xmcsnmsg('OEM0015':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                033100050804       iter;                                                                    033200050804       endif;                                                                   033300050804       endif;                                                                   033400050804                                                                                033500050804       //‚Distributor                                                           033600050804       if dsdsdcde <> *blanks;                                                  033700050804       setll(e) dsdsdcde rprods;                                                033800050804       if not %equal(dists);                                                    033900050804       *in58 = *on;                                                             034000050804       xmcsnmsg('OEM0018':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                034100050804       iter;                                                                    034200050804       endif;                                                                   034300050804       endif;                                                                   034400050804                                                                                034500050804       //‚Status                                                                034600050804       if dsstatus <> *blanks;                                                  034700050804       if %lookup(dsstatus:statuses) = *zeros;                                  034800050804       *in59 = *on;                                                             034900050804       xmcsnmsg('OEM0019':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                035000050804       iter;                                                                    035100050804       endif;                                                                   035200050804       endif;                                                                   035300050804                                                                                035400050804       //‚Contact                                                               035500050804       if dsusernm = *blanks;                                                   035600050804       *in60 = *on;                                                             035700050804       xmcsnmsg('OEM0020':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                035800050804       iter;                                                                    035900050804       endif;                                                                   036000020906                                                                                036100050804       clear rcusf;                                                             036200050804       cusno = dscusno;                                                         036300050804       cname = dscname;                                                         036400050804       add1 = dsadd1;                                                           036500050804       add2 = dsadd2;                                                           036600050804       add3 = dsadd3;                                                           036700050804       add4 = dsadd4;                                                           036800050804       cntry = dscntry;                                                         036900050804       pscd = dspscd;                                                           037000050804       telno = dstelno;                                                         037100050804       faxno = dsfaxno;                                                         037200050804       email = dsemail;                                                         037300050804       websit = dswebsit;                                                       037400050804       dsdcde = dsdsdcde;                                                       037500050804       status = dsstatus;                                                       037600050804       usernm = dsusernm;                                                       037700050804       write(e) rcusf;                                                          037800020909                                                                                037900050804       //‚"Record added."                                                       038000050804       xmcsnmsg('OEM0031':'OEMSGF':'XRAPPS':' ':'*PRV':'*COMP');                038100020906                                                                                038200050804       leave;                                                                   038300020906                                                                                038400050804       endif;                                                                   038500020906                                                                                038600050804       enddo;                                                                   038700020909                                                                                038800050804       endsr;                                                                   038900050804       // ******************************************************************    039000050804                                                                                039100050804       // ******************************************************************    039200050804       begsr zcmdkeys;                                                          039300050804       // ******************************************************************    039400050804       //‚Subroutine: Action command keys                                       039500050804       // ******************************************************************    039600050804       select;                                                                  039700050804       when *in03;                                                              039800050804       exsr zf03;                                                               039900050804       when *in06;                                                              040000050804       exsr zadd;                                                               040100050804       when *in12;                                                              040200050804       exsr zf12;                                                               040300050804       endsl;                                                                   040400020906                                                                                040500050804       endsr;                                                                   040600050804       // ******************************************************************    040700050804                                                                                040800050804       // ******************************************************************    040900050804       begsr zf03;                                                              041000050804       // ******************************************************************    041100050804       //‚Subroutine: F3=Exit                                                   041200050804       // ******************************************************************    041300050804       *inlr = *on;                                                             041400050804       return;                                                                  041500050804                                                                                041600050804       endsr;                                                                   041700050804       // ******************************************************************    041800050804                                                                                041900050804       // ******************************************************************    042000050804       begsr zf12;                                                              042100050804       // ******************************************************************    042200050804       //‚Subroutine: F12=Cancel                                                042300050804       // ******************************************************************    042400050804       *inlr = *on;                                                             042500050804       return;                                                                  042600050804                                                                                042700050804       endsr;                                                                   042800050804       // ******************************************************************    042900020906                                                                                043000050804       begsr *inzsr;                                                            043100050804       // ******************************************************************    043200050804       //‚Subroutine: Initialisation routines                                   043300050804       // ******************************************************************    043400021001                                                                                043500050804       //‚Initialise message subfile                                            043600050804       *in32 = *on;                                                             043700050804       zzpgm = 'WWCUSF';                                                        043800980126                                                                                043900050804       //‚Set date                                                              044000050804       zzdate = %char(cdate);                                                   044100020320                                                                                044200050804       endsr;                                                                   044300050804       // ******************************************************************    044400050804                                                                                044500050804      /end-free                                                                 044600050804**                                                                              044700050804 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ                                           